import{r as i,j as e,a as C}from"./index-C8SrrZYJ.js";import{a as Q,I as q}from"./index-BjgGQre5.js";import{a as S,c as w}from"./common-BDZuGjqk.js";import"./iconBase-MD6yoUqO.js";const I=({setIsCorrect:t,setCanSubmit:r,question:s,choices:o,correctAnswer:l,index:d,previewUrl:x})=>{const[h,u]=i.useState(null),[n,m]=i.useState(!0),a=i.useRef(null);i.useEffect(()=>{a.current&&a.current.play()},[n]),i.useEffect(()=>{u(null)},[s]);const j=c=>{u(c),t(c===l),r(!0)},p=()=>{a.current&&(n?a.current.pause():a.current.play(),m(!n))};return e.jsxs("div",{className:"QuizMultipleChoice",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("h2",{children:["Q",d+1,"."]}),x&&e.jsxs("div",{className:"quiz-audio",onClick:p,children:[n?e.jsx(Q,{}):e.jsx(q,{}),e.jsx("audio",{ref:a,muted:n,src:x})]})]}),e.jsx("div",{className:"mc-question",children:e.jsx("p",{children:s})}),e.jsx("div",{className:"mc-choice",children:o.length>0?o.map(c=>e.jsx("div",{className:`choice ${h===c.id?"selected":""}`,onClick:()=>j(c.id),children:c.text},c.id)):e.jsx("p",{})})]})},b="/assets/o-CzCdy8yD.webp",y="/assets/x-C_HdehgS.webp",E=({setIsCorrect:t,setCanSubmit:r,question:s,correctAnswer:o,index:l})=>{const[d,x]=i.useState("");i.useEffect(()=>{x(""),r(!1)},[l]);const h=u=>{x(u),t(u===o),r(!0)};return e.jsxs("div",{className:"QuizOX",children:[e.jsxs("h2",{children:["Q",l+1,"."]}),e.jsx("div",{className:"ox-question",children:e.jsx("p",{children:s})}),e.jsxs("div",{className:"ox-answers",children:[e.jsx("div",{className:`o-answer ${d==="O"?"selected":""}`,onClick:()=>h("O"),children:e.jsx("img",{src:b,alt:"O"})}),e.jsx("div",{className:`x-answer ${d==="X"?"selected":""}`,onClick:()=>h("X"),children:e.jsx("img",{src:y,alt:"X"})})]})]})},A=({setIsCorrect:t,setCanSubmit:r,question:s,correctAnswer:o,index:l,previewUrl:d,quizImage:x})=>{const[h,u]=i.useState(""),[n,m]=i.useState(!0),a=i.useRef(null);i.useEffect(()=>{u(""),a.current&&a.current.play()},[l,n]);const j=f=>{const z=f.target.value;u(z),r(z.trim()!=="")},p=()=>{const f=h.trim()===o;t(f)},c=()=>{a.current&&(n?a.current.pause():a.current.play(),m(!n))};return e.jsxs("div",{className:"QuizSubjective",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("h2",{children:["Q",l+1,"."]}),d&&e.jsxs("div",{className:"quiz-audio",onClick:c,children:[n?e.jsx(Q,{}):e.jsx(q,{}),e.jsx("audio",{ref:a,muted:n,src:d})]})]}),e.jsxs("div",{className:"sub-question",children:[e.jsx("p",{children:s}),x&&e.jsx("img",{src:x,alt:"Quiz related image"})]}),e.jsx("h2",{children:"정답 입력"}),e.jsx("input",{type:"text",placeholder:"정답을 입력 해 주세요.",className:"sub-answer",value:h,onChange:j,onBlur:p})]})},M=({timeLeft:t,setTimeLeft:r})=>(i.useEffect(()=>{const s=setInterval(()=>{r(o=>o>0?o-1:(clearInterval(s),0))},1e3);return()=>clearInterval(s)},[r]),e.jsxs("div",{className:"QuizTimeBar",children:[e.jsx("div",{className:`quiz-timer-bar ${t===0?"timeout":""}`}),e.jsx("div",{className:"quiz-timer",children:t})]})),N=S(),k=async()=>{var t;try{return(await N.get("/quizzes/list")).data}catch(r){throw w.isAxiosError(r)?console.error("Axios error:",((t=r.response)==null?void 0:t.data)||r.message):console.error("Unexpected error:",r),r}},O=async t=>{var r;try{const s=await N.post("/quizzes/result",t);return console.log("Post result:",s.data),s}catch(s){throw w.isAxiosError(s)?console.error("Failed to post quiz result:",((r=s.response)==null?void 0:r.data)||s.message):console.error("Error posting quiz result:",s),s}};function B(){const[t,r]=i.useState(0),[s,o]=i.useState([]),[l,d]=i.useState(null),[x,h]=i.useState(!1),[u,n]=i.useState(20),m=C();i.useEffect(()=>{(async()=>{const z=(await k()).map(v=>({...v,choice:v.choice?Object.keys(v.choice).map(g=>({id:g,text:v.choice[g]})):[]}));o(z)})()},[]),i.useEffect(()=>{s.length>0&&t>=s.length&&m("/quiz/success",{replace:!0})},[t,m,s]),i.useEffect(()=>{u===0&&m("/quiz/fail",{replace:!0})},[u,m]);const a=async()=>{if(l===null){m("/quiz/fail",{replace:!0});return}const c=s[t],f={quizId:c.quizId,submit:c.answer,result:l};await O(f),l?j():m("/quiz/fail",{replace:!0})},j=()=>{n(20),d(null),h(!1),r(t+1)},p=()=>{if(!s.length||t>=s.length)return e.jsx("div",{});const c=s[t],f={setIsCorrect:d,setTimeLeft:n,setCanSubmit:h,question:c.question,choices:c.choice,correctAnswer:c.answer,index:t,previewUrl:c.previewUrl,quizImage:c.quizImage};switch(c.quizType){case"객관식":return e.jsx(I,{...f});case"주관식":return e.jsx(A,{...f});case"OX":return e.jsx(E,{...f});default:return null}};return e.jsxs("div",{className:"QuizSolvePage",children:[e.jsx(M,{timeLeft:u,setTimeLeft:n},t),p(),x&&e.jsx("button",{onClick:a,className:"submission-button",children:"제출"})]})}export{B as default};
