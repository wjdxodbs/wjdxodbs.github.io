import{l as j,e as h,c as d,r as i,j as t,R as m,d as S,a as I,k as f,u as y}from"./index-D0mAKFMI.js";import{a as M}from"./common-gnwGuZx5.js";import{H as R}from"./Header-CM0D3EN-.js";import{b as C}from"./index-Ct6AWWiC.js";import{I as b,a as w}from"./index-l8ggr4mc.js";import{r as D,d as A}from"./atoms-DgHcmWOZ.js";import{G as g}from"./iconBase-C_JQmlxO.js";import{t as _,T as E}from"./toastMsg-BypJf004.js";import{d as H}from"./dayjs.min-CYunUN-J.js";import{y as $,l as B}from"./listenSong-Do1HItFm.js";import{L as O}from"./Loading-C1C8Y75N.js";import"./AddressContent-CIN8wtB4.js";import"./index-Co6n4StN.js";const v=j({key:"optionModalState",default:!1}),p=j({key:"reportModalState",default:!1}),u=j({key:"musicInfoState",default:{address:"",albumImage:"",artist:"",content:"",itemImage:"",pickupStatus:!1,throwId:0,thrownDate:"",title:"",previewUrl:"",otherPickedCount:0}}),T=async s=>{try{const{data:e}=await M().get(`/music/thrown/${s}`);return e}catch(e){throw console.error(e),e}},V=async s=>{try{await M().post(`/music/pick/${s}`)}catch(e){throw e}},Z=h({key:"musicPickHeaderState",get:({get:s})=>{const{address:e,albumImage:c,previewUrl:a}=s(u);return{address:e,albumImage:c,previewUrl:a}}}),L=h({key:"musicPickImageState",get:({get:s})=>{const{itemImage:e,albumImage:c}=s(u);return{itemImage:e,albumImage:c}}}),U=h({key:"musicPickStatusState",get:({get:s})=>{const{throwId:e,pickupStatus:c}=s(u);return{throwId:e,pickupStatus:c}}}),N=h({key:"musicPickMusicInfoState",get:({get:s})=>{const{title:e,artist:c,otherPickedCount:a}=s(u);return{title:e,artist:c,otherPickedCount:a}}}),W=h({key:"musicPickCommentState",get:({get:s})=>{const{thrownDate:e,content:c}=s(u);return{thrownDate:e,content:c}}}),z=()=>{const{itemImage:s,albumImage:e}=d(L),{title:c,artist:a,otherPickedCount:n}=d(N),[o,l]=i.useState(!1),r=i.useRef(null);return i.useEffect(()=>{if(r.current){const x=r.current.scrollWidth,P=r.current.clientWidth;x>P?l(!0):l(!1)}},[]),t.jsxs("div",{className:"content-bottom",children:[t.jsxs("div",{className:"music-info",children:[t.jsx("div",{className:"title",children:t.jsx("div",{ref:r,className:`scrolling-text ${o?"animated":""}`,children:c})}),t.jsx("div",{className:"artist",children:a})]}),t.jsxs("div",{className:"music-cover",children:[t.jsx("img",{src:s||e,onError:x=>{x.currentTarget.src=e}}),t.jsxs("div",{className:"heart",children:[t.jsx(C,{}),t.jsx("div",{children:n})]})]})]})},F=({previewUrl:s})=>{const[e,c]=i.useState(!0),a=i.useRef(null),n=()=>{a.current&&(e?a.current.pause():a.current.play().catch(()=>c(!1)),c(o=>!o))};return i.useEffect(()=>{const o=()=>c(!1);return a.current&&(a.current.addEventListener("ended",o),a.current.play().catch(l=>{console.error("Audio play failed",l),c(!1)})),()=>{a.current&&(a.current.removeEventListener("ended",o),a.current.pause())}},[]),t.jsxs("div",{className:"AudioPlayer",onClick:n,children:[e?t.jsx(b,{}):t.jsx(w,{}),t.jsx("audio",{ref:a,src:s})]})},G=()=>{const{address:s,albumImage:e,previewUrl:c}=d(Z);return t.jsxs("div",{className:"MusicPickDetailTop",children:[t.jsx("img",{className:"album-image",src:e,alt:""}),t.jsxs("div",{className:"cover",children:[t.jsx("div",{className:"black-cover"}),t.jsx("div",{className:"black-gradient"}),t.jsxs("div",{className:"content",children:[t.jsx(R,{centerText:s,type:"address"}),c&&t.jsx(F,{previewUrl:c}),t.jsx(z,{})]})]})]})},Y=i.memo(G);function q(s){return g({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M388.8 896.4v-27.198c.6-2.2 1.6-4.2 2-6.4 8.8-57.2 56.4-102.4 112.199-106.2 62.4-4.4 115.2 31.199 132.4 89.199 2.2 7.6 3.8 15.6 5.8 23.4v27.2c-.6 1.8-1.6 3.399-1.8 5.399-8.6 52.8-46.6 93-98.6 104.4-4 .8-8 2-12 3h-27.2c-1.8-.6-3.6-1.6-5.4-1.8-52-8.4-91.599-45.4-103.6-96.8-1.2-5-2.6-9.6-3.8-14.2zm252.4-768.797l-.001 27.202c-.6 2.2-1.6 4.2-1.8 6.4-9 57.6-56.8 102.6-113.2 106.2-62.2 4-114.8-32-131.8-90.2-2.2-7.401-3.8-15-5.6-22.401v-27.2c.6-1.8 1.6-3.4 2-5.2 9.6-52 39.8-86 90.2-102.2 6.6-2.2 13.6-3.4 20.4-5.2h27.2c1.8.6 3.6 1.6 5.4 1.8 52.2 8.6 91.6 45.4 103.6 96.8 1.201 4.8 2.401 9.4 3.601 13.999zm-.001 370.801v27.2c-.6 2.2-1.6 4.2-2 6.4-9 57.4-58.6 103.6-114.6 106-63 2.8-116.4-35.2-131.4-93.8-1.6-6.2-3-12.4-4.4-18.6v-27.2c.6-2.2 1.6-4.2 2-6.4 8.8-57.4 58.6-103.601 114.6-106.2 63-3 116.4 35.2 131.4 93.8 1.6 6.4 3 12.6 4.4 18.8z"},child:[]}]})(s)}function J(s){return g({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120,16V8a8,8,0,0,1,16,0v8a8,8,0,0,1-16,0Zm80,32a8,8,0,0,0,5.66-2.34l8-8a8,8,0,0,0-11.32-11.32l-8,8A8,8,0,0,0,200,48ZM50.34,45.66A8,8,0,0,0,61.66,34.34l-8-8A8,8,0,0,0,42.34,37.66Zm87,26.45a8,8,0,1,0-2.64,15.78C153.67,91.08,168,108.32,168,128a8,8,0,0,0,16,0C184,100.6,163.93,76.57,137.32,72.11ZM232,176v24a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V176a16,16,0,0,1,16-16V128a88,88,0,0,1,88.67-88c48.15.36,87.33,40.29,87.33,89v31A16,16,0,0,1,232,176ZM56,160H200V129c0-40-32.05-72.71-71.45-73H128a72,72,0,0,0-72,72Zm160,40V176H40v24H216Z"},child:[]}]})(s)}const K=()=>{const s=m(p),e=m(v);return t.jsxs("div",{className:"OptionModal",children:[t.jsx("div",{className:"background",onClick:()=>e(!1)}),t.jsxs("div",{className:"content",children:[t.jsxs("div",{className:"report",children:[t.jsx(J,{}),t.jsx("div",{onClick:()=>{e(!1),s(!0)},children:"신고하기"})]}),t.jsx("button",{className:"close",onClick:()=>e(!1),children:"닫기"})]})]})},Q=({content:s})=>{const e=m(p),c=()=>{_("신고 완료"),e(!1)};return t.jsx("li",{onClick:c,children:s})},X=["마음에 들지 않습니다","스팸","혐호 발언 또는 상징","불법 또는 규제 상품 판매","기타 문제"],tt=()=>{const s=m(p);return t.jsxs("div",{className:"ReportModal",children:[t.jsx("div",{className:"background",onClick:()=>s(!1)}),t.jsxs("div",{className:"container",children:[t.jsx("div",{className:"report",children:"신고"}),t.jsx("hr",{}),t.jsxs("div",{className:"content",children:[t.jsxs("div",{className:"title",children:[t.jsx("div",{children:"이 음악을 신고하는 이유"}),t.jsx("div",{children:"회원님의 신고는 익명으로 처리됩니다."})]}),t.jsx("ul",{className:"reson",children:X.map(e=>t.jsx(Q,{content:e},e))})]})]})]})},et=()=>{const{thrownDate:s,content:e}=d(W),[c,a]=S(v),n=d(p),o=i.useMemo(()=>H(s).format("YY.MM.DD"),[s]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"top",children:[t.jsx("div",{className:"option",children:t.jsx(q,{onClick:()=>a(!0)})}),t.jsx("div",{className:"content",children:e}),t.jsx("div",{className:"date",children:o})]}),c&&t.jsx(K,{}),n&&t.jsx(tt,{})]})},st=i.memo(et),ct=({text:s,className:e,onClick:c,disabled:a=!1})=>t.jsxs("button",{className:`MusicPickBtn ${e}`,onClick:c,disabled:a,children:[s==="바로 듣기"&&t.jsx("img",{src:$,alt:""}),t.jsx("div",{children:s})]}),k=i.memo(ct),at=()=>{const{throwId:s,pickupStatus:e}=d(U),{title:c,artist:a}=d(N),n=m(D),o=m(A),l=I(),r=async()=>{try{await V(s),n(null),o(null),l("/")}catch(x){console.error(x)}};return t.jsxs("div",{className:"MusicPickDetailBottom",children:[t.jsx(st,{}),t.jsxs("div",{className:"bottom",children:[t.jsx(k,{text:"바로 듣기",className:"listen",onClick:()=>B(c,a)}),t.jsx(k,{text:"줍기",className:`pick ${e&&"disable"}`,onClick:r,disabled:e})]})]})},it=i.memo(at),kt=()=>{const[s,e]=i.useState(!1),c=m(u),a=f(v),n=f(p),{id:o}=y(),l=async()=>{try{const r=await T(o);c(r)}catch(r){console.log(r)}finally{a(),n(),e(!0)}};return i.useEffect(()=>{l()},[]),s?t.jsxs("div",{className:"MusicPickDetailPage",children:[t.jsx(Y,{}),t.jsx(it,{}),t.jsx(E,{})]}):t.jsx(O,{})};export{kt as default};
