import{j as e,f as E,i as q,k,l as H,m as j,o as C,d as P,u as B,r as A,t as L,p as F}from"./index-DH76QrY1.js";import{N as X}from"./NoneNavHeader-D6iMIN4Z.js";import{c as W}from"./index-R6LbOZZC.js";import{T}from"./Common-BqhlH5xO.js";import{a as O}from"./axios-Bo0ATomq.js";import{a as p}from"./commons-D5rr2GKD.js";import{P as M}from"./Prompt-B6cIy6gb.js";import{L as Y}from"./Loading-C-b2YYv0.js";import{G as z}from"./index-CMKJvDx_.js";import"./index-B2g7cyBY.js";import"./iconBase-DQP2xcrS.js";import"./ModalButton-N8o5GNtv.js";const S=({label:s,color:a})=>e.jsxs("div",{className:"flex items-center gap-[0.5vh]",children:[e.jsx("div",{className:"text-[2vh]",children:s}),e.jsx("div",{className:`w-[2.5vh] h-[2.3vh] bg-${a} rounded-t-lg rounded-b-sm`})]}),D=()=>e.jsxs("div",{className:"flex justify-end gap-[2vh]",children:[e.jsx(S,{label:"선택불가",color:"bgGray"}),e.jsx(S,{label:"선택가능",color:"textGray"}),e.jsx(S,{label:"선택좌석",color:"red-600"})]}),g=E({key:"selectSeatsAtom",default:[]}),R=E({key:"occupiedSeatsAtom",default:[]}),w=q({key:"selectSeatsLengthSelector",get:({get:s})=>s(g).length}),I=k({key:"isSelectedSelector",get:s=>({get:a})=>a(g).includes(s)}),V=k({key:"isSelectableSelector",get:({seatId:s,max:a})=>({get:o})=>{const l=o(w),x=o(I(s));return l<a||x}}),K=({seatId:s,max:a,isOccupied:o})=>{const l=H(g),x=j(I(s)),i=j(V({seatId:s,max:a})),h=b=>{const v=b.target.checked;!o&&i&&l(r=>v?[...r,s]:r.filter(t=>t!==s))},c=`w-[4vh] h-[3.3vh] rounded-b-sm rounded-t-xl flex justify-center items-center font-bold text-[1.5vh] cursor-pointer ${o||!i?"bg-bgGray":x?"bg-red-600":"bg-textGray"}`;return e.jsxs("label",{className:"relative",children:[e.jsx("div",{className:c,children:o||!i?e.jsx(W,{className:"text-[4vh] text-textGray"}):s}),e.jsx("input",{className:"hidden ",type:"checkbox",disabled:o||!i,checked:x,onChange:h})]})},_=({max:s})=>{const a=j(w),o=j(g),l=C(g),x=H(R),i=P(),h=B();console.log(h.state);const[c]=A.useState(h.state),b=async()=>{const t=(await p().get(`/reservations/get/seat/${c.fundinfo.fundingId}`)).data.match(/[A-Za-z]\d+/g)||[];console.log(t),x(t)},v=async()=>{var r;if(a<s){L("인원을 선택해주세요");return}try{const t={fundingId:c.fundinfo.fundingId,position:o};console.log(t);const n=await p().post("reservations/make",t);console.log(n);const u=await p().get(`/reservations/get/${n.data}`);console.log(u),l(),i(`/user/ticket/${n.data}`,{state:u.data,replace:!0})}catch(t){console.log(t),O.isAxiosError(t)&&((r=t.response)==null?void 0:r.data.code)==="Reservation_400_6"&&(L(t.response.data.message),l(),b())}};return e.jsxs("div",{className:"text-black bg-white w-full rounded-t-2xl flex flex-col justify-between",children:[e.jsxs("div",{className:"p-[2vh] flex gap-[3vh]",children:[e.jsxs("div",{className:"flex flex-col justify-between flex-1",children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"text-[2.5vh] font-bold",children:c.fundinfo.cinemaName}),e.jsx("div",{className:"text-[1.5vh]",children:`3.15(금) ${c.fundinfo.time}`})]}),e.jsxs("div",{className:"flex justify-between text-[2vh]",children:[e.jsx("div",{className:"font-bold",children:c.movieTitle}),e.jsx("div",{children:`인원 ${a} / ${s}`})]})]}),e.jsx("img",{className:"h-[12vh] object-cover rounded",src:c.poster,alt:"영화포스터"})]}),e.jsx("button",{className:" w-[100%] h-[6vh] bg-red-600 shadow-bgRed text-white font-bold text-[2.5vh] ",onClick:v,children:"예매"}),e.jsx(T,{})]})},$="data:image/webp;base64,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",xe=()=>{const s=C(g),a=j(w),[o,l]=F(R),[x,i]=A.useState(0),[h,c]=A.useState(!0),[b,v]=A.useState(!1),r=1,t=P(),{state:n}=B(),u=async()=>{fetch(`https://j10c204.p.ssafy.io/api//reservations/decrease/${n.fundinfo.fundingId}`,{method:"GET",headers:{Authorization:localStorage.getItem("jwt")},keepalive:!0})},Q=()=>{u(),a?v(!0):t(-1)},y=()=>v(!1),U=()=>{s(),y(),t(-1)};console.log(n.movieId),console.log(n.fundinfo.fundingId);const J="ABCDEFGH".split(""),Z=Array.from({length:8},(m,d)=>d+1);return A.useEffect(()=>((async()=>{var d;try{await p().get(`/reservations/check/payment/${n.fundinfo.fundingId}`);const N=(await p().get(`/reservations/get/seat/${n.fundinfo.fundingId}`)).data.match(/[A-Za-z]\d+/g)||[];console.log(N),l(N);const G=await p().get(`/reservations/increase/${n.fundinfo.fundingId}`);i(G.data),console.log(G)}catch(f){console.log(f),O.isAxiosError(f)&&((d=f.response)==null?void 0:d.data.code)==="Reservation_400_2"&&t(`/fund/list/${n.movieId}`,{state:{type:"list",err:f.response.data.message},replace:!0})}finally{c(!1)}})(),window.addEventListener("beforeunload",u),()=>{window.removeEventListener("beforeunload",u)}),[]),A.useEffect(()=>{const m=d=>{a&&(d.preventDefault(),d.returnValue="",u())};return window.addEventListener("beforeunload",m),()=>window.removeEventListener("beforeunload",m)},[a]),e.jsxs("div",{className:"h-[100vh] flex flex-col",children:[e.jsx(X,{centerText:"좌석예매",onBackButtonClick:Q}),h?e.jsx(Y,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:" absolute right-6 top-4 text-[1.5vh] flex items-center gap-[1vh] text-red-600",children:[e.jsx(z,{}),x,"명이 보고있어요"]}),e.jsxs("div",{className:"flex flex-col justify-between h-[93vh]",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-[5vh] p-[3vh]",children:[e.jsx(D,{}),e.jsxs("div",{className:"flex flex-col items-center gap-[5vh]",children:[e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsx("img",{className:"w-[100%] h-[5vh]",src:$,alt:"영화관스크린"}),e.jsx("div",{className:"text-[2vh] text-[#A09FB0] font-bold",children:"SCREEN"})]}),e.jsx("div",{className:"flex flex-col gap-[2vh]",children:J.map(m=>e.jsx("div",{className:"flex gap-[2vh]",children:e.jsx("div",{className:"flex items-center justify-center gap-[1vh]",children:Z.map(d=>{const f=`${m}${d}`;return e.jsx(K,{seatId:f,max:r,isOccupied:o.includes(f)},f)})})},m))})]})]}),e.jsx(_,{max:r})]})]}),b&&e.jsx(M,{onClose:y,onConfirm:U}),e.jsx(T,{})]})};export{xe as default};
