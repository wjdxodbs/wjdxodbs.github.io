import{c as V,r,j as s,a as q}from"./index-BFfqBe_w.js";import{H as B}from"./Header-gY4_XGT7.js";import{L as F}from"./Loading-DoK-N6Ig.js";import"./iconBase-DhHVUUgp.js";import"./AddressContent-Aj_TjtZn.js";const O=V(),_=async()=>{try{return(await O.get("/quizzes/contents/rhythm")).data}catch(n){return console.error("Failed to fetch song preview URLs:",n),null}},J=r.memo(({note:n,exploding:d})=>s.jsx("div",{className:`note lane${n.lane} ${d?"exploding":""}`,style:{top:`${n.top}%`,left:`${n.lane*16.66}%`}})),K=()=>{const[n,d]=r.useState(0),[C,h]=r.useState(0),[G,y]=r.useState(!1),[S,R]=r.useState(120),[p,i]=r.useState([]),[u,b]=r.useState(!1),[U,T]=r.useState(!1),[$,E]=r.useState(null),[L,g]=r.useState([]),m=r.useRef(null),v=r.useRef(null),x=r.useRef(null),[f,M]=r.useState([]),c=r.useRef([]),j=r.useRef(!1);r.useEffect(()=>{(async()=>{const t=await _();t&&t.length>0&&(M(t),c.current=new Array(t.length).fill(null))})()},[]),r.useEffect(()=>{f.length>0&&(c.current=c.current.slice(0,f.length))},[f]);const A=q(),N=[0,1,2,3,4,5];r.useEffect(()=>(u&&(v.current=setInterval(()=>{R(e=>e-1)},1e3),m.current=setInterval(()=>{const e=Array.from({length:1},()=>({id:Date.now()+Math.random(),top:0,lane:N[Math.floor(Math.random()*N.length)]}));i(t=>[...t,...e])},500)),()=>{v.current&&clearInterval(v.current),m.current&&clearInterval(m.current)}),[u]),r.useEffect(()=>{S===0&&(b(!1),T(!0),m.current&&clearInterval(m.current),setTimeout(()=>{A("/rhythm/result",{state:{score:n},replace:!0}),I()},1e3))},[S,A,n]);const I=()=>{d(0),h(0),R(120),i([]),T(!1),g([]),c.current.forEach(e=>{e&&(e.pause(),e.currentTime=0)})},k=()=>{I(),b(!0),c.current[0]&&c.current[0].play()},H=e=>{e<c.current.length-1&&c.current[e+1]&&c.current[e+1].play()},w=e=>{if(j.current){j.current=!1;return}E(e),setTimeout(()=>E(null),300);const t=p.findIndex(o=>o.lane===e&&Math.abs(o.top-90)<10);if(t!==-1){const o=p[t];if(L.includes(o.id))return;d(a=>a+10),h(a=>a+1),P(),i(a=>{const l=[...a];return l[t]={...o,exploding:!0},l}),g(a=>[...a,o.id]),setTimeout(()=>{g(a=>a.filter(l=>l!==o.id))},300),setTimeout(()=>{i(a=>a.filter(l=>l.id!==o.id))},200)}else h(0)},D=e=>{j.current=!0,w(e)},P=()=>{y(!0),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{y(!1)},1e3)};r.useEffect(()=>{if(u){const e=setInterval(z,100);return()=>clearInterval(e)}},[u]);const z=()=>{i(e=>e.map(t=>({...t,top:t.top+5})).filter(t=>t.top<100||t.exploding))};return s.jsxs("div",{className:"RhythmGame",children:[U&&s.jsx("div",{className:"loadingSpinner",children:s.jsx(F,{})})," ",f.map((e,t)=>s.jsx("audio",{ref:o=>{c.current[t]=o},src:e,onEnded:()=>H(t)},t)),s.jsxs("div",{className:"gameHeader",children:[s.jsx("div",{className:"gameStart",children:s.jsx("button",{onClick:k,disabled:u,children:"Start"})}),s.jsx("div",{className:"gameScoreTime",children:s.jsxs("p",{children:["Score: ",n]})})]}),s.jsxs("div",{className:"gameBoard",children:[N.map((e,t)=>s.jsxs("div",{className:`lane lane${t} ${$===t?"lightingEffect":""}`,onTouchStart:()=>D(t),onMouseDown:()=>w(t),children:[s.jsx("div",{className:"hitArea secondary"}),s.jsx("div",{className:"hitArea primary"})]},t)),p.map(e=>s.jsx(J,{note:e,exploding:e.exploding||!1},e.id))]}),G&&s.jsxs("div",{className:"comboDisplay",children:["Combo ",s.jsx("br",{})," ",C]})]})},ee=()=>s.jsxs("div",{className:"RhythmGamePage",children:[s.jsx(B,{}),s.jsx("div",{className:"rhythm-header",children:s.jsx("div",{className:"rhythm-game",children:s.jsx(K,{})})})]});export{ee as default};
