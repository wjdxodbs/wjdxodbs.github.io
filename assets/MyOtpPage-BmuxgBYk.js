import{c as u,r as o,a as x,j as t,M as m,m as h}from"./index-BFfqBe_w.js";import{H as v}from"./Header-gY4_XGT7.js";import{T as j,t as f}from"./toastMsg-BFcdgC3S.js";import"./iconBase-DhHVUUgp.js";import"./AddressContent-Aj_TjtZn.js";const y=u(),g=async()=>{try{const{data:e}=await y.get("/users/watch/otp");return{data:e}}catch(e){throw e}},E=()=>{const[e,n]=o.useState(""),[r,c]=o.useState(0),i="https://throwng-dev.store",d=x(),l=async()=>{var s;try{const a=await g();p(),n(a.data),c(60),setTimeout(()=>{n(""),c(0)},6e4)}catch(a){h.isAxiosError(a)&&((s=a.response)==null?void 0:s.status)===429&&f("너무 많은 요청을 보냈습니다. 잠시 후에 다시 시도해주세요.")}},p=()=>{const s=new EventSource(`${i}/api/users/connect`);return s.addEventListener("WatchAuthentication",a=>{a.data==="success"&&(s.close(),alert("연동이 완료되었어요. 마이쓰롱으로 이동할게요."),d("/user/mypage",{replace:!0}))}),s.onerror=()=>{s.close()},s};return o.useEffect(()=>{if(r>0){const s=setInterval(()=>{c(r-1)},1e3);return()=>clearInterval(s)}},[r]),t.jsxs("div",{className:"MyOtpBody",children:[t.jsxs("div",{className:"otp-title",children:[e?t.jsx("div",{className:"otp-number",children:e}):t.jsx("div",{className:"otp-no-result",children:"발급된 번호가 없습니다"}),t.jsxs("div",{className:"otp-desc",children:[t.jsx("div",{children:"60초 내에 발급된 번호를"}),t.jsx("div",{children:"워치 화면에 입력해주세요"}),e!==""&&t.jsxs("div",{children:["유효시간 : ",r,"초"]})]})]}),t.jsx(m,{onClick:l,btnText:"발급받기"}),t.jsx(j,{})]})},T=()=>t.jsxs("div",{className:"OtpPage",children:[t.jsx(v,{centerText:"연동하기"}),t.jsx("div",{className:"body",children:t.jsx(E,{})})]});export{T as default};
