import{r,j as e,a as C}from"./index-CGewvLaj.js";import{a as v,I as Q}from"./index-DCmRDguf.js";import{a as I,c as N}from"./common-BDZuGjqk.js";import{u as y}from"./useQuizRedirect-u-OcclHA.js";import"./iconBase-PVZmbQCF.js";import"./ContentApi-CnZkIcLU.js";const E=({onUserInput:t,setCanSubmit:n,question:s,choices:a,index:d,previewUrl:u})=>{const[h,m]=r.useState(null),[i,p]=r.useState(!0),c=r.useRef(null);r.useEffect(()=>{console.log(a)},[a]),r.useEffect(()=>{c.current&&c.current.play()},[i]),r.useEffect(()=>{m(null)},[s]);const z=l=>{m(l),t(l),n(!0)},j=()=>{c.current&&(i?c.current.pause():c.current.play(),p(!i))};return e.jsxs("div",{className:"QuizMultipleChoice",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("h2",{children:["Q",d+1,"."]}),u&&e.jsxs("div",{className:"quiz-audio",onClick:j,children:[i?e.jsx(v,{}):e.jsx(Q,{}),e.jsx("audio",{ref:c,muted:i,src:u})]})]}),e.jsx("div",{className:"mc-question",children:e.jsx("p",{children:s})}),e.jsx("div",{className:"mc-choice",children:Object.entries(a).map(([l,x])=>e.jsx("div",{className:`choice ${h===l?"selected":""}`,onClick:()=>z(l),children:x},l))})]})},b="/assets/o-CzCdy8yD.webp",A="/assets/x-C_HdehgS.webp",M=({setCanSubmit:t,question:n,index:s})=>{const[a,d]=r.useState("");r.useEffect(()=>{d(""),t(!1)},[s]);const u=h=>{d(h),t(!0)};return e.jsxs("div",{className:"QuizOX",children:[e.jsxs("h2",{children:["Q",s+1,"."]}),e.jsx("div",{className:"ox-question",children:e.jsx("p",{children:n})}),e.jsxs("div",{className:"ox-answers",children:[e.jsx("div",{className:`o-answer ${a==="O"?"selected":""}`,onClick:()=>u("O"),children:e.jsx("img",{src:b,alt:"O"})}),e.jsx("div",{className:`x-answer ${a==="X"?"selected":""}`,onClick:()=>u("X"),children:e.jsx("img",{src:A,alt:"X"})})]})]})},k=({onUserInput:t,setCanSubmit:n,question:s,index:a,previewUrl:d,quizImage:u})=>{const[h,m]=r.useState(""),[i,p]=r.useState(!0),c=r.useRef(null);r.useEffect(()=>{m(""),c.current&&c.current.play()},[a,i]);const z=l=>{const x=l.target.value;m(x),n(x.trim()!==""),t(x.trim())},j=()=>{c.current&&(i?c.current.pause():c.current.play(),p(!i))};return e.jsxs("div",{className:"QuizSubjective",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("h2",{children:["Q",a+1,"."]}),d&&e.jsxs("div",{className:"quiz-audio",onClick:j,children:[i?e.jsx(v,{}):e.jsx(Q,{}),e.jsx("audio",{ref:c,muted:i,src:d})]})]}),e.jsxs("div",{className:"sub-question",children:[e.jsx("p",{children:s}),u&&e.jsx("img",{src:u,alt:"Quiz related image"})]}),e.jsx("h2",{children:"정답 입력"}),e.jsx("input",{type:"text",placeholder:"정답을 입력 해 주세요.",className:"sub-answer",value:h,onChange:z})]})},O=({timeLeft:t,setTimeLeft:n})=>(r.useEffect(()=>{const s=setInterval(()=>{n(a=>a>0?a-1:(clearInterval(s),0))},1e3);return()=>clearInterval(s)},[n]),e.jsxs("div",{className:"QuizTimeBar",children:[e.jsx("div",{className:`quiz-timer-bar ${t===0?"timeout":""}`}),e.jsx("div",{className:"quiz-timer",children:t})]})),q=I(),X=async()=>{var t;try{return(await q.get("/quizzes/list")).data}catch(n){throw N.isAxiosError(n)?console.error("Axios error:",((t=n.response)==null?void 0:t.data)||n.message):console.error("Unexpected error:",n),n}},R=async t=>{var n;try{return console.log(t),await q.post("/quizzes/result",t)}catch(s){throw console.log(s),N.isAxiosError(s)?console.error("Failed to post quiz result:",((n=s.response)==null?void 0:n.data)||s.message):console.error("Error posting quiz result:",s),s}};function B(){const[t,n]=r.useState(0),[s,a]=r.useState([]),[d,u]=r.useState(!1),[h,m]=r.useState(20),[i,p]=r.useState(null),c=C();y();const z=o=>{p(o)};r.useEffect(()=>{(async()=>{const f=await X();console.log(f),a(f)})()},[]),r.useEffect(()=>{s.length>0&&t>=s.length&&c("/quiz/success",{state:{quizPassed:!0},replace:!0})},[t,c,s]),r.useEffect(()=>{h===0&&(j(null),c("/quiz/fail",{replace:!0}))},[h,c]),r.useEffect(()=>{u(i!==null)},[i]);const j=async(o=i)=>{o===null&&(o=null);const w={quizId:s[t].quizId,submit:o};try{const g=await R(w);console.log(g),g.data.status?x():l()}catch(g){console.error("Failed to submit the quiz:",g),l()}},l=()=>{c("/quiz/fail",{replace:!0})},x=()=>{m(20),p(null),u(!1),n(t+1)},S=()=>{if(!s.length||t>=s.length)return e.jsx("div",{});const o=s[t],f={onUserInput:z,setTimeLeft:m,setCanSubmit:u,question:o.question,choices:o.choice,index:t,previewUrl:o.previewUrl,quizImage:o.quizImage};switch(o.quizType){case"객관식":return e.jsx(E,{...f});case"주관식":return e.jsx(k,{...f});case"OX":return e.jsx(M,{...f});default:return null}};return e.jsxs("div",{className:"QuizSolvePage",children:[e.jsx(O,{timeLeft:h,setTimeLeft:m},t),S(),d&&e.jsx("button",{onClick:()=>j(),className:"submission-button",children:"제출"})]})}export{B as default};
