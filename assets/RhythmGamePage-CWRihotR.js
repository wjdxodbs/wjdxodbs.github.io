import{r,a as H,j as s}from"./index-D0mAKFMI.js";import{H as P}from"./Header-CM0D3EN-.js";import{a as k}from"./common-gnwGuZx5.js";import{L as z}from"./Loading-C1C8Y75N.js";import"./iconBase-C_JQmlxO.js";import"./AddressContent-CIN8wtB4.js";const V=k(),q=async()=>{try{return(await V.get("/quizzes/contents/rhythm")).data}catch(c){return console.error("Failed to fetch song preview URLs:",c),null}},B=()=>{const[c,x]=r.useState(0),[I,f]=r.useState(0),[w,j]=r.useState(!1),[N,S]=r.useState(120),[h,l]=r.useState([]),[i,y]=r.useState(!1),[G,b]=r.useState(!1),[C,E]=r.useState(null),u=r.useRef(null),p=r.useRef(null),g=r.useRef(null),[m,M]=r.useState([]),a=r.useRef([]);r.useEffect(()=>{(async()=>{const t=await q();t&&t.length>0&&(M(t),a.current=new Array(t.length).fill(null))})()},[]),r.useEffect(()=>{m.length>0&&(a.current=a.current.slice(0,m.length))},[m]);const R=H(),v=[0,1,2,3,4,5];r.useEffect(()=>(i&&(p.current=setInterval(()=>{S(e=>e-1)},1e3),u.current=setInterval(()=>{const e=Array.from({length:1},()=>({id:Date.now()+Math.random(),top:0,lane:v[Math.floor(Math.random()*v.length)]}));l(t=>[...t,...e])},500)),()=>{p.current&&clearInterval(p.current),u.current&&clearInterval(u.current)}),[i]),r.useEffect(()=>{N===0&&(y(!1),b(!0),u.current&&clearInterval(u.current),setTimeout(()=>{R("/rhythm/result",{state:{score:c},replace:!0}),T()},1e3))},[N,R,c]);const T=()=>{x(0),f(0),S(120),l([]),b(!1),a.current.forEach(e=>{e&&(e.pause(),e.currentTime=0)})},U=()=>{T(),y(!0),a.current[0]&&a.current[0].play()},$=e=>{e<a.current.length-1&&a.current[e+1]&&a.current[e+1].play()},A=e=>{E(e),setTimeout(()=>E(null),300);const t=h.findIndex(n=>n.lane===e&&Math.abs(n.top-90)<10);if(t!==-1){const n=h[t];x(o=>o+10),f(o=>o+1),L(),l(o=>{const d=[...o];return d[t]={...n,exploding:!0},d}),setTimeout(()=>{l(o=>o.filter(d=>d.id!==n.id))},200)}else f(0)},L=()=>{j(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{j(!1)},1e3)};r.useEffect(()=>{if(i){const e=setInterval(D,100);return()=>clearInterval(e)}},[i]);const D=()=>{l(e=>e.map(t=>({...t,top:t.top+5})).filter(t=>t.top<100||t.exploding))};return s.jsxs("div",{className:"RhythmGame",children:[G&&s.jsx("div",{className:"loadingSpinner",children:s.jsx(z,{})})," ",m.map((e,t)=>s.jsx("audio",{ref:n=>{a.current[t]=n},src:e,onEnded:()=>$(t)},t)),s.jsxs("div",{className:"gameHeader",children:[s.jsx("div",{className:"gameStart",children:s.jsx("button",{onClick:U,disabled:i,children:"Start"})}),s.jsx("div",{className:"gameScoreTime",children:s.jsxs("p",{children:["Score: ",c]})})]}),s.jsxs("div",{className:"gameBoard",children:[v.map((e,t)=>s.jsxs("div",{className:`lane lane${t} ${C===t?"lightingEffect":""}`,onTouchStart:()=>A(t),onMouseDown:()=>A(t),children:[s.jsx("div",{className:"hitArea secondary"}),s.jsx("div",{className:"hitArea primary"})]},t)),h.map(e=>s.jsx("div",{className:`note lane${e.lane} ${e.exploding?"exploding":""}`,style:{top:`${e.top}%`,left:`${e.lane*16.66}%`}},e.id))]}),w&&s.jsxs("div",{className:"comboDisplay",children:["Combo ",s.jsx("br",{})," ",I]})]})},W=()=>s.jsxs("div",{className:"MoleGamePage",children:[s.jsx(P,{}),s.jsx("div",{className:"mole-header",children:s.jsx("div",{className:"mole-game",children:s.jsx(B,{})})})]});export{W as default};
