import{r as c,a as v,R as C,j as s}from"./index-BFfqBe_w.js";import{H as g}from"./Header-gY4_XGT7.js";import{d as i}from"./dayjs.min-h3gvUG7a.js";import{g as T,p as I}from"./MyCouponAPi-DPeD0c-7.js";import{d as M}from"./atoms-D2b0RnUF.js";import{L as S}from"./Loading-DoK-N6Ig.js";import{T as E,t}from"./toastMsg-BFcdgC3S.js";import"./iconBase-DhHVUUgp.js";import"./AddressContent-Aj_TjtZn.js";const w=()=>{const[n,h]=c.useState([]),N=v(),y=C(M),[x,d]=c.useState(!1);c.useEffect(()=>{d(!0),r()},[]);const r=async()=>{const e=await T();h(e),d(!1)},f=async e=>{const o=n.find(u=>u.couponId===e);if(!o)return;if(window.confirm(`${o.couponName}을 적용하시겠어요?`)){if(o.couponName==="닉네임 변경 쿠폰"){y(o.couponId),N("/user/mypage/change-nickname");return}if(n.some(a=>a.couponName===o.couponName&&a.couponStatus==="사용 중")){t("동일한 쿠폰을 사용중이에요");return}const m=["THROWNG_INF","THROWNG_TWICE","THROWNG_LEVEL","THROWNG_FIVE"];if(m.includes(o.couponType)&&n.some(l=>m.includes(l.couponType)&&l.couponStatus==="사용 중")){t("같은 유형의 쿠폰을 사용중이에요");return}const j={couponId:e,couponType:o.couponType};try{await I(j),r(),t("쿠폰이 정상적으로 적용되었습니다.")}catch{t("에러가 발생했습니다. 잠시 후 다시 시도해주세요.")}}};return s.jsxs("div",{className:"MyCouponBody",children:[x?s.jsx(S,{}):n.length>0?n.map(e=>{const o=Math.ceil(i(e.couponEndDate).diff(i(),"day",!0)),p=o<=1;return s.jsxs("div",{className:"coupon-body",children:[s.jsxs("div",{className:"coupon-header",children:[s.jsx("div",{className:"coupon-title",children:e.couponName}),s.jsx("div",{className:"coupon-desc",children:e.couponDescription})]}),s.jsx("div",{className:"btn-div",children:s.jsx("div",{className:`coupon-apply ${e.couponStatus==="사용 전"?"":"inactive"}`,onClick:()=>e.couponStatus==="사용 전"&&f(e.couponId),children:s.jsx("div",{className:`coupon-apply-btn ${e.couponStatus!=="사용 전"&&"coupon-apply-active"}`,children:e.couponStatus})})}),s.jsx("hr",{}),s.jsxs("div",{className:"coupon-end-date",children:[s.jsx("div",{className:`${p&&"coupon-end-date-how-imminent"}`,children:`D-${o}`}),s.jsxs("div",{className:"coupon-end-date-when",children:[i(e.couponEndDate).format("YY/MM/DD HH:mm:ss"),"까지"]})]})]},e.couponId)}):s.jsx("div",{className:"SearchedWords",children:s.jsxs("div",{className:"no-word-container",children:[s.jsx("div",{className:"title",children:"앗!"}),s.jsx("div",{className:"subtitle",children:"사용 가능한 쿠폰이 없습니다."})]})}),s.jsx(E,{})]})},k=()=>s.jsxs("div",{className:"MyCouponPage",children:[s.jsx(g,{centerText:"쿠폰함"}),s.jsx("div",{className:"body none-scroll",children:s.jsx(w,{})})]});export{k as default};
