import{r,j as e,a as I}from"./index-D0mAKFMI.js";import{a as v,I as Q}from"./index-l8ggr4mc.js";import{a as w,b as q}from"./common-gnwGuZx5.js";import"./iconBase-C_JQmlxO.js";const y=({onUserInput:t,setCanSubmit:n,question:s,choices:a,index:m,previewUrl:u})=>{const[h,l]=r.useState(null),[i,f]=r.useState(!0),c=r.useRef(null);r.useEffect(()=>{},[a]),r.useEffect(()=>{c.current&&c.current.play()},[i]),r.useEffect(()=>{l(null)},[s]);const z=d=>{l(d),t(d),n(!0)},p=()=>{c.current&&(i?c.current.pause():c.current.play(),f(!i))};return e.jsxs("div",{className:"QuizMultipleChoice",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("h2",{children:["Q",m+1,"."]}),u&&e.jsxs("div",{className:"quiz-audio",onClick:p,children:[i?e.jsx(v,{}):e.jsx(Q,{}),e.jsx("audio",{ref:c,muted:i,src:u})]})]}),e.jsx("div",{className:"mc-question",children:e.jsx("p",{children:s})}),e.jsx("div",{className:"mc-choice",children:Object.entries(a).map(([d,x])=>e.jsx("div",{className:`choice ${h===d?"selected":""}`,onClick:()=>z(d),children:x},d))})]})},E="/assets/o-CzCdy8yD.webp",b="/assets/x-C_HdehgS.webp",A=({onUserInput:t,setCanSubmit:n,question:s,index:a})=>{const[m,u]=r.useState("");r.useEffect(()=>{u(""),n(!1)},[a]);const h=l=>{u(l),n(!0),t(l)};return e.jsxs("div",{className:"QuizOX",children:[e.jsxs("h2",{children:["Q",a+1,"."]}),e.jsx("div",{className:"ox-question",children:e.jsx("p",{children:s})}),e.jsxs("div",{className:"ox-answers",children:[e.jsx("div",{className:`o-answer ${m==="O"?"selected":""}`,onClick:()=>h("O"),children:e.jsx("img",{src:E,alt:"O"})}),e.jsx("div",{className:`x-answer ${m==="X"?"selected":""}`,onClick:()=>h("X"),children:e.jsx("img",{src:b,alt:"X"})})]})]})},M=({onUserInput:t,setCanSubmit:n,question:s,index:a,previewUrl:m,quizImage:u})=>{const[h,l]=r.useState(""),[i,f]=r.useState(!0),c=r.useRef(null);r.useEffect(()=>{l(""),c.current&&c.current.play()},[a,i]);const z=d=>{const x=d.target.value;l(x),n(x.trim()!==""),t(x.trim())},p=()=>{c.current&&(i?c.current.pause():c.current.play(),f(!i))};return e.jsxs("div",{className:"QuizSubjective",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("h2",{children:["Q",a+1,"."]}),m&&e.jsxs("div",{className:"quiz-audio",onClick:p,children:[i?e.jsx(v,{}):e.jsx(Q,{}),e.jsx("audio",{ref:c,muted:i,src:m})]})]}),e.jsxs("div",{className:"sub-question",children:[e.jsx("p",{children:s}),u&&e.jsx("img",{src:u,alt:"Quiz related image"})]}),e.jsx("h2",{children:"정답 입력"}),e.jsx("input",{type:"text",placeholder:"정답을 입력 해 주세요.",className:"sub-answer",value:h,onChange:z})]})},k=({timeLeft:t,setTimeLeft:n})=>(r.useEffect(()=>{const s=setInterval(()=>{n(a=>a>0?a-1:(clearInterval(s),0))},1e3);return()=>clearInterval(s)},[n]),e.jsxs("div",{className:"QuizTimeBar",children:[e.jsx("div",{className:`quiz-timer-bar ${t===0?"timeout":""}`}),e.jsx("div",{className:"quiz-timer",children:t})]})),N=w(),O=async()=>{var t;try{return(await N.get("/quizzes/list")).data}catch(n){throw q.isAxiosError(n)?console.error("Axios error:",((t=n.response)==null?void 0:t.data)||n.message):console.error("Unexpected error:",n),n}},X=async t=>{var n;try{return await N.post("/quizzes/result",t)}catch(s){throw console.log(s),q.isAxiosError(s)?console.error("Failed to post quiz result:",((n=s.response)==null?void 0:n.data)||s.message):console.error("Error posting quiz result:",s),s}};function F(){const[t,n]=r.useState(0),[s,a]=r.useState([]),[m,u]=r.useState(!1),[h,l]=r.useState(20),[i,f]=r.useState(null),c=I(),z=o=>{f(o)};r.useEffect(()=>{(async()=>{const j=await O();a(j)})()},[]),r.useEffect(()=>{s.length>0&&t>=s.length&&c("/quiz/success",{replace:!0})},[t,c,s]),r.useEffect(()=>{h===0&&(p(null),c("/quiz/fail",{replace:!0}))},[h,c]),r.useEffect(()=>{u(i!==null)},[i]);const p=async(o=i)=>{o===null&&(o=null);const C={quizId:s[t].quizId,submit:o};try{const g=await X(C);t===s.length-1&&sessionStorage.setItem("quizCompleted","true"),g.data.status?(t===s.length-1&&sessionStorage.setItem("quizCompleted","true"),x()):d()}catch(g){console.error("Failed to submit the quiz:",g),d()}},d=()=>{c("/quiz/fail",{replace:!0})},x=()=>{l(20),f(null),u(!1),n(t+1)},S=()=>{if(!s.length||t>=s.length)return e.jsx("div",{});const o=s[t],j={onUserInput:z,setTimeLeft:l,setCanSubmit:u,question:o.question,choices:o.choice,index:t,previewUrl:o.previewUrl,quizImage:o.quizImage};switch(o.quizType){case"객관식":return e.jsx(y,{...j});case"주관식":return e.jsx(M,{...j});case"OX":return e.jsx(A,{...j});default:return null}};return e.jsxs("div",{className:"QuizSolvePage",children:[e.jsx(k,{timeLeft:h,setTimeLeft:l},t),S(),m&&e.jsx("button",{onClick:()=>p(),className:"submission-button",children:"제출"})]})}export{F as default};
