import{r as n,j as e,a as S}from"./index-CaWDm9Ot.js";import{a as g,I as Q}from"./index-DJKXSuNj.js";import{a as w,c as q}from"./common-BryWrCT5.js";import{u as C}from"./useQuizRedirect-8aMy8wCv.js";import"./iconBase-JFrjxPI2.js";import"./ContentApi-D8tHFgZA.js";const I=({onUserInput:t,setCanSubmit:r,question:s,choices:a,index:l,previewUrl:u})=>{const[d,m]=n.useState(null),[c,p]=n.useState(!0),i=n.useRef(null);n.useEffect(()=>{i.current&&i.current.play()},[c]),n.useEffect(()=>{m(null)},[s]);const f=o=>{m(o),t(o),r(!0)},j=()=>{i.current&&(c?i.current.pause():i.current.play(),p(!c))};return e.jsxs("div",{className:"QuizMultipleChoice",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("h2",{children:["Q",l+1,"."]}),u&&e.jsxs("div",{className:"quiz-audio",onClick:j,children:[c?e.jsx(g,{}):e.jsx(Q,{}),e.jsx("audio",{ref:i,muted:c,src:u})]})]}),e.jsx("div",{className:"mc-question",children:e.jsx("p",{children:s})}),e.jsx("div",{className:"mc-choice",children:a.length>0?a.map(o=>e.jsx("div",{className:`choice ${d===o.id?"selected":""}`,onClick:()=>f(o.id),children:o.text},o.id)):e.jsx("p",{})})]})},y="/assets/o-CzCdy8yD.webp",b="/assets/x-C_HdehgS.webp",E=({setCanSubmit:t,question:r,index:s})=>{const[a,l]=n.useState("");n.useEffect(()=>{l(""),t(!1)},[s]);const u=d=>{l(d),t(!0)};return e.jsxs("div",{className:"QuizOX",children:[e.jsxs("h2",{children:["Q",s+1,"."]}),e.jsx("div",{className:"ox-question",children:e.jsx("p",{children:r})}),e.jsxs("div",{className:"ox-answers",children:[e.jsx("div",{className:`o-answer ${a==="O"?"selected":""}`,onClick:()=>u("O"),children:e.jsx("img",{src:y,alt:"O"})}),e.jsx("div",{className:`x-answer ${a==="X"?"selected":""}`,onClick:()=>u("X"),children:e.jsx("img",{src:b,alt:"X"})})]})]})},A=({onUserInput:t,setCanSubmit:r,question:s,index:a,previewUrl:l,quizImage:u})=>{const[d,m]=n.useState(""),[c,p]=n.useState(!0),i=n.useRef(null);n.useEffect(()=>{m(""),i.current&&i.current.play()},[a,c]);const f=o=>{const z=o.target.value;m(z),r(z.trim()!==""),t(z.trim())},j=()=>{i.current&&(c?i.current.pause():i.current.play(),p(!c))};return e.jsxs("div",{className:"QuizSubjective",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("h2",{children:["Q",a+1,"."]}),l&&e.jsxs("div",{className:"quiz-audio",onClick:j,children:[c?e.jsx(g,{}):e.jsx(Q,{}),e.jsx("audio",{ref:i,muted:c,src:l})]})]}),e.jsxs("div",{className:"sub-question",children:[e.jsx("p",{children:s}),u&&e.jsx("img",{src:u,alt:"Quiz related image"})]}),e.jsx("h2",{children:"정답 입력"}),e.jsx("input",{type:"text",placeholder:"정답을 입력 해 주세요.",className:"sub-answer",value:d,onChange:f})]})},M=({timeLeft:t,setTimeLeft:r})=>(n.useEffect(()=>{const s=setInterval(()=>{r(a=>a>0?a-1:(clearInterval(s),0))},1e3);return()=>clearInterval(s)},[r]),e.jsxs("div",{className:"QuizTimeBar",children:[e.jsx("div",{className:`quiz-timer-bar ${t===0?"timeout":""}`}),e.jsx("div",{className:"quiz-timer",children:t})]})),N=w(),k=async()=>{var t;try{return(await N.get("/quizzes/list")).data}catch(r){throw q.isAxiosError(r)?console.error("Axios error:",((t=r.response)==null?void 0:t.data)||r.message):console.error("Unexpected error:",r),r}},O=async t=>{var r;try{return await N.post("/quizzes/result",t)}catch(s){throw q.isAxiosError(s)?console.error("Failed to post quiz result:",((r=s.response)==null?void 0:r.data)||s.message):console.error("Error posting quiz result:",s),s}};function T(){const[t,r]=n.useState(0),[s,a]=n.useState([]),[l,u]=n.useState(!1),[d,m]=n.useState(20),[c,p]=n.useState(null),i=S();C();const f=x=>{p(x)};n.useEffect(()=>{(async()=>{const h=await k();a(h)})()},[]),n.useEffect(()=>{s.length>0&&t>=s.length&&i("/quiz/success",{state:{quizPassed:!0},replace:!0})},[t,i,s]),n.useEffect(()=>{d===0&&i("/quiz/fail",{replace:!0})},[d,i]);const j=async()=>{if(!c)return;const h={quizId:s[t].quizId,submit:c};try{(await O(h)).status?o():i("/quiz/fail",{replace:!0})}catch(v){console.error("Failed to submit the quiz:",v),i("/quiz/fail",{replace:!0})}},o=()=>{m(20),p(null),u(!1),r(t+1)},z=()=>{if(!s.length||t>=s.length)return e.jsx("div",{});const x=s[t],h={onUserInput:f,setTimeLeft:m,setCanSubmit:u,question:x.question,choices:x.choice,index:t,previewUrl:x.previewUrl,quizImage:x.quizImage};switch(x.quizType){case"객관식":return e.jsx(I,{...h});case"주관식":return e.jsx(A,{...h});case"OX":return e.jsx(E,{...h});default:return null}};return e.jsxs("div",{className:"QuizSolvePage",children:[e.jsx(M,{timeLeft:d,setTimeLeft:m},t),z(),l&&e.jsx("button",{onClick:j,className:"submission-button",children:"제출"})]})}export{T as default};
