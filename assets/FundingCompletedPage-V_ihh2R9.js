import{j as e,r as o,d as p,G as m}from"./index-DH76QrY1.js";import{a as c}from"./commons-D5rr2GKD.js";import{N as y}from"./NoneNavHeader-D6iMIN4Z.js";import{U as j}from"./UserFundProgressBar-IFIt9MPk.js";import{P as w}from"./Prompt-B6cIy6gb.js";import{N as b}from"./NoneData-CexJgTaz.js";import{L as N}from"./Loading-C-b2YYv0.js";import"./axios-Bo0ATomq.js";import"./index-B2g7cyBY.js";import"./iconBase-DQP2xcrS.js";import"./index-R6LbOZZC.js";import"./ModalButton-N8o5GNtv.js";import"./profileImg-Fhzvd9kH.js";const g=({state:t,handleChange:s,value:n,text:l})=>e.jsxs("label",{className:`flex-1 flex items-center justify-center text-[2vh] cursor-pointer ${t===n&&"border-t-2 border-t-transparent border-b-2 border-b-red-600 font-bold text-white"}`,children:[e.jsx("input",{checked:t===n,value:n,name:"fund_state",type:"radio",className:"hidden input",onChange:s}),l]}),C=({state:t,handleChange:s})=>e.jsxs("div",{className:"w-[100%] h-[5vh] flex border-b-[1px] border-b-red-600 text-textGray",children:[e.jsx(g,{state:t,handleChange:s,value:"success",text:"펀딩성공"}),e.jsx(g,{state:t,handleChange:s,value:"fail",text:"펀딩실패"})]}),I=({item:t})=>{const[s,n]=o.useState(!1),[l,i]=o.useState(!1),d=p(),u=()=>d(`/fund/list/${t.movieId}`,{state:{type:"list"}}),f=async()=>{try{const a=await c().get(`/reservations/get/${t.reservationId}`);console.log(a),d(`/user/ticket/${a.data.number}`,{state:a.data})}catch(a){console.log(a)}},v=async()=>{try{const a=await c().put(`/reservations/cancel/${t.reservationId}`,null);console.log(a),i(!1),n(!1)}catch(a){console.log(a)}},x=a=>{const r=new Date,h=new Date(a);return r.setHours(0,0,0,0),h.setHours(0,0,0,0),(h.getTime()-r.getTime())/(1e3*60*60)/24};return o.useEffect(()=>{(async()=>{try{const r=await c().get(`/reservations/get/${t.reservationId}`);console.log(r),i(!0)}catch(r){console.log(r)}})()},[]),e.jsxs("div",{className:"flex flex-col bg-bgGray p-[2vh] rounded-lg gap-[2vh] shadow-test",children:[e.jsxs("div",{className:"w-full flex gap-[2vh]",children:[e.jsx("img",{className:"w-[9vh] h-[13vh] object-cover rounded-md cursor-pointer",src:t.poster,alt:"",loading:"lazy",onClick:u}),e.jsxs("div",{className:"relative flex flex-col justify-between w-full",children:[e.jsxs("div",{className:"flex items-center w-full gap-[2vh] ",children:[e.jsx("div",{className:"flex-1 text-[2.5vh] font-bold w-0 overflow-hidden text-ellipsis whitespace-nowrap cursor-pointer",onClick:u,children:t.title}),e.jsx("div",{className:"text-[1.5vh] text-textGray",children:`${m(t.date)}`})]}),e.jsx(j,{type:"success-bar",attendCnt:t.attendCnt,goalCnt:t.goalCnt})]})]}),l&&e.jsxs("div",{className:"flex gap-[1vh]",children:[x(t.date)>1&&e.jsx("button",{className:"flex-1 p-[1vh] border border-textGray rounded-lg text-[2vh]",onClick:()=>n(!0),children:"좌석취소"}),e.jsx("button",{className:"flex-1 p-[1vh] border border-textGray rounded-lg text-[2vh]",onClick:f,children:"티켓확인"})]}),s&&e.jsx(w,{onClose:()=>n(!1),onConfirm:v})]})},k=({successData:t})=>t.length?e.jsx(e.Fragment,{children:t.map(s=>e.jsx(I,{item:s},s.reservationId))}):e.jsx(b,{content:"성공한 펀딩이 없습니다."}),F=({item:t})=>{const s=p(),n=()=>s(`/fund/list/${t.movieId}`,{state:{type:"list"}});return e.jsx("div",{className:"flex flex-col bg-bgGray p-[2vh] rounded-lg gap-[2vh] shadow-test",children:e.jsxs("div",{className:"w-full flex gap-[2vh]",children:[e.jsx("img",{className:"w-[9vh] h-[13vh] object-cover rounded-md cursor-pointer",src:t.poster,alt:"",loading:"lazy",onClick:n}),e.jsxs("div",{className:"relative flex flex-col justify-between w-full ",children:[e.jsxs("div",{className:"flex items-center w-full gap-[3vh] ",children:[e.jsx("div",{className:"flex-1 text-[2.5vh] font-bold w-0 overflow-hidden text-ellipsis whitespace-nowrap cursor-pointer",onClick:n,children:t.title}),e.jsx("div",{className:" text-[1.5vh] text-textGray",children:`${m(t.date)}`})]}),e.jsx(j,{type:"fail-bar",attendCnt:t.attendCnt,goalCnt:t.goalCnt})]})]})})},D=({failData:t})=>e.jsx(e.Fragment,{children:t.length?t.map(s=>e.jsx(F,{item:s},s.movieId)):e.jsx(b,{content:"실패한 펀딩이 없습니다."})}),W=()=>{const[t,s]=o.useState("success"),[n,l]=o.useState([]),[i,d]=o.useState([]),[u,f]=o.useState(!0),v=x=>{s(x.target.value)};return o.useEffect(()=>{(async()=>{try{const[a,r]=await Promise.all([c().get("/fundings/result/success"),c().get("/fundings/result/failure")]);l(a.data),d(r.data)}catch(a){console.log(a)}finally{f(!1)}})()},[]),e.jsxs("div",{className:"FundingCompletedPage",children:[e.jsx(y,{centerText:"애프터 무딩"}),e.jsx(C,{state:t,handleChange:v}),u?e.jsx(N,{}):e.jsx("div",{className:"none-scroll h-[88vh] overflow-auto p-[3vh] flex flex-col gap-[3vh] relative",children:t==="success"?e.jsx(k,{successData:n}):e.jsx(D,{failData:i})})]})};export{W as default};
