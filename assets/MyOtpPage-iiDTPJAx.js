import{b as u,r as n,a as x,j as s,M as h,o as m,H as v}from"./index-B9D3YrLj.js";import{T as j,t as f}from"./toastMsg-CQ3Va584.js";const y=u(),g=async()=>{try{const{data:e}=await y.get("/users/watch/otp");return{data:e}}catch(e){throw e}},E=()=>{const[e,o]=n.useState(""),[r,c]=n.useState(0),i="https://throwng.store",d=x(),l=async()=>{var t;try{const a=await g();p(),o(a.data),c(60),setTimeout(()=>{o(""),c(0)},6e4)}catch(a){m.isAxiosError(a)&&((t=a.response)==null?void 0:t.status)===429&&f("너무 많은 요청을 보냈습니다. 잠시 후에 다시 시도해주세요.")}},p=()=>{const t=new EventSource(`${i}/api/users/connect`);return t.addEventListener("WatchAuthentication",a=>{a.data==="success"&&(t.close(),alert("연동이 완료되었어요. 마이쓰롱으로 이동할게요."),d("/user/mypage",{replace:!0}))}),t.onerror=()=>{t.close()},()=>{t.close()}};return n.useEffect(()=>{if(r>0){const t=setInterval(()=>{c(r-1)},1e3);return()=>clearInterval(t)}},[r]),s.jsxs("div",{className:"MyOtpBody",children:[s.jsxs("div",{className:"otp-title",children:[e?s.jsx("div",{className:"otp-number",children:e}):s.jsx("div",{className:"otp-no-result",children:"발급된 번호가 없습니다"}),s.jsxs("div",{className:"otp-desc",children:[s.jsx("div",{children:"60초 내에 발급된 번호를"}),s.jsx("div",{children:"워치 화면에 입력해주세요"}),e!==""&&s.jsxs("div",{children:["유효시간 : ",r,"초"]})]})]}),s.jsx(h,{onClick:l,btnText:"발급받기"}),s.jsx(j,{})]})},O=()=>s.jsxs("div",{className:"OtpPage",children:[s.jsx(v,{centerText:"연동하기"}),s.jsx("div",{className:"body",children:s.jsx(E,{})})]});export{O as default};
