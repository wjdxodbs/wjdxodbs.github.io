import{d as L,i as F,j as e,r as b,R as y,e as m,f as S,u as de,b as ue}from"./index-soGWsI4E.js";import{a as O}from"./axios-L6U4YIEh.js";import{s as H,a as ee,m as D,c as P,f as z,b as q,d as A,e as B,g as V}from"./FishingMapStore-CT2y4axp.js";import{d as he,a as pe}from"./InfoOutlined-tRhdRHS9.js";import{M as ve}from"./marker_place_off-DaVJSVdB.js";import{u as ge,M as se,a as me,b as xe,c as fe}from"./marker_place-m1omeIcH.js";import{F as je}from"./index-7QcinMer.js";import"./iconBase-u21VGtxB.js";var T={},Me=F;Object.defineProperty(T,"__esModule",{value:!0});var te=T.default=void 0,Ce=Me(L()),_e=e;te=T.default=(0,Ce.default)((0,_e.jsx)("path",{d:"M7 6h10l-5.01 6.3zm-2.75-.39C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAltOutlined");const be=async()=>{try{return(await O.get("https://grpc-proxy-server-mkvo6j4wsq-du.a.run.app/v1/regcodes?regcode_pattern=*00000000")).data.regcodes.filter(j=>j.name!=="제주특별자치도")}catch(t){console.log(t)}},ke=({hashTags:t,mapRef:j,getDistance:g})=>{const[M,x]=b.useState([]),[h,r]=b.useState(!1),[n,f]=y(H),[p,d]=y(ee),k=m(D),o=m(P),N=m(z),R=m(q),$=S(A),w=s=>{const l=j.current;l&&(l.setLevel(13),l.setCenter(new kakao.maps.LatLng(36.172823447489336,127.8675122717897)),k(13),o(!1),R(null))},u=async s=>{try{const i=(await O.get("https://i10c203.p.ssafy.io/api/spots",{params:s})).data.spots.map(_=>{const I=g($.center.lat,$.center.lng,_==null?void 0:_.latitude,_==null?void 0:_.longitude);return{..._,dist:I}});N(i),w()}catch(l){console.log(l)}},v=s=>{s.preventDefault();let l={};n==="location"||n==="hash"?l.keyword=s.type==="submit"?n==="location"?p:`#${p}`:`#${s.target.value}`:l.sido=s.target.value,u(l)},C=s=>{f(s.target.value),r(!1),d("")},c=async()=>{try{const s=await be();x(s)}catch{console.log(err)}},a=b.useMemo(()=>t.map((s,l)=>e.jsxs("div",{className:"input-container",children:[e.jsx("input",{id:`${s}`,className:"radio-button",type:"radio",name:"radio",checked:p===s.substring(1),value:s.substring(1),onChange:i=>{d(i.target.value),v(i)}}),e.jsx("div",{className:"radio-tile",children:e.jsx("label",{htmlFor:`${s}`,className:"radio-tile-label",children:s})})]},l)),[t,p]);return b.useEffect(()=>{c()},[]),e.jsxs("div",{className:`FishMapHeader ${n==="hash"&&"expand"}`,children:[e.jsxs("div",{className:`wrapper ${n==="hash"&&"expand"}`,children:[e.jsxs("div",{className:"wrapper1",children:[e.jsx("input",{type:"checkbox",id:"toogle",className:"hidden-trigger",checked:h,onChange:()=>r(!h)}),e.jsx("label",{htmlFor:"toogle",className:"circle",children:e.jsx(te,{})}),e.jsxs("div",{className:"subs",children:[e.jsxs("button",{className:"sub-circle",children:[e.jsx("input",{value:"location",name:"sub-circle",type:"radio",id:"sub1",className:"hidden-sub-trigger",onClick:C}),e.jsx("label",{htmlFor:"sub1",children:"장소"})]}),e.jsxs("button",{className:"sub-circle",children:[e.jsx("input",{value:"region",name:"sub-circle",type:"radio",id:"sub2",className:"hidden-sub-trigger",onClick:C}),e.jsx("label",{htmlFor:"sub2",children:"지역"})]}),e.jsxs("button",{className:"sub-circle",children:[e.jsx("input",{value:"hash",name:"sub-circle",type:"radio",id:"sub3",className:"hidden-sub-trigger",onClick:C}),e.jsx("label",{htmlFor:"sub3",children:"해쉬태그"})]})]})]}),n==="region"?e.jsx(e.Fragment,{children:e.jsxs("select",{value:p,onChange:s=>{v(s),d(s.target.value)},children:[e.jsx("option",{value:"",disabled:!0,children:"지역선택"}),M.map(s=>e.jsx("option",{value:s.name,children:s.name},s.code))]})}):e.jsx("form",{onSubmit:v,children:e.jsx("input",{type:"text",placeholder:n==="location"?"장소 검색":"해시태그 검색",value:p,onChange:s=>d(s.target.value)})}),e.jsx("div",{className:"search",onClick:()=>d(""),children:p&&e.jsx(he,{})})]}),n&&e.jsx("div",{className:"hashTags",children:a})]})};var G={},Ne=F;Object.defineProperty(G,"__esModule",{value:!0});var ae=G.default=void 0,ye=Ne(L()),$e=e;ae=G.default=(0,ye.default)((0,$e.jsx)("path",{d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99"}),"Call");const Le=({value:t,isActive:j,onClick:g,getDistance:M})=>{const x=S(A),h=m(B),r=m(D),n=ge(),f=de(),p=o=>{n.panTo(o.getPosition()),g()},d=b.useMemo(()=>M(x.center.lat,x.center.lng,t.latitude,t.longitude),[x,t]),k=()=>{const o=n.getCenter();h({lat:o.getLat(),lng:o.getLng()}),r(n.getLevel()),f(`/fish/map/${t.spotId}`)};return e.jsxs(e.Fragment,{children:[e.jsx(se,{position:{lat:t.latitude,lng:t.longitude},onClick:p,image:j?{src:me,size:{width:28,height:40}}:{src:ve,size:{width:18,height:25}}}),j&&e.jsxs("div",{className:"info",children:[e.jsxs("div",{className:"info_header",children:[e.jsx("div",{className:"info_name",onClick:k,children:t.name}),e.jsx("div",{className:"info_type",children:t.spotType})]}),e.jsxs("div",{className:"info_body",children:[e.jsx("div",{className:"info_distance",children:d>=1?`${d.toFixed(1)}km`:`${(d/1e3).toFixed()}`}),e.jsx("div",{className:"info_addr",children:t.streetAddress})]}),e.jsxs("div",{className:"info_footer",children:[e.jsx("hr",{}),e.jsxs("div",{className:"info_icons",children:[t.spotPhone&&e.jsx("a",{href:`tel:${t.spotPhone}`,children:e.jsx(ae,{})}),e.jsx(je,{})]})]})]})]})};var U={},Fe=F;Object.defineProperty(U,"__esModule",{value:!0});var ne=U.default=void 0,Se=Fe(L()),Re=e;ne=U.default=(0,Se.default)((0,Re.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7"}),"GpsFixed");var J={},we=F;Object.defineProperty(J,"__esModule",{value:!0});var re=J.default=void 0,Ae=we(L()),Ie=e;re=J.default=(0,Ae.default)((0,Ie.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"RefreshOutlined");const Oe=({mapRef:t,getDistance:j,openList:g})=>{const[M,x]=y(P),[h,r]=y(q),[n,f]=y(A),[p,d]=y(B),[k,o]=y(z),N=S(D),R=m(V),$=async()=>{const u=t.current;if(!u)return;const v=u.getCenter();try{const c=(await O.get("https://i10c203.p.ssafy.io/api/spots",{params:{latitude:v.getLat(),longitude:v.getLng()}})).data.spots.map(a=>{const s=j(v.getLat(),v.getLng(),a==null?void 0:a.latitude,a==null?void 0:a.longitude);return s<=20?{...a,dist:s}:null}).filter(Boolean);o(c),u.setCenter(v),x(!1),r(null),R("dist"),d({lat:v.getLat(),lng:v.getLng()})}catch(C){console.log(C)}},w=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(u=>{const v=u.coords.latitude,C=u.coords.longitude,c=new kakao.maps.LatLng(v,C);t.current.setCenter(c),x(!1),f(a=>({...a,center:{lat:v,lng:C},isLoading:!0}))}):window.alert("이 브라우저에서는 Geolocation을 지원하지 않습니다.")};return e.jsxs("div",{className:"FishMapBody",children:[M&&!g&&e.jsxs("div",{className:"reSearch",onClick:$,children:[e.jsx(re,{}),"이 지역 검색"]}),e.jsxs(xe,{center:p,ref:t,level:N,onClick:()=>r(null),onCenterChanged:()=>x(!0),children:[e.jsx(fe,{minLevel:11,averageCenter:!0,children:k.map((u,v)=>e.jsx(Le,{value:u,isActive:h===u.spotId,onClick:()=>r(u.spotId),getDistance:j},u.spotId))}),n.isLoading&&e.jsx(se,{position:n.center,clickable:!0,image:{src:"https://cdn4.iconfinder.com/data/icons/small-n-flat/24/map-marker-512.png",size:{width:25,height:25}}}),!g&&e.jsx("button",{style:{bottom:h!==null?"19vh":"3vh"},className:"FishMap_btn bg-blue",onClick:w,children:e.jsx(ne,{})})]})]})};var K={},De=F;Object.defineProperty(K,"__esModule",{value:!0});var oe=K.default=void 0,Pe=De(L()),ze=e;oe=K.default=(0,Pe.default)((0,ze.jsx)("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"}),"FormatListBulleted");var Q={},qe=F;Object.defineProperty(Q,"__esModule",{value:!0});var ce=Q.default=void 0,Ee=qe(L()),He=e;ce=Q.default=(0,Ee.default)((0,He.jsx)("path",{d:"m20.5 3-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5M10 5.47l4 1.4v11.66l-4-1.4zm-5 .99 3-1.01v11.7l-3 1.16zm14 11.08-3 1.01V6.86l3-1.16z"}),"MapOutlined");var W={},Be=F;Object.defineProperty(W,"__esModule",{value:!0});var le=W.default=void 0,Ve=Be(L()),Te=e;le=W.default=(0,Ve.default)((0,Te.jsx)("path",{d:"m7 10 5 5 5-5z"}),"ArrowDropDownOutlined");var X={},Ge=F;Object.defineProperty(X,"__esModule",{value:!0});var E=X.default=void 0,Ue=Ge(L()),Je=e;E=X.default=(0,Ue.default)((0,Je.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"CheckOutlined");const Ke=({item:t,idx:j,mapRef:g,getDistance:M,setOpenList:x})=>{const h=S(A),r=m(q),n=m(P),f=b.useMemo(()=>M(h.center.lat,h.center.lng,t.latitude,t.longitude),[]),p=()=>{x(!1),r(t.spotId);const d=new kakao.maps.LatLng(t.latitude,t.longitude);g.current.setLevel(4),g.current.setCenter(d),n(!1)};return e.jsxs("div",{className:"item",children:[e.jsxs("div",{className:"item-head",children:[e.jsx("div",{className:"fishing-name",onClick:p,children:t.name}),e.jsx("div",{className:"fishing-type",children:t.spotType})]}),e.jsxs("div",{className:"item-body",children:[e.jsx("div",{className:"fishing-dist",children:f>=1?`${f.toFixed(1)}km`:`${(f/1e3).toFixed()}m`}),e.jsx("div",{className:"fishing-addr",children:t.streetAddress||t.localAddress})]}),e.jsxs("div",{className:"fishing-exp",children:[t.charge,"원"]})]})},Qe=({mapRef:t,getDistance:j,openList:g,setOpenList:M})=>{const[x,h]=b.useState(!1),[r,n]=y(V),f=S(z),p=S(H),d=o=>{h(!1),n(o)},k=b.useMemo(()=>f.toSorted((o,N)=>r==="dist"?o.dist-N.dist:o.charge-N.charge),[r,f]);return e.jsxs("div",{className:`FishMapFooter ${g&&"expand"}`,children:[e.jsxs("div",{className:`fishing-content ${g&&"expand"}`,style:{height:g&&p==="hash"&&"74.5vh"},children:[e.jsxs("button",{className:"filter",onClick:()=>h(!0),children:[r==="dist"?"거리순":"비용순",e.jsx(le,{})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"filter-open",onClick:()=>h(!1)}),e.jsxs("div",{className:"filter-content",children:[e.jsx("h2",{children:"검색 설정"}),e.jsx("div",{className:"filter-b",children:e.jsxs("button",{className:`${r==="dist"?"pick":""}`,onClick:()=>d("dist"),children:["거리순"," ",e.jsx("div",{children:r==="dist"&&e.jsx(E,{})})]})}),e.jsx("div",{className:"filter-b",children:e.jsxs("button",{className:`${r==="money"?"pick":""}`,onClick:()=>d("money"),children:["비용순",e.jsx("div",{children:r==="money"&&e.jsx(E,{})})]})}),e.jsx("div",{children:e.jsx("button",{className:"cancel",onClick:()=>h(!1),children:"취소"})})]})]}),e.jsx("div",{className:"fishing-list",children:f.length?k.map((o,N)=>e.jsx(Ke,{item:o,idx:N,mapRef:t,setOpenList:M,getDistance:j},o.spotId)):e.jsxs("div",{className:"noneData",children:[e.jsx(pe,{}),e.jsx("div",{children:"조건에 맞는 낚시터가 없습니다."})]})})]}),e.jsx("div",{className:"mode",onClick:()=>M(o=>!o),children:g?e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsx("div",{children:"지도보기"})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsx("div",{children:"목록보기"})]})})]})},We=["#사진맛집","#노을맛집","#월척","#물반고기반","#산책하기좋은곳"],cs=()=>{const t=m(ee),j=m(V),g=m(P),M=m(A),x=m(z),h=m(H),r=m(D),[n,f]=y(B),[p,d]=y(q),[k,o]=b.useState(!1),N="https://i10c203.p.ssafy.io";localStorage.getItem("jwt");const R=ue(),$=b.useRef(null),w=(c,a)=>{f({lat:c,lng:a}),d(null),t(""),j("dist"),h("location"),r(9)},u=(c,a,s,l)=>{const i=ie=>ie*(Math.PI/180),I=i(s-c),Y=i(l-a),Z=Math.sin(I/2)*Math.sin(I/2)+Math.cos(i(c))*Math.cos(i(s))*Math.sin(Y/2)*Math.sin(Y/2);return 6371*(2*Math.atan2(Math.sqrt(Z),Math.sqrt(1-Z)))},v=async(c,a)=>{try{const l=(await O.get(`${N}/api/spots`,{params:{latitude:c,longitude:a}},{headers:{Authorization:localStorage.getItem("jwt"),"Content-Type":"application/json"}})).data.spots.map(i=>{const _=u(c,a,i==null?void 0:i.latitude,i==null?void 0:i.longitude);return _<=20?{...i,dist:_}:null}).filter(Boolean);x(l)}catch(s){console.log(s)}},C=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(c=>{var l;const{latitude:a,longitude:s}=c.coords;M(i=>({...i,center:{lat:a,lng:s},isLoading:!0})),g(!1),(!n.lat&&!n.lng||!((l=R.state)!=null&&l.data))&&(v(a,s),w(a,s))},c=>{console.log(c),M(a=>({...a,errMsg:c.message,isLoading:!1}))}):M(c=>({...c,errMsg:"geolocation을 사용할수 없어요..",isLoading:!1}))};return b.useEffect(()=>{C()},[]),e.jsxs("div",{className:"FishMap",children:[e.jsx(ke,{hashTags:We,mapRef:$,getDistance:u}),e.jsx(Oe,{openList:k,mapRef:$,getDistance:u}),p===null&&e.jsx(Qe,{openList:k,setOpenList:o,mapRef:$,getDistance:u})]})};export{cs as default};
