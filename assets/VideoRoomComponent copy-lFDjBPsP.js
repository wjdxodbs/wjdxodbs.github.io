var br=Object.defineProperty;var Sr=(i,t,e)=>t in i?br(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Le=(i,t,e)=>(Sr(i,typeof t!="symbol"?t+"":t,e),e);import{c as W,r as ee,l as yr,j as H,d as zt,i as Xt,u as wr,b as Or}from"./index-soGWsI4E.js";import{a as mt}from"./axios-L6U4YIEh.js";import{d as Cr,a as Rr}from"./InfoOutlined-tRhdRHS9.js";import{p as Bi}from"./default_profile-HTeSV8ma.js";import{d as _r}from"./Send-FuytjnMe.js";import{L as Ir}from"./Loading-COiwx65b.js";import{G as Pr}from"./iconBase-u21VGtxB.js";var $i={},Wn={};(function(i){var t=W&&W.__extends||function(){var n=function(r,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(s[d]=c[d])},n(r,o)};return function(r,o){n(r,o);function s(){this.constructor=r}r.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}}();function e(n){if(!n)return e.__;Array.prototype.reduce||(Array.prototype.reduce=function(s,c){for(var d=c,a=0;a<this.length;a++)d=s(d,this[a],a,this);return d});var r="",o=("."+n).split(".").reduce(function(s,c,d,a){r?r+="."+c:r=c;var f=s["__"+r];return f===void 0&&(e.Logger.prototype=s,f=new e.Logger(r),s["__"+r]=f),f},e.__);return o}(function(n){n.requestId="",n.entryId=0,n._createXMLHttpRequest=function(){return new XMLHttpRequest},n._getTime=function(){return new Date().getTime()},n._console=console,n._appenderNames=[];function r(h,l,p){if(l[h]!==void 0){if(l[h]===null){delete p[h];return}p[h]=l[h]}}function o(h){if(n.enabled!=null&&!n.enabled)return!1;try{if(h.userAgentRegex&&!new RegExp(h.userAgentRegex).test(navigator.userAgent))return!1}catch{}try{if(h.ipRegex&&n.clientIP&&!new RegExp(h.ipRegex).test(n.clientIP))return!1}catch{}return!0}function s(h,l){try{if(h.disallow&&new RegExp(h.disallow).test(l))return!1}catch{}return!0}function c(h){return typeof h=="function"?h instanceof RegExp?h.toString():h():h}var d=function(){function h(l,p,R){this.msg=l,this.meta=p,this.finalString=R}return h}();function a(h){var l=c(h),p;switch(typeof l){case"string":return new d(l,null,l);case"number":return p=l.toString(),new d(p,null,p);case"boolean":return p=l.toString(),new d(p,null,p);case"undefined":return new d("undefined",null,"undefined");case"object":return l instanceof RegExp||l instanceof String||l instanceof Number||l instanceof Boolean?(p=l.toString(),new d(p,null,p)):(typeof n.serialize=="function"?p=n.serialize.call(this,l):p=JSON.stringify(l),new d("",l,p));default:return new d("unknown",null,"unknown")}}function f(h){return r("enabled",h,this),r("maxMessages",h,this),r("defaultAjaxUrl",h,this),r("clientIP",h,this),r("requestId",h,this),r("defaultBeforeSend",h,this),r("serialize",h,this),this}n.setOptions=f;function v(){return-2147483648}n.getAllLevel=v;function m(){return 1e3}n.getTraceLevel=m;function O(){return 2e3}n.getDebugLevel=O;function _(){return 3e3}n.getInfoLevel=_;function P(){return 4e3}n.getWarnLevel=P;function y(){return 5e3}n.getErrorLevel=y;function b(){return 6e3}n.getFatalLevel=b;function k(){return 2147483647}n.getOffLevel=k;function T(h){return h<=1e3?"trace":h<=2e3?"debug":h<=3e3?"info":h<=4e3?"warn":h<=5e3?"error":"fatal"}var I=function(){function h(l,p){this.inner=p,this.name="JL.Exception",this.message=a(l).finalString}return h}();n.Exception=I,I.prototype=new Error;var M=function(){function h(l,p,R,C,N){this.l=l,this.m=p,this.n=R,this.t=C,this.u=N}return h}();n.LogItem=M;function D(h,l,p){return n.entryId++,new M(h,l,p,n._getTime(),n.entryId)}function z(h){h.id&&(clearTimeout(h.id),h.id=null)}function g(h,l,p){var R=this;h.id||(h.id=setTimeout(function(){p.call(R)},l))}var x=function(){function h(l,p){this.appenderName=l,this.sendLogItems=p,this.level=n.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var R="Trying to create an appender without a name or with an empty name";if(l==null)throw R;if(n._appenderNames.indexOf(l)!=-1)throw l?"Multiple appenders use the same name "+l:R;n._appenderNames.push(l)}return h.prototype.addLogItemsToBuffer=function(l){if(this.batchBuffer.length>=this.maxBatchSize){this.nbrLogItemsSkipped+=l.length;return}if(n.maxMessages!=null){if(n.maxMessages<1)return;n.maxMessages-=l.length}this.batchBuffer=this.batchBuffer.concat(l);var p=this;g(this.batchTimeoutTimer,this.batchTimeout,function(){p.sendBatch.call(p)})},h.prototype.batchBufferHasOverdueMessages=function(){for(var l=0;l<this.batchBuffer.length;l++){var p=n._getTime()-this.batchBuffer[l].t;if(p>this.batchTimeout)return!0}return!1},h.prototype.batchBufferHasStrandedMessage=function(){return n.maxMessages!=null&&n.maxMessages<1&&this.batchBuffer.length>0},h.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},h.prototype.onSendingEnded=function(){z(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},h.prototype.setOptions=function(l){if(r("level",l,this),r("ipRegex",l,this),r("userAgentRegex",l,this),r("disallow",l,this),r("sendWithBufferLevel",l,this),r("storeInBufferLevel",l,this),r("bufferSize",l,this),r("batchSize",l,this),r("maxBatchSize",l,this),r("batchTimeout",l,this),r("sendTimeout",l,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new n.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},h.prototype.log=function(l,p,R,C,N,A,G){var F;if(o(this)&&s(this,A)&&!(N<this.storeInBufferLevel)){if(F=D(N,A,G),N<this.level){this.bufferSize>0&&(this.buffer.push(F),this.buffer.length>this.bufferSize&&this.buffer.shift());return}this.addLogItemsToBuffer([F]),N>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete()}},h.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)&&(z(this.batchTimeoutTimer),this.batchBuffer.length!=0)){this.nbrLogItemsBeingSent=this.batchBuffer.length;var l=this;g(this.sendTimeoutTimer,this.sendTimeout,function(){l.onSendingEnded.call(l)}),this.sendLogItems(this.batchBuffer,function(){l.batchBuffer.splice(0,l.nbrLogItemsBeingSent),l.nbrLogItemsSkipped>0&&(l.batchBuffer.push(D(P(),"Lost "+l.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",l.appenderName)),l.nbrLogItemsSkipped=0),l.onSendingEnded.call(l)})}},h}();n.Appender=x;var q=function(h){t(l,h);function l(p){return h.call(this,p,l.prototype.sendLogItemsAjax)||this}return l.prototype.setOptions=function(p){return r("url",p,this),r("beforeSend",p,this),h.prototype.setOptions.call(this,p),this},l.prototype.sendLogItemsAjax=function(p,R){try{if(!o(this))return;this.xhr&&this.xhr.readyState!=0&&this.xhr.readyState!=4&&this.xhr.abort(),this.xhr=n._createXMLHttpRequest();var C="/jsnlog.logger";n.defaultAjaxUrl!=null&&(C=n.defaultAjaxUrl),this.url&&(C=this.url),this.xhr.open("POST",C),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",n.requestId);var N=this;this.xhr.onreadystatechange=function(){N.xhr.readyState==4&&N.xhr.status>=200&&N.xhr.status<300&&R()};var A={r:n.requestId,lg:p};typeof this.beforeSend=="function"?this.beforeSend.call(this,this.xhr,A):typeof n.defaultBeforeSend=="function"&&n.defaultBeforeSend.call(this,this.xhr,A);var G=JSON.stringify(A);this.xhr.send(G)}catch{}},l}(x);n.AjaxAppender=q;var B=function(h){t(l,h);function l(p){return h.call(this,p,l.prototype.sendLogItemsConsole)||this}return l.prototype.clog=function(p){n._console.log(p)},l.prototype.cerror=function(p){n._console.error?n._console.error(p):this.clog(p)},l.prototype.cwarn=function(p){n._console.warn?n._console.warn(p):this.clog(p)},l.prototype.cinfo=function(p){n._console.info?n._console.info(p):this.clog(p)},l.prototype.cdebug=function(p){n._console.debug?n._console.debug(p):this.cinfo(p)},l.prototype.sendLogItemsConsole=function(p,R){try{if(!o(this)||!n._console)return;var C;for(C=0;C<p.length;++C){var N=p[C],A=N.n+": "+N.m;typeof window>"u"&&(A=new Date(N.t)+" | "+A),N.l<=n.getDebugLevel()?this.cdebug(A):N.l<=n.getInfoLevel()?this.cinfo(A):N.l<=n.getWarnLevel()?this.cwarn(A):this.cerror(A)}}catch{}R()},l}(x);n.ConsoleAppender=B;var L=function(){function h(l){this.loggerName=l,this.seenRegexes=[]}return h.prototype.setOptions=function(l){return r("level",l,this),r("userAgentRegex",l,this),r("disallow",l,this),r("ipRegex",l,this),r("appenders",l,this),r("onceOnly",l,this),this.seenRegexes=[],this},h.prototype.buildExceptionObject=function(l){var p={};return l.stack?p.stack=l.stack:p.e=l,l.message&&(p.message=l.message),l.name&&(p.name=l.name),l.data&&(p.data=l.data),l.inner&&(p.inner=this.buildExceptionObject(l.inner)),p},h.prototype.log=function(l,p,R){var C=0,N,A;if(!this.appenders)return this;if(l>=this.level&&o(this)&&(R?(A=this.buildExceptionObject(R),A.logData=c(p)):A=p,N=a(A),s(this,N.finalString))){if(this.onceOnly)for(C=this.onceOnly.length-1;C>=0;){if(new RegExp(this.onceOnly[C]).test(N.finalString)){if(this.seenRegexes[C])return this;this.seenRegexes[C]=!0}C--}for(N.meta=N.meta||{},C=this.appenders.length-1;C>=0;)this.appenders[C].log(T(l),N.msg,N.meta,function(){},l,N.finalString,this.loggerName),C--}return this},h.prototype.trace=function(l){return this.log(m(),l)},h.prototype.debug=function(l){return this.log(O(),l)},h.prototype.info=function(l){return this.log(_(),l)},h.prototype.warn=function(l){return this.log(P(),l)},h.prototype.error=function(l){return this.log(y(),l)},h.prototype.fatal=function(l){return this.log(b(),l)},h.prototype.fatalException=function(l,p){return this.log(b(),l,p)},h}();n.Logger=L;function u(h){return new q(h)}n.createAjaxAppender=u;function E(h){return new B(h)}n.createConsoleAppender=E;var w;typeof window<"u"?w=new q(""):w=new B(""),n.__=new n.Logger(""),n.__.setOptions({level:n.getDebugLevel(),appenders:[w]})})(e||(e={})),i.__esModule=!0,i.JL=e,typeof __jsnlog_configure=="function"&&__jsnlog_configure(e),typeof window<"u"&&!window.onerror&&(window.onerror=function(n,r,o,s,c){return e("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:n?n.message||n:"",url:r,"line number":o,column:s},c),!1}),typeof window<"u"&&!window.onunhandledrejection&&(window.onunhandledrejection=function(n){e("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:n.reason?n.reason.message:n.message||null},n.reason)})})(Wn);var Jt={},wt={},Hn={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.LocalRecorderState=void 0,function(t){t.READY="READY",t.RECORDING="RECORDING",t.PAUSED="PAUSED",t.FINISHED="FINISHED"}(i.LocalRecorderState||(i.LocalRecorderState={}))})(Hn);var Ee={},Kt={};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.ConsoleLogger=void 0;var Tr=function(){function i(t){this.logger=t,this.log=t.log,this.info=t.info,this.debug=t.debug,this.warn=t.warn,this.error=t.error}return i}();Kt.ConsoleLogger=Tr;var qn={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.OpenViduLoggerConfiguration=void 0,function(t){t.disabled="disabled",t.debug="debug",t.debug_app="debug_app"}(i.OpenViduLoggerConfiguration||(i.OpenViduLoggerConfiguration={}))})(qn);Object.defineProperty(Ee,"__esModule",{value:!0});Ee.OpenViduLogger=void 0;var xe=Wn,xr=Kt,bn=qn,kr=function(){function i(){this.JSNLOG_URL="/openvidu/elk/openvidu-browser-logs",this.MAX_JSNLOG_BATCH_LOG_MESSAGES=100,this.MAX_MSECONDS_BATCH_MESSAGES=5e3,this.MAX_LENGTH_STRING_JSON=1e3,this.defaultConsoleLogger=new xr.ConsoleLogger(globalThis.console),this.isProdMode=!1,this.isJSNLogSetup=!1}return i.configureJSNLog=function(t,e){var n=this;try{if(globalThis.LOG_JSNLOG_RESULTS||this.instance&&t.isAtLeastPro&&this.instance.isOpenViduBrowserLogsDebugActive(t)&&this.instance.canConfigureJSNLog(t,this.instance)){t.sendBrowserLogs===bn.OpenViduLoggerConfiguration.debug_app&&this.instance.replaceWindowConsole(),this.instance.isJSNLogSetup=!1,this.instance.info("Configuring JSNLogs.");var r=t.finalUserId,o=t.session.sessionId,s=function(d){var a=d.onreadystatechange;d.onreadystatechange=function(){n.isInvalidResponse(d)&&(Object.defineProperty(d,"readyState",{value:4}),Object.defineProperty(d,"status",{value:200}),n.instance.disableLogger()),a()},d.setRequestHeader("Authorization","Basic "+btoa("".concat(r,"%/%").concat(o)+":"+e)),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("OV-Final-User-Id",r),d.setRequestHeader("OV-Session-Id",o),d.setRequestHeader("OV-Token",e)};this.instance.currentAppender=xe.JL.createAjaxAppender("appender-".concat(r,"-").concat(o)),this.instance.currentAppender.setOptions({beforeSend:s,maxBatchSize:1e3,batchSize:this.instance.MAX_JSNLOG_BATCH_LOG_MESSAGES,batchTimeout:this.instance.MAX_MSECONDS_BATCH_MESSAGES});var c=function(d){var a=function(){var v=new WeakSet;return function(m,O){if(typeof O=="object"&&O!=null){if(v.has(O)||globalThis.HTMLElement&&O instanceof HTMLElement)return;v.add(O)}return O}},f=JSON.stringify(d,a());return f.length>n.instance.MAX_LENGTH_STRING_JSON&&(f="".concat(f.substring(0,n.instance.MAX_LENGTH_STRING_JSON),"...")),globalThis.LOG_JSNLOG_RESULTS&&console.log(f),f};xe.JL.setOptions({defaultAjaxUrl:t.httpUri+this.instance.JSNLOG_URL,serialize:c,enabled:!0}),(0,xe.JL)().setOptions({appenders:[this.instance.currentAppender]}),this.instance.isJSNLogSetup=!0,this.instance.loggingSessionId=o,this.instance.info("JSNLog configured.")}}catch(d){console.error("Error configuring JSNLog: "),console.error(d),this.instance.disableLogger()}},i.getInstance=function(){return i.instance||(i.instance=new i),i.instance},i.isInvalidResponse=function(t){return t.status==401||t.status==403||t.status==404||t.status==0},i.prototype.canConfigureJSNLog=function(t,e){return t.session.sessionId!=e.loggingSessionId},i.prototype.isOpenViduBrowserLogsDebugActive=function(t){return t.sendBrowserLogs===bn.OpenViduLoggerConfiguration.debug||t.sendBrowserLogs===bn.OpenViduLoggerConfiguration.debug_app},i.prototype.getConsoleWithJSNLog=function(){return function(t){return{log:function(){t.defaultConsoleLogger.log.apply(t.defaultConsoleLogger.logger,arguments),t.isJSNLogSetup&&(0,xe.JL)().info(arguments)},info:function(){t.defaultConsoleLogger.info.apply(t.defaultConsoleLogger.logger,arguments),t.isJSNLogSetup&&(0,xe.JL)().info(arguments)},debug:function(){t.defaultConsoleLogger.debug.apply(t.defaultConsoleLogger.logger,arguments)},warn:function(){t.defaultConsoleLogger.warn.apply(t.defaultConsoleLogger.logger,arguments),t.isJSNLogSetup&&(0,xe.JL)().warn(arguments)},error:function(){t.defaultConsoleLogger.error.apply(t.defaultConsoleLogger.logger,arguments),t.isJSNLogSetup&&(0,xe.JL)().error(arguments)}}}(this)},i.prototype.replaceWindowConsole=function(){globalThis.console=this.defaultConsoleLogger.logger,globalThis.console.log=this.getConsoleWithJSNLog().log,globalThis.console.info=this.getConsoleWithJSNLog().info,globalThis.console.debug=this.getConsoleWithJSNLog().debug,globalThis.console.warn=this.getConsoleWithJSNLog().warn,globalThis.console.error=this.getConsoleWithJSNLog().error},i.prototype.disableLogger=function(){xe.JL.setOptions({enabled:!1}),this.isJSNLogSetup=!1,this.loggingSessionId=void 0,this.currentAppender=void 0,globalThis.console=this.defaultConsoleLogger.logger,globalThis.console.log=this.defaultConsoleLogger.log,globalThis.console.info=this.defaultConsoleLogger.info,globalThis.console.debug=this.defaultConsoleLogger.debug,globalThis.console.warn=this.defaultConsoleLogger.warn,globalThis.console.error=this.defaultConsoleLogger.error},i.prototype.log=function(){this.isProdMode||this.defaultConsoleLogger.log.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,xe.JL)().info(arguments)},i.prototype.debug=function(){this.isProdMode||this.defaultConsoleLogger.debug.apply(this.defaultConsoleLogger.logger,arguments)},i.prototype.info=function(){this.isProdMode||this.defaultConsoleLogger.info.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,xe.JL)().info(arguments)},i.prototype.warn=function(){this.defaultConsoleLogger.warn.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,xe.JL)().warn(arguments)},i.prototype.error=function(){this.defaultConsoleLogger.error.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,xe.JL)().error(arguments)},i.prototype.flush=function(){this.isJSNLogSetup&&this.currentAppender!=null&&this.currentAppender.sendBatch()},i.prototype.enableProdMode=function(){this.isProdMode=!0},i}();Ee.OpenViduLogger=kr;var Ne={},Wt={exports:{}};/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */Wt.exports;(function(i,t){(function(){var e={function:!0,object:!0},n=e[typeof window]&&window||this,r=t,o=i&&!i.nodeType&&i,s=r&&o&&typeof W=="object"&&W;s&&(s.global===s||s.window===s||s.self===s)&&(n=s);var c=Math.pow(2,53)-1,d=/\bOpera/,a=Object.prototype,f=a.hasOwnProperty,v=a.toString;function m(g){return g=String(g),g.charAt(0).toUpperCase()+g.slice(1)}function O(g,x,q){var B={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return x&&q&&/^Win/i.test(g)&&!/^Windows Phone /i.test(g)&&(B=B[/[\d.]+$/.exec(g)])&&(g="Windows "+B),g=String(g),x&&q&&(g=g.replace(RegExp(x,"i"),q)),g=P(g.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),g}function _(g,x){var q=-1,B=g?g.length:0;if(typeof B=="number"&&B>-1&&B<=c)for(;++q<B;)x(g[q],q,g);else y(g,x)}function P(g){return g=M(g),/^(?:webOS|i(?:OS|P))/.test(g)?g:m(g)}function y(g,x){for(var q in g)f.call(g,q)&&x(g[q],q,g)}function b(g){return g==null?m(g):v.call(g).slice(8,-1)}function k(g,x){var q=g!=null?typeof g[x]:"number";return!/^(?:boolean|number|string|undefined)$/.test(q)&&(q=="object"?!!g[x]:!0)}function T(g){return String(g).replace(/([ -])(?!$)/g,"$1?")}function I(g,x){var q=null;return _(g,function(B,L){q=x(q,B,L,g)}),q}function M(g){return String(g).replace(/^ +| +$/g,"")}function D(g){var x=n,q=g&&typeof g=="object"&&b(g)!="String";q&&(x=g,g=null);var B=x.navigator||{},L=B.userAgent||"";g||(g=L);var u=q?!!B.likeChrome:/\bChrome\b/.test(g)&&!/internal|\n/i.test(v.toString()),E="Object",w=q?E:"ScriptBridgingProxyObject",h=q?E:"Environment",l=q&&x.java?"JavaPackage":b(x.java),p=q?E:"RuntimeObject",R=/\bJava/.test(l)&&x.java,C=R&&b(x.environment)==h,N=R?"a":"α",A=R?"b":"β",G=x.document||{},F=x.operamini||x.opera,te=d.test(te=q&&F?F["[[Class]]"]:b(F))?te:F=null,S,ne=g,X=[],de=null,le=g==L,j=le&&F&&typeof F.version=="function"&&F.version(),pe,Q=vn([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),V=pt(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),K=At([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),se=gn({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),U=En(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function vn(fe){return I(fe,function(Y,J){return Y||RegExp("\\b"+(J.pattern||T(J))+"\\b","i").exec(g)&&(J.label||J)})}function gn(fe){return I(fe,function(Y,J,we){return Y||(J[K]||J[/^[a-z]+(?: +[a-z]+\b)*/i.exec(K)]||RegExp("\\b"+T(we)+"(?:\\b|\\w*\\d)","i").exec(g))&&we})}function pt(fe){return I(fe,function(Y,J){return Y||RegExp("\\b"+(J.pattern||T(J))+"\\b","i").exec(g)&&(J.label||J)})}function En(fe){return I(fe,function(Y,J){var we=J.pattern||T(J);return!Y&&(Y=RegExp("\\b"+we+"(?:/[\\d.]+|[ \\w.]*)","i").exec(g))&&(Y=O(Y,we,J.label||J)),Y})}function At(fe){return I(fe,function(Y,J){var we=J.pattern||T(J);return!Y&&(Y=RegExp("\\b"+we+" *\\d+[.\\w_]*","i").exec(g)||RegExp("\\b"+we+" *\\w+-[\\w]*","i").exec(g)||RegExp("\\b"+we+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(g))&&((Y=String(J.label&&!RegExp(we,"i").test(J.label)?J.label:Y).split("/"))[1]&&!/[\d.]+/.test(Y[0])&&(Y[0]+=" "+Y[1]),J=J.label||J,Y=P(Y[0].replace(RegExp(we,"i"),J).replace(RegExp("; *(?:"+J+"[_-])?","i")," ").replace(RegExp("("+J+")[-_.]?(\\w)","i"),"$1 $2"))),Y})}function ce(fe){return I(fe,function(Y,J){return Y||(RegExp(J+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(g)||0)[1]||null})}function me(){return this.description||""}if(Q&&(Q=[Q]),/\bAndroid\b/.test(U)&&!K&&(S=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(g))&&(K=M(S[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),se&&!K?K=At([se]):se&&K&&(K=K.replace(RegExp("^("+T(se)+")[-_.\\s]","i"),se+" ").replace(RegExp("^("+T(se)+")[-_.]?(\\w)","i"),se+" $2")),(S=/\bGoogle TV\b/.exec(K))&&(K=S[0]),/\bSimulator\b/i.test(g)&&(K=(K?K+" ":"")+"Simulator"),V=="Opera Mini"&&/\bOPiOS\b/.test(g)&&X.push("running in Turbo/Uncompressed mode"),V=="IE"&&/\blike iPhone OS\b/.test(g)?(S=D(g.replace(/like iPhone OS/,"")),se=S.manufacturer,K=S.product):/^iP/.test(K)?(V||(V="Safari"),U="iOS"+((S=/ OS ([\d_]+)/i.exec(g))?" "+S[1].replace(/_/g,"."):"")):V=="Konqueror"&&/^Linux\b/i.test(U)?U="Kubuntu":se&&se!="Google"&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(g)||/\bVita\b/.test(K))||/\bAndroid\b/.test(U)&&/^Chrome/.test(V)&&/\bVersion\//i.test(g)?(V="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):V=="Silk"?(/\bMobi/i.test(g)||(U="Android",X.unshift("desktop mode")),/Accelerated *= *true/i.test(g)&&X.unshift("accelerated")):V=="UC Browser"&&/\bUCWEB\b/.test(g)?X.push("speed mode"):V=="PaleMoon"&&(S=/\bFirefox\/([\d.]+)\b/.exec(g))?X.push("identifying as Firefox "+S[1]):V=="Firefox"&&(S=/\b(Mobile|Tablet|TV)\b/i.exec(g))?(U||(U="Firefox OS"),K||(K=S[1])):!V||(S=!/\bMinefield\b/i.test(g)&&/\b(?:Firefox|Safari)\b/.exec(V))?(V&&!K&&/[\/,]|^[^(]+?\)/.test(g.slice(g.indexOf(S+"/")+8))&&(V=null),(S=K||se||U)&&(K||se||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:S)+" Browser")):V=="Electron"&&(S=(/\bChrome\/([\d.]+)\b/.exec(g)||0)[1])&&X.push("Chromium "+S),j||(j=ce(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",T(V),"(?:Firefox|Minefield|NetFront)"])),(S=Q=="iCab"&&parseFloat(j)>3&&"WebKit"||/\bOpera\b/.test(V)&&(/\bOPR\b/.test(g)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(g)&&!/^(?:Trident|EdgeHTML)$/.test(Q)&&"WebKit"||!Q&&/\bMSIE\b/i.test(g)&&(U=="Mac OS"?"Tasman":"Trident")||Q=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(Q=[S]),V=="IE"&&(S=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(g)||0)[1])?(V+=" Mobile",U="Windows Phone "+(/\+$/.test(S)?S:S+".x"),X.unshift("desktop mode")):/\bWPDesktop\b/i.test(g)?(V="IE Mobile",U="Windows Phone 8.x",X.unshift("desktop mode"),j||(j=(/\brv:([\d.]+)/.exec(g)||0)[1])):V!="IE"&&Q=="Trident"&&(S=/\brv:([\d.]+)/.exec(g))&&(V&&X.push("identifying as "+V+(j?" "+j:"")),V="IE",j=S[1]),le){if(k(x,"global"))if(R&&(S=R.lang.System,ne=S.getProperty("os.arch"),U=U||S.getProperty("os.name")+" "+S.getProperty("os.version")),C){try{j=x.require("ringo/engine").version.join("."),V="RingoJS"}catch{(S=x.system)&&S.global.system==x.system&&(V="Narwhal",U||(U=S[0].os||null))}V||(V="Rhino")}else typeof x.process=="object"&&!x.process.browser&&(S=x.process)&&(typeof S.versions=="object"&&(typeof S.versions.electron=="string"?(X.push("Node "+S.versions.node),V="Electron",j=S.versions.electron):typeof S.versions.nw=="string"&&(X.push("Chromium "+j,"Node "+S.versions.node),V="NW.js",j=S.versions.nw)),V||(V="Node.js",ne=S.arch,U=S.platform,j=/[\d.]+/.exec(S.version),j=j?j[0]:null));else b(S=x.runtime)==w?(V="Adobe AIR",U=S.flash.system.Capabilities.os):b(S=x.phantom)==p?(V="PhantomJS",j=(S=S.version||null)&&S.major+"."+S.minor+"."+S.patch):typeof G.documentMode=="number"&&(S=/\bTrident\/(\d+)/i.exec(g))?(j=[j,G.documentMode],(S=+S[1]+4)!=j[1]&&(X.push("IE "+j[1]+" mode"),Q&&(Q[1]=""),j[1]=S),j=V=="IE"?String(j[1].toFixed(1)):j[0]):typeof G.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(V)&&(X.push("masking as "+V+" "+j),V="IE",j="11.0",Q=["Trident"],U="Windows");U=U&&P(U)}if(j&&(S=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j)||/(?:alpha|beta)(?: ?\d)?/i.exec(g+";"+(le&&B.appMinorVersion))||/\bMinefield\b/i.test(g)&&"a")&&(de=/b/i.test(S)?"beta":"alpha",j=j.replace(RegExp(S+"\\+?$"),"")+(de=="beta"?A:N)+(/\d+\+?/.exec(S)||"")),V=="Fennec"||V=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(U))V="Firefox Mobile";else if(V=="Maxthon"&&j)j=j.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(K))K=="Xbox 360"&&(U=null),K=="Xbox 360"&&/\bIEMobile\b/.test(g)&&X.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(V)||V&&!K&&!/Browser|Mobi/.test(V))&&(U=="Windows CE"||/Mobi/i.test(g)))V+=" Mobile";else if(V=="IE"&&le)try{x.external===null&&X.unshift("platform preview")}catch{X.unshift("embedded")}else(/\bBlackBerry\b/.test(K)||/\bBB10\b/.test(g))&&(S=(RegExp(K.replace(/ +/g," *")+"/([.\\d]+)","i").exec(g)||0)[1]||j)?(S=[S,/BB10/.test(g)],U=(S[1]?(K=null,se="BlackBerry"):"Device Software")+" "+S[0],j=null):this!=y&&K!="Wii"&&(le&&F||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(g)||V=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(U)||V=="IE"&&(U&&!/^Win/.test(U)&&j>5.5||/\bWindows XP\b/.test(U)&&j>8||j==8&&!/\bTrident\b/.test(g)))&&!d.test(S=D.call(y,g.replace(d,"")+";"))&&S.name&&(S="ing as "+S.name+((S=S.version)?" "+S:""),d.test(V)?(/\bIE\b/.test(S)&&U=="Mac OS"&&(U=null),S="identify"+S):(S="mask"+S,te?V=P(te.replace(/([a-z])([A-Z])/g,"$1 $2")):V="Opera",/\bIE\b/.test(S)&&(U=null),le||(j=null)),Q=["Presto"],X.push(S));(S=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(g)||0)[1])&&(S=[parseFloat(S.replace(/\.(\d)$/,".0$1")),S],V=="Safari"&&S[1].slice(-1)=="+"?(V="WebKit Nightly",de="alpha",j=S[1].slice(0,-1)):(j==S[1]||j==(S[2]=(/\bSafari\/([\d.]+\+?)/i.exec(g)||0)[1]))&&(j=null),S[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(g)||0)[1],S[0]==537.36&&S[2]==537.36&&parseFloat(S[1])>=28&&Q=="WebKit"&&(Q=["Blink"]),!le||!u&&!S[1]?(Q&&(Q[1]="like Safari"),S=(S=S[0],S<400?1:S<500?2:S<526?3:S<533?4:S<534?"4+":S<535?5:S<537?6:S<538?7:S<601?8:S<602?9:S<604?10:S<606?11:S<608?12:"12")):(Q&&(Q[1]="like Chrome"),S=S[1]||(S=S[0],S<530?1:S<532?2:S<532.05?3:S<533?4:S<534.03?5:S<534.07?6:S<534.1?7:S<534.13?8:S<534.16?9:S<534.24?10:S<534.3?11:S<535.01?12:S<535.02?"13+":S<535.07?15:S<535.11?16:S<535.19?17:S<536.05?18:S<536.1?19:S<537.01?20:S<537.11?"21+":S<537.13?23:S<537.18?24:S<537.24?25:S<537.36?26:Q!="Blink"?"27":"28")),Q&&(Q[1]+=" "+(S+=typeof S=="number"?".x":/[.+]/.test(S)?"":"+")),V=="Safari"&&(!j||parseInt(j)>45)?j=S:V=="Chrome"&&/\bHeadlessChrome/i.test(g)&&X.unshift("headless")),V=="Opera"&&(S=/\bzbov|zvav$/.exec(U))?(V+=" ",X.unshift("desktop mode"),S=="zvav"?(V+="Mini",j=null):V+="Mobile",U=U.replace(RegExp(" *"+S+"$"),"")):V=="Safari"&&/\bChrome\b/.exec(Q&&Q[1])?(X.unshift("desktop mode"),V="Chrome Mobile",j=null,/\bOS X\b/.test(U)?(se="Apple",U="iOS 4.3+"):U=null):/\bSRWare Iron\b/.test(V)&&!j&&(j=ce("Chrome")),j&&j.indexOf(S=/[\d.]+$/.exec(U))==0&&g.indexOf("/"+S+"-")>-1&&(U=M(U.replace(S,""))),U&&U.indexOf(V)!=-1&&!RegExp(V+" OS").test(U)&&(U=U.replace(RegExp(" *"+T(V)+" *"),"")),Q&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||V!="Safari"&&/^iOS/.test(U)&&/\bSafari\b/.test(Q[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(V)&&Q[1])&&(S=Q[Q.length-1])&&X.push(S),X.length&&(X=["("+X.join("; ")+")"]),se&&K&&K.indexOf(se)<0&&X.push("on "+se),K&&X.push((/^on /.test(X[X.length-1])?"":"on ")+K),U&&(S=/ ([\d.+]+)$/.exec(U),pe=S&&U.charAt(U.length-S[0].length-1)=="/",U={architecture:32,family:S&&!pe?U.replace(S[0],""):U,version:S?S[1]:null,toString:function(){var fe=this.version;return this.family+(fe&&!pe?" "+fe:"")+(this.architecture==64?" 64-bit":"")}}),(S=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(ne))&&!/\bi686\b/i.test(ne)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+S),"")),V&&(/\bWOW64\b/i.test(g)||le&&/\w(?:86|32)$/.test(B.cpuClass||B.platform)&&!/\bWin64; x64\b/i.test(g))&&X.unshift("32-bit")):U&&/^OS X/.test(U.family)&&V=="Chrome"&&parseFloat(j)>=39&&(U.architecture=64),g||(g=null);var he={};return he.description=g,he.layout=Q&&Q[0],he.manufacturer=se,he.name=V,he.prerelease=de,he.product=K,he.ua=g,he.version=V&&j,he.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},he.parse=D,he.toString=me,he.version&&X.unshift(j),he.name&&X.unshift(V),U&&V&&!(U==String(U).split(" ")[0]&&(U==V.split(" ")[0]||K))&&X.push(K?"("+U+")":"on "+U),X.length&&(he.description=X.join(" ")),he}var z=D();r&&o?y(z,function(g,x){r[x]=g}):n.platform=z}).call(W)})(Wt,Wt.exports);var Nr=Wt.exports;Object.defineProperty(Ne,"__esModule",{value:!0});Ne.PlatformUtils=void 0;var Z=Nr,Lr=function(){function i(){}return i.getInstance=function(){return this.instance||(this.instance=new i),i.instance},i.prototype.isChromeBrowser=function(){return Z.name==="Chrome"},i.prototype.isSafariBrowser=function(){return Z.name==="Safari"},i.prototype.isChromeMobileBrowser=function(){return Z.name==="Chrome Mobile"},i.prototype.isFirefoxBrowser=function(){return Z.name==="Firefox"},i.prototype.isFirefoxMobileBrowser=function(){return Z.name==="Firefox Mobile"||Z.name==="Firefox for iOS"},i.prototype.isOperaBrowser=function(){return Z.name==="Opera"},i.prototype.isOperaMobileBrowser=function(){return Z.name==="Opera Mobile"},i.prototype.isEdgeBrowser=function(){var t=Z!=null&&Z.version?parseFloat(Z.version):-1;return Z.name==="Microsoft Edge"&&t>=80},i.prototype.isEdgeMobileBrowser=function(){var t,e,n=Z!=null&&Z.version?parseFloat(Z.version):-1;return Z.name==="Microsoft Edge"&&(((t=Z.os)===null||t===void 0?void 0:t.family)==="Android"||((e=Z.os)===null||e===void 0?void 0:e.family)==="iOS")&&n>45},i.prototype.isAndroidBrowser=function(){return Z.name==="Android Browser"},i.prototype.isElectron=function(){return Z.name==="Electron"},i.prototype.isNodeJs=function(){return Z.name==="Node.js"},i.prototype.isSamsungBrowser=function(){return Z.name==="Samsung Internet Mobile"||Z.name==="Samsung Internet"},i.prototype.isMotorolaEdgeDevice=function(){var t;return((t=Z.product)===null||t===void 0?void 0:t.toLowerCase().includes("motorola edge"))||!1},i.prototype.isIPhoneOrIPad=function(){var t=Z.ua?Z.ua:navigator.userAgent,e="ontouchend"in document,n=/\b(\w*Macintosh\w*)\b/.test(t)&&e,r=/\b(\w*iPhone\w*)\b/.test(t)&&/\b(\w*Mobile\w*)\b/.test(t)&&e;return n||r},i.prototype.isIOSWithSafari=function(){var t=Z.ua?Z.ua:navigator.userAgent;return this.isIPhoneOrIPad()&&/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(t)&&!/\b(\w*CriOS\w*)\b/.test(t)&&!/\b(\w*FxiOS\w*)\b/.test(t)},i.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&Z.ua.indexOf("Safari")===-1},i.prototype.isIonicAndroid=function(){return Z.os.family==="Android"&&Z.name=="Android Browser"},i.prototype.isMobileDevice=function(){return Z.os.family==="iOS"||Z.os.family==="Android"},i.prototype.isReactNative=function(){return!1},i.prototype.isChromium=function(){return this.isChromeBrowser()||this.isChromeMobileBrowser()||this.isOperaBrowser()||this.isOperaMobileBrowser()||this.isEdgeBrowser()||this.isEdgeMobileBrowser()||this.isSamsungBrowser()||this.isIonicAndroid()||this.isIonicIos()||this.isElectron()||this.isMotorolaEdgeDevice()},i.prototype.canScreenShare=function(){var t=Z!=null&&Z.version?parseFloat(Z.version):-1;return this.isMobileDevice()?!1:this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&t>=13},i.prototype.getName=function(){return Z.name||""},i.prototype.getVersion=function(){return Z.version||""},i.prototype.getFamily=function(){return Z.os.family||""},i.prototype.getDescription=function(){return Z.description||""},i}();Ne.PlatformUtils=Lr;function Yt(){this._types=Object.create(null),this._extensions=Object.create(null);for(let i=0;i<arguments.length;i++)this.define(arguments[i]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}Yt.prototype.define=function(i,t){for(let e in i){let n=i[e].map(function(r){return r.toLowerCase()});e=e.toLowerCase();for(let r=0;r<n.length;r++){const o=n[r];if(o[0]!=="*"){if(!t&&o in this._types)throw new Error('Attempt to change mapping for "'+o+'" extension from "'+this._types[o]+'" to "'+e+'". Pass `force=true` to allow this, otherwise remove "'+o+'" from the list of extensions for "'+e+'".');this._types[o]=e}}if(t||!this._extensions[e]){const r=n[0];this._extensions[e]=r[0]!=="*"?r:r.substr(1)}}};Yt.prototype.getType=function(i){i=String(i);let t=i.replace(/^.*[/\\]/,"").toLowerCase(),e=t.replace(/^.*\./,"").toLowerCase(),n=t.length<i.length;return(e.length<t.length-1||!n)&&this._types[e]||null};Yt.prototype.getExtension=function(i){return i=/^\s*([^;\s]*)/.test(i)&&RegExp.$1,i&&this._extensions[i.toLowerCase()]||null};var Mr=Yt,Ar={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};let Vr=Mr;var Dr=new Vr(Ar);Object.defineProperty(wt,"__esModule",{value:!0});wt.LocalRecorder=void 0;var be=Hn,jr=Ee,Br=Ne,si=Dr,ze=jr.OpenViduLogger.getInstance(),ai,$r=function(){function i(t){this.stream=t,this.chunks=[],ai=Br.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=be.LocalRecorderState.READY}return i.prototype.record=function(t){var e=this;return new Promise(function(n,r){try{if(typeof t=="string"||t instanceof String)return r(`When calling LocalRecorder.record(options) parameter 'options' cannot be a string. Must be an object like { mimeType: "`.concat(t,'" }'));if(typeof MediaRecorder>"u")throw ze.error("MediaRecorder not supported on your device. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your device. See compatibility in https://caniuse.com/#search=MediaRecorder");if(e.state!==be.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+e.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");ze.log("Starting local recording of stream '"+e.stream.streamId+"' of connection '"+e.connectionId+"'"),t?t.mimeType||(t.mimeType="video/webm"):t={mimeType:"video/webm"},e.mediaRecorder=new MediaRecorder(e.stream.getMediaStream(),t),e.mediaRecorder.start()}catch(o){return r(o)}return e.mediaRecorder.ondataavailable=function(o){o.data.size>0&&e.chunks.push(o.data)},e.mediaRecorder.onerror=function(o){ze.error("MediaRecorder error: ",o)},e.mediaRecorder.onstart=function(){ze.log("MediaRecorder started (state="+e.mediaRecorder.state+")")},e.mediaRecorder.onstop=function(){e.onStopDefault()},e.mediaRecorder.onpause=function(){ze.log("MediaRecorder paused (state="+e.mediaRecorder.state+")")},e.mediaRecorder.onresume=function(){ze.log("MediaRecorder resumed (state="+e.mediaRecorder.state+")")},e.state=be.LocalRecorderState.RECORDING,n()})},i.prototype.stop=function(){var t=this;return new Promise(function(e,n){try{if(t.state===be.LocalRecorderState.READY||t.state===be.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+t.state+"'). Call 'LocalRecorder.start()' before");t.mediaRecorder.onstop=function(){return t.onStopDefault(),e()},t.mediaRecorder.stop()}catch(r){return n(r)}})},i.prototype.pause=function(){var t=this;return new Promise(function(e,n){try{return t.state!==be.LocalRecorderState.RECORDING?n(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+t.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")):(t.mediaRecorder.pause(),t.state=be.LocalRecorderState.PAUSED,e())}catch(r){return n(r)}})},i.prototype.resume=function(){var t=this;return new Promise(function(e,n){try{if(t.state!==be.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+t.state+"'). Call 'LocalRecorder.pause()' before");return t.mediaRecorder.resume(),t.state=be.LocalRecorderState.RECORDING,e()}catch(r){return n(r)}})},i.prototype.preview=function(t){if(this.state!==be.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,ai.isSafariBrowser()&&(this.videoPreview.playsInline=!0),typeof t=="string"){var e=document.getElementById(t);e&&(this.videoPreview=e.appendChild(this.videoPreview))}else this.videoPreview=t.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},i.prototype.clean=function(){var t=this,e=function(){delete t.blob,t.chunks=[],t.state=be.LocalRecorderState.READY};this.state===be.LocalRecorderState.RECORDING||this.state===be.LocalRecorderState.PAUSED?this.stop().then(function(){return e()}).catch(function(){return e()}):e()},i.prototype.download=function(){if(this.state!==be.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var t=document.createElement("a");t.style.display="none",document.body.appendChild(t);var e=globalThis.URL.createObjectURL(this.blob);t.href=e,t.download=this.id+"."+si.getExtension(this.blob.type),t.click(),globalThis.URL.revokeObjectURL(e),document.body.removeChild(t)},i.prototype.getBlob=function(){if(this.state!==be.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},i.prototype.uploadAsBinary=function(t,e){var n=this;return new Promise(function(r,o){if(n.state!==be.LocalRecorderState.FINISHED)return o(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));var s=new XMLHttpRequest;if(s.open("POST",t,!0),typeof e=="object")for(var c=0,d=Object.keys(e);c<d.length;c++){var a=d[c];s.setRequestHeader(a,e[a])}s.onreadystatechange=function(){if(s.readyState===4)return s.status.toString().charAt(0)==="2"?r(s.responseText):o(s.status)},s.send(n.blob)})},i.prototype.uploadAsMultipartfile=function(t,e){var n=this;return new Promise(function(r,o){if(n.state!==be.LocalRecorderState.FINISHED)return o(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));var s=new XMLHttpRequest;if(s.open("POST",t,!0),typeof e=="object")for(var c=0,d=Object.keys(e);c<d.length;c++){var a=d[c];s.setRequestHeader(a,e[a])}var f=new FormData;f.append("file",n.blob,n.id+"."+si.getExtension(n.blob.type)),s.onreadystatechange=function(){if(s.readyState===4)return s.status.toString().charAt(0)==="2"?r(s.responseText):o(s.status)},s.send(f)})},i.prototype.onStopDefault=function(){ze.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:this.mediaRecorder.mimeType}),this.chunks=[],this.videoPreviewSrc=globalThis.URL.createObjectURL(this.blob),this.state=be.LocalRecorderState.FINISHED},i}();wt.LocalRecorder=$r;var vt={},gt={},Ot={},st={},at={},Be={},Se={};Object.defineProperty(Se,"__esModule",{value:!0});Se.Event=void 0;var Fr=function(){function i(t,e,n){this.hasBeenPrevented=!1,this.cancelable=t,this.target=e,this.type=n}return i.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},i.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},i}();Se.Event=Fr;var Ur=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Be,"__esModule",{value:!0});Be.StreamPropertyChangedEvent=void 0;var Wr=Se,Hr=function(i){Ur(t,i);function t(e,n,r,o,s,c){var d=i.call(this,!1,e,"streamPropertyChanged")||this;return d.stream=n,d.changedProperty=r,d.newValue=o,d.oldValue=s,d.reason=c,d}return t.prototype.callDefaultBehavior=function(){},t}(Wr.Event);Be.StreamPropertyChangedEvent=Hr;var Ke={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.OpenViduError=i.OpenViduErrorName=void 0,function(e){e.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",e.DEVICE_ACCESS_DENIED="DEVICE_ACCESS_DENIED",e.DEVICE_ALREADY_IN_USE="DEVICE_ALREADY_IN_USE",e.SCREEN_CAPTURE_DENIED="SCREEN_CAPTURE_DENIED",e.SCREEN_SHARING_NOT_SUPPORTED="SCREEN_SHARING_NOT_SUPPORTED",e.SCREEN_EXTENSION_NOT_INSTALLED="SCREEN_EXTENSION_NOT_INSTALLED",e.SCREEN_EXTENSION_DISABLED="SCREEN_EXTENSION_DISABLED",e.INPUT_VIDEO_DEVICE_NOT_FOUND="INPUT_VIDEO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_NOT_FOUND="INPUT_AUDIO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_GENERIC_ERROR="INPUT_AUDIO_DEVICE_GENERIC_ERROR",e.NO_INPUT_SOURCE_SET="NO_INPUT_SOURCE_SET",e.PUBLISHER_PROPERTIES_ERROR="PUBLISHER_PROPERTIES_ERROR",e.OPENVIDU_PERMISSION_DENIED="OPENVIDU_PERMISSION_DENIED",e.OPENVIDU_NOT_CONNECTED="OPENVIDU_NOT_CONNECTED",e.VIRTUAL_BACKGROUND_ERROR="VIRTUAL_BACKGROUND_ERROR",e.GENERIC_ERROR="GENERIC_ERROR"}(i.OpenViduErrorName||(i.OpenViduErrorName={}));var t=function(){function e(n,r){this.name=n,this.message=r}return e}();i.OpenViduError=t})(Ke);Object.defineProperty(at,"__esModule",{value:!0});at.Filter=void 0;var ci=Be,Oe=Ke,qr=Ee,Me=qr.OpenViduLogger.getInstance(),Gr=function(){function i(t,e){this.handlers=new Map,this.type=t,this.options=e}return i.prototype.execMethod=function(t,e){var n=this;return new Promise(function(r,o){var s;Me.info("Executing filter method to stream "+n.stream.streamId);var c,d=function(v){Me.info("Filter method successfully executed on Stream "+n.stream.streamId);var m=Object.assign({},n.stream.filter);return n.stream.filter.lastExecMethod={method:t,params:c},v&&(n.stream.session.emitEvent("streamPropertyChanged",[new ci.StreamPropertyChangedEvent(n.stream.session,n.stream,"filter",n.stream.filter,m,"execFilterMethod")]),n.stream.streamManager.emitEvent("streamPropertyChanged",[new ci.StreamPropertyChangedEvent(n.stream.streamManager,n.stream,"filter",n.stream.filter,m,"execFilterMethod")])),r()};if(n.type.startsWith("VB:")){if(typeof e=="string")try{e=JSON.parse(e)}catch(v){return o(new Oe.OpenViduError(Oe.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"Wrong params syntax: "+v))}if(c=e,t==="update")if(!((s=n.stream.virtualBackgroundSinkElements)===null||s===void 0)&&s.VB)n.stream.virtualBackgroundSinkElements.VB.updateValues(e).then(function(){return d(!1)}).catch(function(v){return v.name===Oe.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR?o(new Oe.OpenViduError(v.name,v.message)):o(new Oe.OpenViduError(Oe.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"Error updating values on Virtual Background filter: "+v))});else return o(new Oe.OpenViduError(Oe.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"There is no Virtual Background filter applied"));else return o(new Oe.OpenViduError(Oe.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,'Unknown Virtual Background method "'.concat(t,'"')))}else{var a=void 0;if(typeof e!="string")try{a=JSON.stringify(e)}catch{var f="'params' property must be a JSON formatted object";return Me.error(f),o(f)}else a=e;c=a,n.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:n.stream.streamId,method:t,params:a},function(v,m){return v?(Me.error("Error executing filter method for Stream "+n.stream.streamId,v),v.code===401?o(new Oe.OpenViduError(Oe.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):o(v)):d(!0)})}})},i.prototype.addEventListener=function(t,e){var n=this;return new Promise(function(r,o){Me.info("Adding filter event listener to event "+t+" to stream "+n.stream.streamId),n.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:n.stream.streamId,eventType:t},function(s,c){return s?(Me.error("Error adding filter event listener to event "+t+"for Stream "+n.stream.streamId,s),s.code===401?o(new Oe.OpenViduError(Oe.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):o(s)):(n.handlers.set(t,e),Me.info("Filter event listener to event "+t+" successfully applied on Stream "+n.stream.streamId),r())})})},i.prototype.removeEventListener=function(t){var e=this;return new Promise(function(n,r){Me.info("Removing filter event listener to event "+t+" to stream "+e.stream.streamId),e.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:e.stream.streamId,eventType:t},function(o,s){return o?(Me.error("Error removing filter event listener to event "+t+"for Stream "+e.stream.streamId,o),o.code===401?r(new Oe.OpenViduError(Oe.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):r(o)):(e.handlers.delete(t),Me.info("Filter event listener to event "+t+" successfully removed on Stream "+e.stream.streamId),n())})})},i}();at.Filter=Gr;var ct={},ut={},dt={},Fi={exports:{}};/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */(function(i){(function(t){function e(){}var n=e.prototype,r=t.EventEmitter;function o(d,a){for(var f=d.length;f--;)if(d[f].listener===a)return f;return-1}function s(d){return function(){return this[d].apply(this,arguments)}}n.getListeners=function(a){var f=this._getEvents(),v,m;if(a instanceof RegExp){v={};for(m in f)f.hasOwnProperty(m)&&a.test(m)&&(v[m]=f[m])}else v=f[a]||(f[a]=[]);return v},n.flattenListeners=function(a){var f=[],v;for(v=0;v<a.length;v+=1)f.push(a[v].listener);return f},n.getListenersAsObject=function(a){var f=this.getListeners(a),v;return f instanceof Array&&(v={},v[a]=f),v||f};function c(d){return typeof d=="function"||d instanceof RegExp?!0:d&&typeof d=="object"?c(d.listener):!1}n.addListener=function(a,f){if(!c(f))throw new TypeError("listener must be a function");var v=this.getListenersAsObject(a),m=typeof f=="object",O;for(O in v)v.hasOwnProperty(O)&&o(v[O],f)===-1&&v[O].push(m?f:{listener:f,once:!1});return this},n.on=s("addListener"),n.addOnceListener=function(a,f){return this.addListener(a,{listener:f,once:!0})},n.once=s("addOnceListener"),n.defineEvent=function(a){return this.getListeners(a),this},n.defineEvents=function(a){for(var f=0;f<a.length;f+=1)this.defineEvent(a[f]);return this},n.removeListener=function(a,f){var v=this.getListenersAsObject(a),m,O;for(O in v)v.hasOwnProperty(O)&&(m=o(v[O],f),m!==-1&&v[O].splice(m,1));return this},n.off=s("removeListener"),n.addListeners=function(a,f){return this.manipulateListeners(!1,a,f)},n.removeListeners=function(a,f){return this.manipulateListeners(!0,a,f)},n.manipulateListeners=function(a,f,v){var m,O,_=a?this.removeListener:this.addListener,P=a?this.removeListeners:this.addListeners;if(typeof f=="object"&&!(f instanceof RegExp))for(m in f)f.hasOwnProperty(m)&&(O=f[m])&&(typeof O=="function"?_.call(this,m,O):P.call(this,m,O));else for(m=v.length;m--;)_.call(this,f,v[m]);return this},n.removeEvent=function(a){var f=typeof a,v=this._getEvents(),m;if(f==="string")delete v[a];else if(a instanceof RegExp)for(m in v)v.hasOwnProperty(m)&&a.test(m)&&delete v[m];else delete this._events;return this},n.removeAllListeners=s("removeEvent"),n.emitEvent=function(a,f){var v=this.getListenersAsObject(a),m,O,_,P,y;for(P in v)if(v.hasOwnProperty(P))for(m=v[P].slice(0),_=0;_<m.length;_++)O=m[_],O.once===!0&&this.removeListener(a,O.listener),y=O.listener.apply(this,f||[]),y===this._getOnceReturnValue()&&this.removeListener(a,O.listener);return this},n.trigger=s("emitEvent"),n.emit=function(a){var f=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,f)},n.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},n._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},n._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return t.EventEmitter=r,e},i.exports?i.exports=e:t.EventEmitter=e})(typeof window<"u"?window:W||{})})(Fi);var Gn=Fi.exports;Object.defineProperty(dt,"__esModule",{value:!0});dt.EventDispatcher=void 0;var zr=Ee,Xr=Gn,Vt=zr.OpenViduLogger.getInstance(),Jr=function(){function i(){this.userHandlerArrowHandler=new WeakMap,this.ee=new Xr}return i.prototype.onAux=function(t,e,n){var r=function(o){o?Vt.debug(e,o):Vt.debug(e),n(o)};return this.userHandlerArrowHandler.set(n,r),this.ee.on(t,r),this},i.prototype.onceAux=function(t,e,n){var r=this,o=function(s){s?Vt.debug(e,s):Vt.debug(e),n(s),r.userHandlerArrowHandler.delete(n)};return this.userHandlerArrowHandler.set(n,o),this.ee.once(t,o),this},i.prototype.offAux=function(t,e){if(!e)this.ee.removeAllListeners(t);else{var n=this.userHandlerArrowHandler.get(e);n&&this.ee.off(t,n),this.userHandlerArrowHandler.delete(e)}return this},i}();dt.EventDispatcher=Jr;var lt={},Kr=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(lt,"__esModule",{value:!0});lt.StreamManagerEvent=void 0;var Yr=Se,Qr=function(i){Kr(t,i);function t(e,n,r){var o=i.call(this,!1,e,n)||this;return o.value=r,o}return t.prototype.callDefaultBehavior=function(){},t}(Yr.Event);lt.StreamManagerEvent=Qr;var Ct={},Zr=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Ct,"__esModule",{value:!0});Ct.VideoElementEvent=void 0;var eo=Se,to=function(i){Zr(t,i);function t(e,n,r){var o=i.call(this,!1,n,r)||this;return o.element=e,o}return t.prototype.callDefaultBehavior=function(){},t}(eo.Event);Ct.VideoElementEvent=to;var Ye={};(function(i){var t=W&&W.__extends||function(){var r=function(o,s){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var a in d)Object.prototype.hasOwnProperty.call(d,a)&&(c[a]=d[a])},r(o,s)};return function(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");r(o,s);function c(){this.constructor=o}o.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)}}();Object.defineProperty(i,"__esModule",{value:!0}),i.ExceptionEvent=i.ExceptionEventName=void 0;var e=Se;(function(r){r.ICE_CANDIDATE_ERROR="ICE_CANDIDATE_ERROR",r.ICE_CONNECTION_FAILED="ICE_CONNECTION_FAILED",r.ICE_CONNECTION_DISCONNECTED="ICE_CONNECTION_DISCONNECTED",r.NO_STREAM_PLAYING_EVENT="NO_STREAM_PLAYING_EVENT",r.SPEECH_TO_TEXT_DISCONNECTED="SPEECH_TO_TEXT_DISCONNECTED"})(i.ExceptionEventName||(i.ExceptionEventName={}));var n=function(r){t(o,r);function o(s,c,d,a,f){var v=r.call(this,!1,s,"exception")||this;return v.name=c,v.origin=d,v.message=a,v.data=f,v}return o.prototype.callDefaultBehavior=function(){},o}(e.Event);i.ExceptionEvent=n})(Ye);var Rt={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.VideoInsertMode=void 0,function(t){t.AFTER="AFTER",t.APPEND="APPEND",t.BEFORE="BEFORE",t.PREPEND="PREPEND",t.REPLACE="REPLACE"}(i.VideoInsertMode||(i.VideoInsertMode={}))})(Rt);var no=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ut,"__esModule",{value:!0});ut.StreamManager=void 0;var io=dt,Sn=lt,Dt=Ct,ui=Ye,Xe=Rt,ro=Ee,oo=Ne,yn=ro.OpenViduLogger.getInstance(),Pe,so=function(i){no(t,i);function t(e,n){var r=i.call(this)||this;if(r.videos=[],r.lazyLaunchVideoElementCreatedEvent=!1,Pe=oo.PlatformUtils.getInstance(),r.stream=e,r.stream.streamManager=r,r.remote=!r.stream.isLocal(),n){var o=void 0;typeof n=="string"?o=document.getElementById(n):n instanceof HTMLElement&&(o=n),o&&(r.firstVideoElement={targetElement:o,video:document.createElement("video"),id:"",canplayListenerAdded:!1},(Pe.isSafariBrowser()||Pe.isIPhoneOrIPad()&&(Pe.isChromeMobileBrowser()||Pe.isEdgeMobileBrowser()||Pe.isOperaMobileBrowser()||Pe.isFirefoxMobileBrowser()))&&(r.firstVideoElement.video.playsInline=!0),r.targetElement=o,r.element=o)}return r.canPlayListener=function(){r.deactivateStreamPlayingEventExceptionTimeout(),r.ee.emitEvent("streamPlaying",[new Sn.StreamManagerEvent(r,"streamPlaying",void 0)])},r}return t.prototype.on=function(e,n){return i.prototype.onAux.call(this,e,"Event '"+e+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",n),e==="videoElementCreated"&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new Dt.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),e==="streamPlaying"&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&this.ee.emitEvent("streamPlaying",[new Sn.StreamManagerEvent(this,"streamPlaying",void 0)]),this.stream.hasAudio&&(e==="publisherStartSpeaking"&&this.stream.enableHarkSpeakingEvent(),e==="publisherStopSpeaking"&&this.stream.enableHarkStoppedSpeakingEvent(),e==="streamAudioVolumeChange"&&this.stream.enableHarkVolumeChangeEvent(!1)),this},t.prototype.once=function(e,n){return i.prototype.onceAux.call(this,e,"Event '"+e+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",n),e==="videoElementCreated"&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new Dt.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),e==="streamPlaying"&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&this.videos[0].video.paused===!1&&this.videos[0].video.ended===!1&&this.videos[0].video.readyState===4&&this.ee.emitEvent("streamPlaying",[new Sn.StreamManagerEvent(this,"streamPlaying",void 0)]),this.stream.hasAudio&&(e==="publisherStartSpeaking"&&this.stream.enableOnceHarkSpeakingEvent(),e==="publisherStopSpeaking"&&this.stream.enableOnceHarkStoppedSpeakingEvent(),e==="streamAudioVolumeChange"&&this.stream.enableOnceHarkVolumeChangeEvent(!1)),this},t.prototype.off=function(e,n){if(i.prototype.offAux.call(this,e,n),e==="publisherStartSpeaking"){var r=this.ee.getListeners(e).length+this.stream.session.ee.getListeners(e).length;r===0&&this.stream.disableHarkSpeakingEvent(!1)}if(e==="publisherStopSpeaking"){var o=this.ee.getListeners(e).length+this.stream.session.ee.getListeners(e).length;o===0&&this.stream.disableHarkStoppedSpeakingEvent(!1)}if(e==="streamAudioVolumeChange"){var s=this.ee.getListeners(e).length;s===0&&this.stream.disableHarkVolumeChangeEvent(!1)}return this},t.prototype.addVideoElement=function(e){this.initializeVideoProperties(e),!this.remote&&this.stream.displayMyRemote()&&e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream());for(var n=0,r=this.videos;n<r.length;n++){var o=r[n];if(o.video===e)return 0}for(var s=1,c=0,d=this.stream.session.streamManagers;c<d.length;c++){var a=d[c];if(a.disassociateVideo(e)){s=-1;break}}return this.stream.session.streamManagers.forEach(function(f){f.disassociateVideo(e)}),this.pushNewStreamManagerVideo({video:e,id:e.id,canplayListenerAdded:!1}),yn.info("New video element associated to ",this),s},t.prototype.createVideoElement=function(e,n){var r;if(typeof e=="string"){if(r=document.getElementById(e),!r)throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e)}else if(e instanceof HTMLElement)r=e;else throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e);var o=this.createVideo();this.initializeVideoProperties(o);var s=n||Xe.VideoInsertMode.APPEND;switch(s){case Xe.VideoInsertMode.AFTER:r.parentNode.insertBefore(o,r.nextSibling);break;case Xe.VideoInsertMode.APPEND:r.appendChild(o);break;case Xe.VideoInsertMode.BEFORE:r.parentNode.insertBefore(o,r);break;case Xe.VideoInsertMode.PREPEND:r.insertBefore(o,r.childNodes[0]);break;case Xe.VideoInsertMode.REPLACE:r.parentNode.replaceChild(o,r);break;default:s=Xe.VideoInsertMode.APPEND,r.appendChild(o);break}var c={targetElement:r,video:o,insertMode:s,id:o.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(c),this.ee.emitEvent("videoElementCreated",[new Dt.VideoElementEvent(c.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,o},t.prototype.updatePublisherSpeakingEventsOptions=function(e){var n=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},r=typeof e.interval=="number"?e.interval:typeof n.interval=="number"?n.interval:100,o=typeof e.threshold=="number"?e.threshold:typeof n.threshold=="number"?n.threshold:-50;this.stream.harkOptions={interval:r,threshold:o},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(r),this.stream.speechEvent.setThreshold(o))},t.prototype.initializeVideoProperties=function(e){!this.remote&&this.stream.displayMyRemote()||e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream()),e.autoplay=!0,e.controls=!1,(Pe.isSafariBrowser()||Pe.isIPhoneOrIPad()&&(Pe.isChromeMobileBrowser()||Pe.isEdgeMobileBrowser()||Pe.isOperaMobileBrowser()||Pe.isFirefoxMobileBrowser()))&&(e.playsInline=!0),e.id||(e.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=e.id)),this.remote&&this.isMirroredVideo(e)?this.removeMirrorVideo(e):!this.remote&&!this.stream.displayMyRemote()&&(e.muted=!0,this.isMirroredVideo(e)&&!this.stream.outboundStreamOpts.publisherProperties.mirror?this.removeMirrorVideo(e):this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(e))},t.prototype.removeAllVideos=function(){for(var e=this,n=this.stream.session.streamManagers.length-1;n>=0;--n)this.stream.session.streamManagers[n]===this&&this.stream.session.streamManagers.splice(n,1);this.videos.forEach(function(r){r.video&&r.video.removeEventListener&&r.video.removeEventListener("canplay",e.canPlayListener),r.canplayListenerAdded=!1,r.targetElement&&(r.video.parentNode.removeChild(r.video),e.ee.emitEvent("videoElementDestroyed",[new Dt.VideoElementEvent(r.video,e,"videoElementDestroyed")])),e.removeSrcObject(r),e.videos.filter(function(o){return!o.targetElement})})},t.prototype.disassociateVideo=function(e){for(var n=!1,r=0;r<this.videos.length;r++)if(this.videos[r].video===e){this.videos[r].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(r,1),n=!0,yn.info("Video element disassociated from ",this);break}return n},t.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.activateStreamPlayingEventExceptionTimeout(),this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},t.prototype.updateMediaStream=function(e){this.videos.forEach(function(n){if(n.video.srcObject=e,Pe.isIonicIos()){var r=n.video.parentElement,o=n.video;r.replaceChild(o,n.video),n.video=o}})},t.prototype.emitEvent=function(e,n){this.ee.emitEvent(e,n)},t.prototype.createVideo=function(){return document.createElement("video")},t.prototype.removeSrcObject=function(e){e.video.srcObject=null,this.deactivateStreamPlayingEventExceptionTimeout()},t.prototype.pushNewStreamManagerVideo=function(e){this.videos.push(e),this.addPlayEventToFirstVideo(),this.stream.session.streamManagers.indexOf(this)===-1&&this.stream.session.streamManagers.push(this)},t.prototype.mirrorVideo=function(e){Pe.isIonicIos()||(e.style.transform="rotateY(180deg)",e.style.webkitTransform="rotateY(180deg)")},t.prototype.removeMirrorVideo=function(e){e.style.transform="unset",e.style.webkitTransform="unset"},t.prototype.isMirroredVideo=function(e){return e.style.transform==="rotateY(180deg)"||e.style.webkitTransform==="rotateY(180deg)"},t.prototype.activateStreamPlayingEventExceptionTimeout=function(){var e=this;if(this.remote&&this.streamPlayingEventExceptionTimeout==null){var n=this.stream.session.openvidu.advancedConfiguration.noStreamPlayingEventExceptionTimeout||4e3;this.streamPlayingEventExceptionTimeout=setTimeout(function(){var r="StreamManager of Stream "+e.stream.streamId+" ("+(e.remote?"Subscriber":"Publisher")+') did not trigger "streamPlaying" event in '+n+" ms";yn.warn(r),e.stream.session.emitEvent("exception",[new ui.ExceptionEvent(e.stream.session,ui.ExceptionEventName.NO_STREAM_PLAYING_EVENT,e,r)]),delete e.streamPlayingEventExceptionTimeout},n)}},t.prototype.deactivateStreamPlayingEventExceptionTimeout=function(){clearTimeout(this.streamPlayingEventExceptionTimeout),delete this.streamPlayingEventExceptionTimeout},t}(io.EventDispatcher);ut.StreamManager=so;var ao=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ct,"__esModule",{value:!0});ct.Subscriber=void 0;var co=ut,uo=Ee,di=uo.OpenViduLogger.getInstance(),lo=function(i){ao(t,i);function t(e,n,r){var o=i.call(this,e,n)||this;return o.element=o.targetElement,o.stream=e,o.properties=r,o}return t.prototype.subscribeToAudio=function(e){return this.stream.getMediaStream().getAudioTracks().forEach(function(n){n.enabled=e}),this.stream.audioActive=e,di.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its audio stream"),this},t.prototype.subscribeToVideo=function(e){return this.stream.getMediaStream().getVideoTracks().forEach(function(n){n.enabled=e}),this.stream.videoActive=e,di.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its video stream"),this},t.prototype.replaceTrackInMediaStream=function(e,n){var r=this.stream.getMediaStream(),o;e.kind==="video"?(o=r.getVideoTracks()[0],n&&(this.stream.lastVideoTrackConstraints=e.getConstraints())):o=r.getAudioTracks()[0],r.removeTrack(o),o.stop(),r.addTrack(e)},t}(co.StreamManager);ct.Subscriber=lo;var je={},li=["stun:","turn:"],fo=function(i){var t=(i||{}).url||i,e,n,r={};return typeof t!="string"&&!(t instanceof String)||(t=t.trim(),e=li[li.indexOf(t.slice(0,5))],!e)?i:(t=t.slice(5),n=t.split("@"),r.username=i.username,r.credential=i.credential,n.length>1&&(t=n[1],n=n[0].split(":"),r.username=n[0],r.credential=(i||{}).credential||n[1]||""),r.url=e+t,r.urls=[r.url],r)};const ho=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"],po=[];var mo=fo,vo=function(i){var t={stun:(i||{}).stun||ho,turn:(i||{}).turn||po},e=(i||{}).stunCount||2,n=(i||{}).turnCount||0,r;function o(s,c){for(var d=[],a=[].concat(t[s]),f;a.length&&d.length<c;)f=Math.random()*a.length|0,d=d.concat(a.splice(f,1));return d.map(function(v){return typeof v!="string"&&!(v instanceof String)?v:mo(s+":"+v)})}return r=[].concat(o("stun",e)),n&&(r=r.concat(o("turn",n))),r},go=vo,zn={},Qt={},Zt={};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.default=bo;let jt;const Eo=new Uint8Array(16);function bo(){if(!jt&&(jt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!jt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jt(Eo)}var Ge={},Qe={},en={};Object.defineProperty(en,"__esModule",{value:!0});en.default=void 0;var So=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;en.default=So;Object.defineProperty(Qe,"__esModule",{value:!0});Qe.default=void 0;var yo=wo(en);function wo(i){return i&&i.__esModule?i:{default:i}}function Oo(i){return typeof i=="string"&&yo.default.test(i)}var Co=Oo;Qe.default=Co;Object.defineProperty(Ge,"__esModule",{value:!0});Ge.default=void 0;Ge.unsafeStringify=Ui;var Ro=_o(Qe);function _o(i){return i&&i.__esModule?i:{default:i}}const ye=[];for(let i=0;i<256;++i)ye.push((i+256).toString(16).slice(1));function Ui(i,t=0){return(ye[i[t+0]]+ye[i[t+1]]+ye[i[t+2]]+ye[i[t+3]]+"-"+ye[i[t+4]]+ye[i[t+5]]+"-"+ye[i[t+6]]+ye[i[t+7]]+"-"+ye[i[t+8]]+ye[i[t+9]]+"-"+ye[i[t+10]]+ye[i[t+11]]+ye[i[t+12]]+ye[i[t+13]]+ye[i[t+14]]+ye[i[t+15]]).toLowerCase()}function Io(i,t=0){const e=Ui(i,t);if(!(0,Ro.default)(e))throw TypeError("Stringified UUID is invalid");return e}var Po=Io;Ge.default=Po;Object.defineProperty(Qt,"__esModule",{value:!0});Qt.default=void 0;var To=ko(Zt),xo=Ge;function ko(i){return i&&i.__esModule?i:{default:i}}let fi,wn,On=0,Cn=0;function No(i,t,e){let n=t&&e||0;const r=t||new Array(16);i=i||{};let o=i.node||fi,s=i.clockseq!==void 0?i.clockseq:wn;if(o==null||s==null){const m=i.random||(i.rng||To.default)();o==null&&(o=fi=[m[0]|1,m[1],m[2],m[3],m[4],m[5]]),s==null&&(s=wn=(m[6]<<8|m[7])&16383)}let c=i.msecs!==void 0?i.msecs:Date.now(),d=i.nsecs!==void 0?i.nsecs:Cn+1;const a=c-On+(d-Cn)/1e4;if(a<0&&i.clockseq===void 0&&(s=s+1&16383),(a<0||c>On)&&i.nsecs===void 0&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");On=c,Cn=d,wn=s,c+=122192928e5;const f=((c&268435455)*1e4+d)%4294967296;r[n++]=f>>>24&255,r[n++]=f>>>16&255,r[n++]=f>>>8&255,r[n++]=f&255;const v=c/4294967296*1e4&268435455;r[n++]=v>>>8&255,r[n++]=v&255,r[n++]=v>>>24&15|16,r[n++]=v>>>16&255,r[n++]=s>>>8|128,r[n++]=s&255;for(let m=0;m<6;++m)r[n+m]=o[m];return t||(0,xo.unsafeStringify)(r)}var Lo=No;Qt.default=Lo;var tn={},qe={},_t={};Object.defineProperty(_t,"__esModule",{value:!0});_t.default=void 0;var Mo=Ao(Qe);function Ao(i){return i&&i.__esModule?i:{default:i}}function Vo(i){if(!(0,Mo.default)(i))throw TypeError("Invalid UUID");let t;const e=new Uint8Array(16);return e[0]=(t=parseInt(i.slice(0,8),16))>>>24,e[1]=t>>>16&255,e[2]=t>>>8&255,e[3]=t&255,e[4]=(t=parseInt(i.slice(9,13),16))>>>8,e[5]=t&255,e[6]=(t=parseInt(i.slice(14,18),16))>>>8,e[7]=t&255,e[8]=(t=parseInt(i.slice(19,23),16))>>>8,e[9]=t&255,e[10]=(t=parseInt(i.slice(24,36),16))/1099511627776&255,e[11]=t/4294967296&255,e[12]=t>>>24&255,e[13]=t>>>16&255,e[14]=t>>>8&255,e[15]=t&255,e}var Do=Vo;_t.default=Do;Object.defineProperty(qe,"__esModule",{value:!0});qe.URL=qe.DNS=void 0;qe.default=Uo;var jo=Ge,Bo=$o(_t);function $o(i){return i&&i.__esModule?i:{default:i}}function Fo(i){i=unescape(encodeURIComponent(i));const t=[];for(let e=0;e<i.length;++e)t.push(i.charCodeAt(e));return t}const Wi="6ba7b810-9dad-11d1-80b4-00c04fd430c8";qe.DNS=Wi;const Hi="6ba7b811-9dad-11d1-80b4-00c04fd430c8";qe.URL=Hi;function Uo(i,t,e){function n(r,o,s,c){var d;if(typeof r=="string"&&(r=Fo(r)),typeof o=="string"&&(o=(0,Bo.default)(o)),((d=o)===null||d===void 0?void 0:d.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+r.length);if(a.set(o),a.set(r,o.length),a=e(a),a[6]=a[6]&15|t,a[8]=a[8]&63|128,s){c=c||0;for(let f=0;f<16;++f)s[c+f]=a[f];return s}return(0,jo.unsafeStringify)(a)}try{n.name=i}catch{}return n.DNS=Wi,n.URL=Hi,n}var nn={};Object.defineProperty(nn,"__esModule",{value:!0});nn.default=void 0;function Wo(i){if(typeof i=="string"){const t=unescape(encodeURIComponent(i));i=new Uint8Array(t.length);for(let e=0;e<t.length;++e)i[e]=t.charCodeAt(e)}return Ho(qo(Go(i),i.length*8))}function Ho(i){const t=[],e=i.length*32,n="0123456789abcdef";for(let r=0;r<e;r+=8){const o=i[r>>5]>>>r%32&255,s=parseInt(n.charAt(o>>>4&15)+n.charAt(o&15),16);t.push(s)}return t}function qi(i){return(i+64>>>9<<4)+14+1}function qo(i,t){i[t>>5]|=128<<t%32,i[qi(t)-1]=t;let e=1732584193,n=-271733879,r=-1732584194,o=271733878;for(let s=0;s<i.length;s+=16){const c=e,d=n,a=r,f=o;e=Ce(e,n,r,o,i[s],7,-680876936),o=Ce(o,e,n,r,i[s+1],12,-389564586),r=Ce(r,o,e,n,i[s+2],17,606105819),n=Ce(n,r,o,e,i[s+3],22,-1044525330),e=Ce(e,n,r,o,i[s+4],7,-176418897),o=Ce(o,e,n,r,i[s+5],12,1200080426),r=Ce(r,o,e,n,i[s+6],17,-1473231341),n=Ce(n,r,o,e,i[s+7],22,-45705983),e=Ce(e,n,r,o,i[s+8],7,1770035416),o=Ce(o,e,n,r,i[s+9],12,-1958414417),r=Ce(r,o,e,n,i[s+10],17,-42063),n=Ce(n,r,o,e,i[s+11],22,-1990404162),e=Ce(e,n,r,o,i[s+12],7,1804603682),o=Ce(o,e,n,r,i[s+13],12,-40341101),r=Ce(r,o,e,n,i[s+14],17,-1502002290),n=Ce(n,r,o,e,i[s+15],22,1236535329),e=Re(e,n,r,o,i[s+1],5,-165796510),o=Re(o,e,n,r,i[s+6],9,-1069501632),r=Re(r,o,e,n,i[s+11],14,643717713),n=Re(n,r,o,e,i[s],20,-373897302),e=Re(e,n,r,o,i[s+5],5,-701558691),o=Re(o,e,n,r,i[s+10],9,38016083),r=Re(r,o,e,n,i[s+15],14,-660478335),n=Re(n,r,o,e,i[s+4],20,-405537848),e=Re(e,n,r,o,i[s+9],5,568446438),o=Re(o,e,n,r,i[s+14],9,-1019803690),r=Re(r,o,e,n,i[s+3],14,-187363961),n=Re(n,r,o,e,i[s+8],20,1163531501),e=Re(e,n,r,o,i[s+13],5,-1444681467),o=Re(o,e,n,r,i[s+2],9,-51403784),r=Re(r,o,e,n,i[s+7],14,1735328473),n=Re(n,r,o,e,i[s+12],20,-1926607734),e=_e(e,n,r,o,i[s+5],4,-378558),o=_e(o,e,n,r,i[s+8],11,-2022574463),r=_e(r,o,e,n,i[s+11],16,1839030562),n=_e(n,r,o,e,i[s+14],23,-35309556),e=_e(e,n,r,o,i[s+1],4,-1530992060),o=_e(o,e,n,r,i[s+4],11,1272893353),r=_e(r,o,e,n,i[s+7],16,-155497632),n=_e(n,r,o,e,i[s+10],23,-1094730640),e=_e(e,n,r,o,i[s+13],4,681279174),o=_e(o,e,n,r,i[s],11,-358537222),r=_e(r,o,e,n,i[s+3],16,-722521979),n=_e(n,r,o,e,i[s+6],23,76029189),e=_e(e,n,r,o,i[s+9],4,-640364487),o=_e(o,e,n,r,i[s+12],11,-421815835),r=_e(r,o,e,n,i[s+15],16,530742520),n=_e(n,r,o,e,i[s+2],23,-995338651),e=Ie(e,n,r,o,i[s],6,-198630844),o=Ie(o,e,n,r,i[s+7],10,1126891415),r=Ie(r,o,e,n,i[s+14],15,-1416354905),n=Ie(n,r,o,e,i[s+5],21,-57434055),e=Ie(e,n,r,o,i[s+12],6,1700485571),o=Ie(o,e,n,r,i[s+3],10,-1894986606),r=Ie(r,o,e,n,i[s+10],15,-1051523),n=Ie(n,r,o,e,i[s+1],21,-2054922799),e=Ie(e,n,r,o,i[s+8],6,1873313359),o=Ie(o,e,n,r,i[s+15],10,-30611744),r=Ie(r,o,e,n,i[s+6],15,-1560198380),n=Ie(n,r,o,e,i[s+13],21,1309151649),e=Ie(e,n,r,o,i[s+4],6,-145523070),o=Ie(o,e,n,r,i[s+11],10,-1120210379),r=Ie(r,o,e,n,i[s+2],15,718787259),n=Ie(n,r,o,e,i[s+9],21,-343485551),e=Ue(e,c),n=Ue(n,d),r=Ue(r,a),o=Ue(o,f)}return[e,n,r,o]}function Go(i){if(i.length===0)return[];const t=i.length*8,e=new Uint32Array(qi(t));for(let n=0;n<t;n+=8)e[n>>5]|=(i[n/8]&255)<<n%32;return e}function Ue(i,t){const e=(i&65535)+(t&65535);return(i>>16)+(t>>16)+(e>>16)<<16|e&65535}function zo(i,t){return i<<t|i>>>32-t}function rn(i,t,e,n,r,o){return Ue(zo(Ue(Ue(t,i),Ue(n,o)),r),e)}function Ce(i,t,e,n,r,o,s){return rn(t&e|~t&n,i,t,r,o,s)}function Re(i,t,e,n,r,o,s){return rn(t&n|e&~n,i,t,r,o,s)}function _e(i,t,e,n,r,o,s){return rn(t^e^n,i,t,r,o,s)}function Ie(i,t,e,n,r,o,s){return rn(e^(t|~n),i,t,r,o,s)}var Xo=Wo;nn.default=Xo;Object.defineProperty(tn,"__esModule",{value:!0});tn.default=void 0;var Jo=Gi(qe),Ko=Gi(nn);function Gi(i){return i&&i.__esModule?i:{default:i}}const Yo=(0,Jo.default)("v3",48,Ko.default);var Qo=Yo;tn.default=Qo;var on={},sn={};Object.defineProperty(sn,"__esModule",{value:!0});sn.default=void 0;const Zo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var es={randomUUID:Zo};sn.default=es;Object.defineProperty(on,"__esModule",{value:!0});on.default=void 0;var hi=zi(sn),ts=zi(Zt),ns=Ge;function zi(i){return i&&i.__esModule?i:{default:i}}function is(i,t,e){if(hi.default.randomUUID&&!t&&!i)return hi.default.randomUUID();i=i||{};const n=i.random||(i.rng||ts.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){e=e||0;for(let r=0;r<16;++r)t[e+r]=n[r];return t}return(0,ns.unsafeStringify)(n)}var rs=is;on.default=rs;var an={},cn={};Object.defineProperty(cn,"__esModule",{value:!0});cn.default=void 0;function os(i,t,e,n){switch(i){case 0:return t&e^~t&n;case 1:return t^e^n;case 2:return t&e^t&n^e&n;case 3:return t^e^n}}function Rn(i,t){return i<<t|i>>>32-t}function ss(i){const t=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof i=="string"){const s=unescape(encodeURIComponent(i));i=[];for(let c=0;c<s.length;++c)i.push(s.charCodeAt(c))}else Array.isArray(i)||(i=Array.prototype.slice.call(i));i.push(128);const n=i.length/4+2,r=Math.ceil(n/16),o=new Array(r);for(let s=0;s<r;++s){const c=new Uint32Array(16);for(let d=0;d<16;++d)c[d]=i[s*64+d*4]<<24|i[s*64+d*4+1]<<16|i[s*64+d*4+2]<<8|i[s*64+d*4+3];o[s]=c}o[r-1][14]=(i.length-1)*8/Math.pow(2,32),o[r-1][14]=Math.floor(o[r-1][14]),o[r-1][15]=(i.length-1)*8&4294967295;for(let s=0;s<r;++s){const c=new Uint32Array(80);for(let O=0;O<16;++O)c[O]=o[s][O];for(let O=16;O<80;++O)c[O]=Rn(c[O-3]^c[O-8]^c[O-14]^c[O-16],1);let d=e[0],a=e[1],f=e[2],v=e[3],m=e[4];for(let O=0;O<80;++O){const _=Math.floor(O/20),P=Rn(d,5)+os(_,a,f,v)+m+t[_]+c[O]>>>0;m=v,v=f,f=Rn(a,30)>>>0,a=d,d=P}e[0]=e[0]+d>>>0,e[1]=e[1]+a>>>0,e[2]=e[2]+f>>>0,e[3]=e[3]+v>>>0,e[4]=e[4]+m>>>0}return[e[0]>>24&255,e[0]>>16&255,e[0]>>8&255,e[0]&255,e[1]>>24&255,e[1]>>16&255,e[1]>>8&255,e[1]&255,e[2]>>24&255,e[2]>>16&255,e[2]>>8&255,e[2]&255,e[3]>>24&255,e[3]>>16&255,e[3]>>8&255,e[3]&255,e[4]>>24&255,e[4]>>16&255,e[4]>>8&255,e[4]&255]}var as=ss;cn.default=as;Object.defineProperty(an,"__esModule",{value:!0});an.default=void 0;var cs=Xi(qe),us=Xi(cn);function Xi(i){return i&&i.__esModule?i:{default:i}}const ds=(0,cs.default)("v5",80,us.default);var ls=ds;an.default=ls;var un={};Object.defineProperty(un,"__esModule",{value:!0});un.default=void 0;var fs="00000000-0000-0000-0000-000000000000";un.default=fs;var dn={};Object.defineProperty(dn,"__esModule",{value:!0});dn.default=void 0;var hs=ps(Qe);function ps(i){return i&&i.__esModule?i:{default:i}}function ms(i){if(!(0,hs.default)(i))throw TypeError("Invalid UUID");return parseInt(i.slice(14,15),16)}var vs=ms;dn.default=vs;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"NIL",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(i,"parse",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(i,"stringify",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(i,"v1",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(i,"v3",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(i,"v4",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(i,"v5",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(i,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(i,"version",{enumerable:!0,get:function(){return s.default}});var t=f(Qt),e=f(tn),n=f(on),r=f(an),o=f(un),s=f(dn),c=f(Qe),d=f(Ge),a=f(_t);function f(v){return v&&v.__esModule?v:{default:v}}})(zn);var Xn=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Ht=W&&W.__assign||function(){return Ht=Object.assign||function(i){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},Ht.apply(this,arguments)},_n=W&&W.__awaiter||function(i,t,e,n){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function c(f){try{a(n.next(f))}catch(v){s(v)}}function d(f){try{a(n.throw(f))}catch(v){s(v)}}function a(f){f.done?o(f.value):r(f.value).then(c,d)}a((n=n.apply(i,t||[])).next())})},In=W&&W.__generator||function(i,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(a){return function(f){return d([a,f])}}function d(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(e=0)),e;)try{if(n=1,r&&(o=a[0]&2?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,r=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){e.label=a[1];break}if(a[0]===6&&e.label<o[1]){e.label=o[1],o=a;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(a);break}o[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(i,e)}catch(f){a=[6,f],r=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(je,"__esModule",{value:!0});je.WebRtcPeerSendrecv=je.WebRtcPeerSendonly=je.WebRtcPeerRecvonly=je.WebRtcPeer=void 0;var gs=go,Es=zn,pi=Ye,bs=Ee,Ss=Ne,ve=bs.OpenViduLogger.getInstance(),ln=function(){function i(t){var e=this;this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],Ss.PlatformUtils.getInstance(),this.configuration=Ht(Ht({},t),{iceServers:t.iceServers&&t.iceServers.length>0?t.iceServers:gs(),mediaStream:t.mediaStream!==void 0?t.mediaStream:null,mode:t.mode?t.mode:"sendrecv",id:t.id?t.id:this.generateUniqueId()}),ve.debug(`[WebRtcPeer] configuration:
`.concat(JSON.stringify(this.configuration,null,2))),this.pc=new RTCPeerConnection({iceServers:this.configuration.iceServers}),this.pc.addEventListener("icecandidate",function(n){if(n.candidate!==null){var r=n.candidate,o=new RTCIceCandidate(r);e.configuration.onIceCandidate(o),o.candidate!==""&&e.localCandidatesQueue.push(o)}}),this.pc.addEventListener("signalingstatechange",function(){return _n(e,void 0,void 0,function(){var n,r;return In(this,function(o){switch(o.label){case 0:if(this.pc.signalingState!=="stable")return[3,6];o.label=1;case 1:if(!(this.iceCandidateList.length>0))return[3,6];n=this.iceCandidateList.shift(),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.pc.addIceCandidate(n)];case 3:return o.sent(),[3,5];case 4:return r=o.sent(),ve.error("Error when calling RTCPeerConnection#addIceCandidate for RTCPeerConnection "+this.getId(),r),[3,5];case 5:return[3,1];case 6:return[2]}})})})}return i.prototype.getId=function(){return this.configuration.id},i.prototype.dispose=function(){if(ve.debug("Disposing WebRtcPeer"),this.pc){if(this.pc.signalingState==="closed")return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},i.prototype.createOfferLegacy=function(){this.configuration.mediaStream&&this.deprecatedPeerConnectionTrackApi();var t=this.configuration.mediaConstraints.audio,e=this.configuration.mediaConstraints.video,n={offerToReceiveAudio:this.configuration.mode!=="sendonly"&&t,offerToReceiveVideo:this.configuration.mode!=="sendonly"&&e};return ve.debug("[createOfferLegacy] RTCPeerConnection.createOffer() options:",JSON.stringify(n)),this.pc.createOffer(n)},i.prototype.createOffer=function(){var t,e,n,r,o,s,c,d;return _n(this,void 0,void 0,function(){var a,f,v,m,O,_,P,y,b,k,T,I,M,D,z,g,x,w,q,B,L,u,E,w;return In(this,function(h){switch(h.label){case 0:if("addTransceiver"in this.pc)ve.debug("[createOffer] Method RTCPeerConnection.addTransceiver() is available; using it");else return ve.warn("[createOffer] Method RTCPeerConnection.addTransceiver() is NOT available; using LEGACY offerToReceive{Audio,Video}"),[2,this.createOfferLegacy()];if(this.configuration.mode==="recvonly")return[3,7];if(!this.configuration.mediaStream)throw new Error("[WebRtcPeer.createOffer] Direction is '".concat(this.configuration.mode,"', but no stream was configured to be sent"));a=0,f=this.configuration.mediaStream.getTracks(),h.label=1;case 1:if(!(a<f.length))return[3,6];if(v=f[a],m={direction:this.configuration.mode,streams:[this.configuration.mediaStream]},v.kind==="video"&&this.configuration.simulcast)for(O=v.getSettings(),_=v.getConstraints(),P=(n=(e=(t=O.width)!==null&&t!==void 0?t:_.width.ideal)!==null&&e!==void 0?e:_.width)!==null&&n!==void 0?n:0,y=(s=(o=(r=O.height)!==null&&r!==void 0?r:_.height.ideal)!==null&&o!==void 0?o:_.height)!==null&&s!==void 0?s:0,ve.info("[createOffer] Video track dimensions: ".concat(P,"x").concat(y)),b=P*y,k=0,b>=960*540?k=3:b>=480*270?k=2:k=1,m.sendEncodings=[],T=0;T<k;T++)I=Math.pow(2,k-T-1),M={rid:"rdiv"+I.toString(),scalabilityMode:"L1T1"},["detail","text"].includes(v.contentHint)?(M.scaleResolutionDownBy=1,M.maxFramerate=Math.floor(30/I)):M.scaleResolutionDownBy=I,m.sendEncodings.push(M);if(D=this.pc.addTransceiver(v,m),v.kind!=="video")return[3,5];if(z=D.sender.getParameters(),g=!1,!((c=z.degradationPreference)===null||c===void 0)&&c.length||(["detail","text"].includes(v.contentHint)?z.degradationPreference="maintain-resolution":z.degradationPreference="balanced",ve.info("[createOffer] Video sender Degradation Preference set: ".concat(z.degradationPreference)),g=!0),this.configuration.simulcast&&((d=z.encodings)===null||d===void 0?void 0:d.length)!==m.sendEncodings.length&&(z.encodings=m.sendEncodings,g=!0),!g)return[3,5];ve.debug("[createOffer] Setting new RTCRtpSendParameters to video sender"),h.label=2;case 2:return h.trys.push([2,4,,5]),[4,D.sender.setParameters(z)];case 3:return h.sent(),[3,5];case 4:throw x=h.sent(),w="[WebRtcPeer.createOffer] Cannot set RTCRtpSendParameters to video sender",x instanceof Error&&(w+=": ".concat(x.message)),new Error(w);case 5:return a++,[3,1];case 6:return[3,8];case 7:for(q=0,B=["audio","video"];q<B.length;q++)L=B[q],this.configuration.mediaConstraints[L]&&(this.configuration.mediaStream=new MediaStream,this.pc.addTransceiver(L,{direction:this.configuration.mode,streams:[this.configuration.mediaStream]}));h.label=8;case 8:return h.trys.push([8,10,,11]),[4,this.pc.createOffer()];case 9:return u=h.sent(),[3,11];case 10:throw E=h.sent(),w="[WebRtcPeer.createOffer] Browser failed creating an SDP Offer",E instanceof Error&&(w+=": ".concat(E.message)),new Error(w);case 11:return[2,u]}})})},i.prototype.deprecatedPeerConnectionTrackApi=function(){for(var t=0,e=this.configuration.mediaStream.getTracks();t<e.length;t++){var n=e[t];this.pc.addTrack(n,this.configuration.mediaStream)}},i.prototype.createAnswer=function(){var t=this;return new Promise(function(e,n){if("getTransceivers"in t.pc){ve.debug("[createAnswer] Method RTCPeerConnection.getTransceivers() is available; using it");for(var r=function(m){if(!t.configuration.mediaConstraints[m])return"continue";var O=t.pc.getTransceivers().find(function(_){return _.receiver.track.kind===m});if(O)O.direction=t.configuration.mode;else return{value:n(new Error("".concat(m," requested, but no transceiver was created from remote description")))}},o=0,s=["audio","video"];o<s.length;o++){var c=s[o],d=r(c);if(typeof d=="object")return d.value}t.pc.createAnswer().then(function(m){return e(m)}).catch(function(m){return n(m)})}else{var a=void 0,f=!0;if(t.configuration.mediaConstraints){a=typeof t.configuration.mediaConstraints.audio=="boolean"?t.configuration.mediaConstraints.audio:!0,f=typeof t.configuration.mediaConstraints.video=="boolean"?t.configuration.mediaConstraints.video:!0;var v={offerToReceiveAudio:a,offerToReceiveVideo:f};t.pc.createAnswer(v).then(function(m){return e(m)}).catch(function(m){return n(m)})}}})},i.prototype.processLocalOffer=function(t){var e=this;return new Promise(function(n,r){e.pc.setLocalDescription(t).then(function(){var o=e.pc.localDescription;return o?(ve.debug("Local description set",o.sdp),n()):r("Local description is not defined")}).catch(function(o){return r(o)})})},i.prototype.processRemoteOffer=function(t){var e=this;return new Promise(function(n,r){var o={type:"offer",sdp:t};if(ve.debug("SDP offer received, setting remote description",o),e.pc.signalingState==="closed")return r("RTCPeerConnection is closed when trying to set remote description");e.setRemoteDescription(o).then(function(){return n()}).catch(function(s){return r(s)})})},i.prototype.processLocalAnswer=function(t){var e=this;return new Promise(function(n,r){if(ve.debug("SDP answer created, setting local description"),e.pc.signalingState==="closed")return r("RTCPeerConnection is closed when trying to set local description");e.pc.setLocalDescription(t).then(function(){return n()}).catch(function(o){return r(o)})})},i.prototype.processRemoteAnswer=function(t){var e=this;return new Promise(function(n,r){var o={type:"answer",sdp:t};if(ve.debug("SDP answer received, setting remote description"),e.pc.signalingState==="closed")return r("RTCPeerConnection is closed when trying to set remote description");e.setRemoteDescription(o).then(function(){n()}).catch(function(s){return r(s)})})},i.prototype.setRemoteDescription=function(t){return _n(this,void 0,void 0,function(){return In(this,function(e){return[2,this.pc.setRemoteDescription(t)]})})},i.prototype.addIceCandidate=function(t){var e=this;return new Promise(function(n,r){switch(ve.debug("Remote ICE candidate received",t),e.remoteCandidatesQueue.push(t),e.pc.signalingState){case"closed":r(new Error("PeerConnection object is closed"));break;case"stable":e.pc.remoteDescription?e.pc.addIceCandidate(t).then(function(){return n()}).catch(function(o){return r(o)}):(e.iceCandidateList.push(t),n());break;default:e.iceCandidateList.push(t),n()}})},i.prototype.addIceConnectionStateChangeListener=function(t){var e=this;this.pc.addEventListener("iceconnectionstatechange",function(){var n=e.pc.iceConnectionState;switch(n){case"disconnected":var r="IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "disconnected". Possible network disconnection';ve.warn(r),e.configuration.onIceConnectionStateException(pi.ExceptionEventName.ICE_CONNECTION_DISCONNECTED,r);break;case"failed":var o="IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') to "failed"';ve.error(o),e.configuration.onIceConnectionStateException(pi.ExceptionEventName.ICE_CONNECTION_FAILED,o);break;case"closed":ve.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "closed"');break;case"new":ve.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "new"');break;case"checking":ve.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "checking"');break;case"connected":ve.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "connected"');break;case"completed":ve.log("IceConnectionState of RTCPeerConnection "+e.configuration.id+" ("+t+') change to "completed"');break}})},i.prototype.generateUniqueId=function(){return(0,Es.v4)()},i}();je.WebRtcPeer=ln;var ys=function(i){Xn(t,i);function t(e){return e.mode="recvonly",i.call(this,e)||this}return t}(ln);je.WebRtcPeerRecvonly=ys;var ws=function(i){Xn(t,i);function t(e){return e.mode="sendonly",i.call(this,e)||this}return t}(ln);je.WebRtcPeerSendonly=ws;var Os=function(i){Xn(t,i);function t(e){return e.mode="sendrecv",i.call(this,e)||this}return t}(ln);je.WebRtcPeerSendrecv=Os;var fn={},Ze=W&&W.__awaiter||function(i,t,e,n){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function c(f){try{a(n.next(f))}catch(v){s(v)}}function d(f){try{a(n.throw(f))}catch(v){s(v)}}function a(f){f.done?o(f.value):r(f.value).then(c,d)}a((n=n.apply(i,t||[])).next())})},et=W&&W.__generator||function(i,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(a){return function(f){return d([a,f])}}function d(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(e=0)),e;)try{if(n=1,r&&(o=a[0]&2?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,r=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){e.label=a[1];break}if(a[0]===6&&e.label<o[1]){e.label=o[1],o=a;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(a);break}o[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(i,e)}catch(f){a=[6,f],r=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(fn,"__esModule",{value:!0});fn.WebRtcStats=void 0;var Cs=Ee,Rs=Ne,Je=Cs.OpenViduLogger.getInstance(),tt,_s=function(){function i(t){this.stream=t,this.STATS_ITEM_NAME="webrtc-stats-config",this.webRtcStatsEnabled=!1,this.statsInterval=1,tt=Rs.PlatformUtils.getInstance()}return i.prototype.isEnabled=function(){return this.webRtcStatsEnabled},i.prototype.initWebRtcStats=function(){var t=this,e;try{e=localStorage.getItem(this.STATS_ITEM_NAME)}catch{}if(e){this.webRtcStatsEnabled=!0;var n=JSON.parse(e);Je.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),Je.warn("localStorage item: "+JSON.stringify(n)),this.POST_URL=n.httpEndpoint,this.statsInterval=n.interval,this.webRtcStatsIntervalId=setInterval(function(){return Ze(t,void 0,void 0,function(){return et(this,function(r){switch(r.label){case 0:return[4,this.sendStatsToHttpEndpoint()];case 1:return r.sent(),[2]}})})},this.statsInterval*1e3)}else Je.debug("WebRtc stats not enabled")},i.prototype.getSelectedIceCandidateInfo=function(){var t=this;return new Promise(function(e,n){return Ze(t,void 0,void 0,function(){var r,o,s,c,d,a,f,v,m,O,_,P,y,b,M,D,k,T,x,I,M,D,z,g,x;return et(this,function(q){switch(q.label){case 0:return[4,this.stream.getRTCPeerConnection().getStats()];case 1:if(r=q.sent(),s=new Map,c=new Map,d=new Map,r.forEach(function(B){switch(B.type==="transport"&&(tt.isChromium()||tt.isSafariBrowser()||tt.isReactNative())&&(o=B),B.type){case"candidate-pair":s.set(B.id,B);break;case"local-candidate":c.set(B.id,B);break;case"remote-candidate":d.set(B.id,B);break}}),o!=null)f=o.selectedCandidatePairId,a=s.get(f);else for(v=s.size,m=s.values(),O=0;O<v;O++)if(_=m.next().value,_.selected){a=_;break}if(P=a.localCandidateId,y=a.remoteCandidateId,b=c.get(P),b)for(M=this.stream.getLocalIceCandidateList(),D=M.filter(function(B){return!!B.candidate&&(B.candidate.indexOf(b.ip)>=0||B.candidate.indexOf(b.address)>=0)&&B.candidate.indexOf(b.port)>=0}),b.raw=[],k=0,T=D;k<T.length;k++)x=T[k],b.raw.push(x.candidate);else b="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";if(I=d.get(y),I)for(M=this.stream.getRemoteIceCandidateList(),D=M.filter(function(B){return!!B.candidate&&(B.candidate.indexOf(I.ip)>=0||B.candidate.indexOf(I.address)>=0)&&B.candidate.indexOf(I.port)>=0}),I.raw=[],z=0,g=D;z<g.length;z++)x=g[z],I.raw.push(x.candidate);else I="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";return[2,e({localCandidate:b,remoteCandidate:I})]}})})})},i.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),Je.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},i.prototype.sendStats=function(t,e){return Ze(this,void 0,void 0,function(){var n,r;return et(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n={headers:{"Content-type":"application/json"},body:JSON.stringify(e),method:"POST"},[4,fetch(t,n)];case 1:return o.sent(),[3,3];case 2:return r=o.sent(),Je.error("sendStats error: ".concat(JSON.stringify(r))),[3,3];case 3:return[2]}})})},i.prototype.sendStatsToHttpEndpoint=function(){return Ze(this,void 0,void 0,function(){var t,e,n;return et(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this.getCommonStats()];case 1:return t=r.sent(),e=this.generateJSONStatsResponse(t),[4,this.sendStats(this.POST_URL,e)];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),Je.log(n),[3,4];case 4:return[2]}})})},i.prototype.getCommonStats=function(){return Ze(this,void 0,void 0,function(){var t=this;return et(this,function(e){return[2,new Promise(function(n,r){return Ze(t,void 0,void 0,function(){var o,s,c,d,a,f=this;return et(this,function(v){switch(v.label){case 0:return v.trys.push([0,2,,3]),[4,this.stream.getRTCPeerConnection().getStats()];case 1:return o=v.sent(),s=this.getWebRtcStatsResponseOutline(),c=["framesReceived","framesDropped","framesSent","frameHeight","frameWidth"],d=["availableOutgoingBitrate","currentRoundTripTime"],o.forEach(function(m){var O=m.mediaType!=null?m.mediaType:m.kind,_=function(P,y){m[y]!=null&&s[P]!=null&&(!O&&c.indexOf(y)>-1&&(O="video"),P!=null&&O!=null&&y!=null&&s[P][O]!=null?s[P][O][y]=Number(m[y]):P!=null&&y!=null&&d.includes(y)&&(s[P][y]=Number(m[y])))};switch(m.type){case"outbound-rtp":_("outbound","bytesSent"),_("outbound","packetsSent"),_("outbound","framesEncoded"),_("outbound","nackCount"),_("outbound","firCount"),_("outbound","pliCount"),_("outbound","qpSum");break;case"inbound-rtp":_("inbound","bytesReceived"),_("inbound","packetsReceived"),_("inbound","packetsLost"),_("inbound","jitter"),_("inbound","framesDecoded"),_("inbound","nackCount"),_("inbound","firCount"),_("inbound","pliCount");break;case"track":_("inbound","jitterBufferDelay"),_("inbound","framesReceived"),_("outbound","framesDropped"),_("outbound","framesSent"),_(f.stream.isLocal()?"outbound":"inbound","frameHeight"),_(f.stream.isLocal()?"outbound":"inbound","frameWidth");break;case"candidate-pair":_("candidatepair","currentRoundTripTime"),_("candidatepair","availableOutgoingBitrate");break}}),(!(s!=null&&s.candidatepair)||Object.keys(s.candidatepair).length===0)&&delete s.candidatepair,[2,n(s)];case 2:return a=v.sent(),Je.error("Error getting common stats: ",a),[2,r(a)];case 3:return[2]}})})})]})})},i.prototype.generateJSONStatsResponse=function(t){return{"@timestamp":new Date().toISOString(),participant_id:this.stream.connection.data,session_id:this.stream.session.sessionId,platform:tt.getName(),platform_description:tt.getDescription(),stream:"webRTC",webrtc_stats:t}},i.prototype.getWebRtcStatsResponseOutline=function(){return this.stream.isLocal()?{outbound:{audio:{},video:{}},candidatepair:{}}:{inbound:{audio:{},video:{}}}},i}();fn.WebRtcStats=_s;var It={},Is=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(It,"__esModule",{value:!0});It.PublisherSpeakingEvent=void 0;var Ps=Se,Ts=function(i){Is(t,i);function t(e,n,r,o){var s=i.call(this,!1,e,n)||this;return s.type=n,s.connection=r,s.streamId=o,s}return t.prototype.callDefaultBehavior=function(){},t}(Ps.Event);It.PublisherSpeakingEvent=Ts;var hn={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.TypeOfVideo=void 0,function(t){t.CAMERA="CAMERA",t.SCREEN="SCREEN",t.CUSTOM="CUSTOM",t.IPCAM="IPCAM"}(i.TypeOfVideo||(i.TypeOfVideo={}))})(hn);var xs=qt;function qt(){}qt.mixin=function(i){var t=i.prototype||i;t.isWildEmitter=!0,t.on=function(e,n,r){this.callbacks=this.callbacks||{};var o=arguments.length===3,s=o?arguments[1]:void 0,c=o?arguments[2]:arguments[1];return c._groupName=s,(this.callbacks[e]=this.callbacks[e]||[]).push(c),this},t.once=function(e,n,r){var o=this,s=arguments.length===3,c=s?arguments[1]:void 0,d=s?arguments[2]:arguments[1];function a(){o.off(e,a),d.apply(this,arguments)}return this.on(e,c,a),this},t.releaseGroup=function(e){this.callbacks=this.callbacks||{};var n,r,o,s;for(n in this.callbacks)for(s=this.callbacks[n],r=0,o=s.length;r<o;r++)s[r]._groupName===e&&(s.splice(r,1),r--,o--);return this},t.off=function(e,n){this.callbacks=this.callbacks||{};var r=this.callbacks[e],o;return r?arguments.length===1?(delete this.callbacks[e],this):(o=r.indexOf(n),o!==-1&&(r.splice(o,1),r.length===0&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var n=[].slice.call(arguments,1),r=this.callbacks[e],o=this.getWildcardCallbacks(e),s,c,d;if(r)for(d=r.slice(),s=0,c=d.length;s<c&&d[s];++s)d[s].apply(this,n);if(o)for(c=o.length,d=o.slice(),s=0,c=d.length;s<c&&d[s];++s)d[s].apply(this,[e].concat(n));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var n,r,o=[];for(n in this.callbacks)r=n.split("*"),(n==="*"||r.length===2&&e.slice(0,r[0].length)===r[0])&&(o=o.concat(this.callbacks[n]));return o}};qt.mixin(qt);var ks=xs;function Ns(i,t){var e=-1/0;i.getFloatFrequencyData(t);for(var n=4,r=t.length;n<r;n++)t[n]>e&&t[n]<0&&(e=t[n]);return e}var Bn;typeof window<"u"&&(Bn=window.AudioContext||window.webkitAudioContext);var ke=null,Ls=function(i,n){var e=new ks;if(!Bn)return e;var n=n||{},r=n.smoothing||.1,o=n.interval||50,s=n.threshold,c=n.play,d=n.history||10,a=!0;ke=n.audioContext||ke||new Bn;var f,v,m;m=ke.createAnalyser(),m.fftSize=512,m.smoothingTimeConstant=r,v=new Float32Array(m.frequencyBinCount),i.jquery&&(i=i[0]),i instanceof HTMLAudioElement||i instanceof HTMLVideoElement?(f=ke.createMediaElementSource(i),typeof c>"u"&&(c=!0),s=s||-50):(f=ke.createMediaStreamSource(i),s=s||-50),f.connect(m),c&&m.connect(ke.destination),e.speaking=!1,e.suspend=function(){return ke.suspend()},e.resume=function(){return ke.resume()},Object.defineProperty(e,"state",{get:function(){return ke.state}}),ke.onstatechange=function(){e.emit("state_change",ke.state)},e.setThreshold=function(P){s=P},e.setInterval=function(P){o=P},e.stop=function(){a=!1,e.emit("volume_change",-100,s),e.speaking&&(e.speaking=!1,e.emit("stopped_speaking")),m.disconnect(),f.disconnect()},e.speakingHistory=[];for(var O=0;O<d;O++)e.speakingHistory.push(0);var _=function(){setTimeout(function(){if(a){var P=Ns(m,v);e.emit("volume_change",P,s);var y=0;if(P>s&&!e.speaking){for(var b=e.speakingHistory.length-3;b<e.speakingHistory.length;b++)y+=e.speakingHistory[b];y>=2&&(e.speaking=!0,e.emit("speaking"))}else if(P<s&&e.speaking){for(var b=0;b<e.speakingHistory.length;b++)y+=e.speakingHistory[b];y==0&&(e.speaking=!1,e.emit("stopped_speaking"))}e.speakingHistory.shift(),e.speakingHistory.push(0+(P>s)),_()}},o)};return _(),e},Ae=W&&W.__awaiter||function(i,t,e,n){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function c(f){try{a(n.next(f))}catch(v){s(v)}}function d(f){try{a(n.throw(f))}catch(v){s(v)}}function a(f){f.done?o(f.value):r(f.value).then(c,d)}a((n=n.apply(i,t||[])).next())})},Ve=W&&W.__generator||function(i,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(a){return function(f){return d([a,f])}}function d(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(e=0)),e;)try{if(n=1,r&&(o=a[0]&2?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,r=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){e.label=a[1];break}if(a[0]===6&&e.label<o[1]){e.label=o[1],o=a;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(a);break}o[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(i,e)}catch(f){a=[6,f],r=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(st,"__esModule",{value:!0});st.Stream=void 0;var Pn=at,Ms=ct,Tn=je,As=fn,Et=Ye,$e=It,mi=lt,Bt=Be,ge=Ke,Fe=hn,Vs=Ee,Ds=Ne,js=zn,Bs=Ls,vi=Gn,oe=Vs.OpenViduLogger.getInstance(),gi,$s=function(){function i(t,e){var n=this;this.isSubscribeToRemote=!1,this.isLocalStreamReadyToPublish=!1,this.isLocalStreamPublished=!1,this.publishedOnce=!1,this.harkSpeakingEnabled=!1,this.harkSpeakingEnabledOnce=!1,this.harkStoppedSpeakingEnabled=!1,this.harkStoppedSpeakingEnabledOnce=!1,this.harkVolumeChangeEnabled=!1,this.harkVolumeChangeEnabledOnce=!1,this.ee=new vi,gi=Ds.PlatformUtils.getInstance(),this.session=t,e.hasOwnProperty("id")?(this.inboundStreamOpts=e,this.streamId=this.inboundStreamOpts.id,this.creationTime=this.inboundStreamOpts.createdAt,this.hasAudio=this.inboundStreamOpts.hasAudio,this.hasVideo=this.inboundStreamOpts.hasVideo,this.hasAudio&&(this.audioActive=this.inboundStreamOpts.audioActive),this.hasVideo&&(this.videoActive=this.inboundStreamOpts.videoActive,this.typeOfVideo=this.inboundStreamOpts.typeOfVideo?this.inboundStreamOpts.typeOfVideo:void 0,this.frameRate=this.inboundStreamOpts.frameRate===-1?void 0:this.inboundStreamOpts.frameRate,this.videoDimensions=this.inboundStreamOpts.videoDimensions),this.inboundStreamOpts.filter&&Object.keys(this.inboundStreamOpts.filter).length>0&&(this.inboundStreamOpts.filter.lastExecMethod&&Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length===0&&delete this.inboundStreamOpts.filter.lastExecMethod,this.filter=this.inboundStreamOpts.filter)):(this.outboundStreamOpts=e,this.hasAudio=this.isSendAudio(),this.hasVideo=this.isSendVideo(),this.hasAudio&&(this.audioActive=!!this.outboundStreamOpts.publisherProperties.publishAudio),this.hasVideo&&(this.videoActive=!!this.outboundStreamOpts.publisherProperties.publishVideo,this.frameRate=this.outboundStreamOpts.publisherProperties.frameRate,typeof MediaStreamTrack<"u"&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?this.typeOfVideo=Fe.TypeOfVideo.CUSTOM:this.typeOfVideo=this.isSendScreen()?Fe.TypeOfVideo.SCREEN:Fe.TypeOfVideo.CAMERA),this.outboundStreamOpts.publisherProperties.filter&&(this.filter=this.outboundStreamOpts.publisherProperties.filter)),this.ee.on("mediastream-updated",function(){var r;n.streamManager.updateMediaStream(n.mediaStream),oe.debug("Video srcObject ["+((r=n.mediaStream)===null||r===void 0?void 0:r.id)+"] updated in stream ["+n.streamId+"]")})}return i.prototype.reconnect=function(){return this.reconnectStream("API")},i.prototype.applyFilter=function(t,e){var n=this;return new Promise(function(r,o){return Ae(n,void 0,void 0,function(){var s,c,d,a,f,v,m=this;return Ve(this,function(O){if(this.filter)return[2,o(new ge.OpenViduError(ge.OpenViduErrorName.GENERIC_ERROR,"There is already a filter applied to Stream "+this.streamId))];if(s=function(_,P){if(_)return oe.error("Error applying filter for Stream "+m.streamId,_),_.code===401?o(new ge.OpenViduError(ge.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):o(_);oe.info("Filter successfully applied on Stream "+m.streamId);var y=m.filter;return m.filter=new Pn.Filter(t,e),m.filter.stream=m,P&&(m.session.emitEvent("streamPropertyChanged",[new Bt.StreamPropertyChangedEvent(m.session,m,"filter",m.filter,y,"applyFilter")]),m.streamManager.emitEvent("streamPropertyChanged",[new Bt.StreamPropertyChangedEvent(m.streamManager,m,"filter",m.filter,y,"applyFilter")])),r(m.filter)},t.startsWith("VB:")){if(!this.hasVideo)return[2,o(new ge.OpenViduError(ge.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"The Virtual Background filter requires a video track to be applied"))];if(!this.mediaStream||this.streamManager.videos.length===0)return[2,o(new ge.OpenViduError(ge.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"The StreamManager requires some video element to be attached to it in order to apply a Virtual Background filter"))];if(this.session.token?c=this.session.token:c=e.token,!c)return[2,o(new ge.OpenViduError(ge.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,'Virtual Background requires the client to be connected to a Session or to have a "token" property available in "options" parameter with a valid OpenVidu token'))];if(d=this.session.getTokenParams(c),d.edition!=="pro"&&d.edition!=="enterprise")return[2,o(new ge.OpenViduError(ge.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"OpenVidu Virtual Background API is available from OpenVidu Pro edition onwards"))];c=encodeURIComponent(btoa(c)),oe.info("Applying Virtual Background to stream "+this.streamId),a=function(){return Ae(m,void 0,void 0,function(){var _,P,y,b,k,T,I;return Ve(this,function(M){switch(M.label){case 0:return M.trys.push([0,8,,9]),_=this.streamId+"_"+(0,js.v4)(),P=this.mediaStream.clone(),y=this.streamManager.videos[0].video.cloneNode(!1),y.id=VirtualBackground.VirtualBackground.SOURCE_VIDEO_PREFIX+_,y.srcObject=P,y.muted=!0,this.virtualBackgroundSourceElements={videoClone:y,mediaStreamClone:P},VirtualBackground.VirtualBackground.hideHtmlElement(y,!1),VirtualBackground.VirtualBackground.appendHtmlElementToHiddenContainer(y,_),[4,y.play()];case 1:switch(M.sent(),b=new VirtualBackground.VirtualBackground({id:_,openviduServerUrl:new URL(d.httpUri),openviduToken:c,inputVideo:y,inputResolution:"160x96",outputFramerate:24}),k=void 0,T=t,T){case"VB:blur":return[3,2];case"VB:image":return[3,4]}return[3,6];case 2:return[4,b.backgroundBlur(e)];case 3:return k=M.sent(),[3,7];case 4:return[4,b.backgroundImage(e)];case 5:return k=M.sent(),[3,7];case 6:throw new Error("Unknown Virtual Background filter: "+t);case 7:return this.virtualBackgroundSinkElements={VB:b,video:k},y.style.display="none",this.streamManager.remote?this.streamManager.replaceTrackInMediaStream(this.virtualBackgroundSinkElements.video.srcObject.getVideoTracks()[0],!1):this.streamManager.replaceTrackAux(this.virtualBackgroundSinkElements.video.srcObject.getVideoTracks()[0],!1),s(void 0,!1),[3,9];case 8:return I=M.sent(),I.name===ge.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR?s(new ge.OpenViduError(ge.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,I.message),!1):s(I,!1),[3,9];case 9:return[2]}})})},typeof VirtualBackground>"u"?(f=document.createElement("script"),f.type="text/javascript",f.src=d.httpUri+"/openvidu/virtual-background/openvidu-virtual-background.js?token="+c,f.onload=function(){return Ae(m,void 0,void 0,function(){var _;return Ve(this,function(P){switch(P.label){case 0:return P.trys.push([0,2,,3]),[4,a()];case 1:return P.sent(),r(new Pn.Filter(t,e)),[3,3];case 2:return _=P.sent(),o(_),[3,3];case 3:return[2]}})})},document.body.appendChild(f)):a().then(function(){return r(new Pn.Filter(t,e))}).catch(function(_){return o(_)})}else{if(!this.session.sessionConnected())return[2,o(this.session.notConnectedError())];oe.info("Applying server filter to stream "+this.streamId),e=e??{},v=e,typeof v!="string"&&(v=JSON.stringify(v)),this.session.openvidu.sendRequest("applyFilter",{streamId:this.streamId,type:t,options:v},function(_,P){s(_,!0)})}return[2]})})})},i.prototype.removeFilter=function(){return Ae(this,void 0,void 0,function(){return Ve(this,function(t){switch(t.label){case 0:return[4,this.removeFilterAux(!1)];case 1:return[2,t.sent()]}})})},i.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},i.prototype.getMediaStream=function(){return this.mediaStream},i.prototype.removeFilterAux=function(t){var e=this;return new Promise(function(n,r){return Ae(e,void 0,void 0,function(){var o,s,c,d=this,a;return Ve(this,function(f){switch(f.label){case 0:if(o=function(v,m){if(v)return delete d.filter,oe.error("Error removing filter for Stream "+d.streamId,v),v.code===401?r(new ge.OpenViduError(ge.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):r(v);oe.info("Filter successfully removed from Stream "+d.streamId);var O=d.filter;return delete d.filter,m&&(d.session.emitEvent("streamPropertyChanged",[new Bt.StreamPropertyChangedEvent(d.session,d,"filter",d.filter,O,"applyFilter")]),d.streamManager.emitEvent("streamPropertyChanged",[new Bt.StreamPropertyChangedEvent(d.streamManager,d,"filter",d.filter,O,"applyFilter")])),n()},!this.filter)return[3,11];if(!(!((a=this.filter)===null||a===void 0)&&a.type.startsWith("VB:")))return[3,9];f.label=1;case 1:return f.trys.push([1,7,,8]),s=this.virtualBackgroundSourceElements.mediaStreamClone,t?[3,5]:this.streamManager.remote?(this.streamManager.replaceTrackInMediaStream(s.getVideoTracks()[0],!1),[3,4]):[3,2];case 2:return[4,this.streamManager.replaceTrackAux(s.getVideoTracks()[0],!1)];case 3:f.sent(),f.label=4;case 4:return[3,6];case 5:s.getTracks().forEach(function(v){return v.stop()}),f.label=6;case 6:return this.virtualBackgroundSinkElements.VB.cleanUp(),delete this.virtualBackgroundSinkElements,delete this.virtualBackgroundSourceElements,[2,o(void 0,!1)];case 7:return c=f.sent(),[2,o(c,!1)];case 8:return[3,10];case 9:if(!this.session.sessionConnected())return[2,r(this.session.notConnectedError())];oe.info("Removing filter of stream "+this.streamId),this.session.openvidu.sendRequest("removeFilter",{streamId:this.streamId},function(v,m){return o(v,!0)}),f.label=10;case 10:return[3,12];case 11:return[2,r(new ge.OpenViduError(ge.OpenViduErrorName.GENERIC_ERROR,"Stream "+this.streamId+" has no filter applied"))];case 12:return[2]}})})})},i.prototype.setMediaStream=function(t){this.mediaStream=t},i.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},i.prototype.getWebRtcPeer=function(){return this.webRtcPeer},i.prototype.subscribeToMyRemote=function(t){this.isSubscribeToRemote=t},i.prototype.setOutboundStreamOptions=function(t){this.outboundStreamOpts=t},i.prototype.subscribe=function(){var t=this;return new Promise(function(e,n){t.initWebRtcPeerReceive(!1).then(function(){return e()}).catch(function(r){return n(r)})})},i.prototype.publish=function(){var t=this;return new Promise(function(e,n){t.isLocalStreamReadyToPublish?t.initWebRtcPeerSend(!1).then(function(){return e()}).catch(function(r){return n(r)}):t.ee.once("stream-ready-to-publish",function(){t.publish().then(function(){return e()}).catch(function(r){return n(r)})})})},i.prototype.disposeWebRtcPeer=function(){var t;this.webRtcPeer&&(this.webRtcPeer.dispose(),t=this.webRtcPeer.getId()),this.stopWebRtcStats(),oe.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"RTCPeerConnection with id ["+t+"] from 'Stream' with id ["+this.streamId+"] is now closed")},i.prototype.disposeMediaStream=function(){return Ae(this,void 0,void 0,function(){var t;return Ve(this,function(e){switch(e.label){case 0:if(!(this.filter&&this.filter.type.startsWith("VB:")))return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.removeFilterAux(!0)];case 2:return e.sent(),console.debug("Success removing Virtual Background filter for stream ".concat(this.streamId)),[3,4];case 3:return t=e.sent(),console.error("Error removing Virtual Background filter for stream ".concat(this.streamId),t),[3,4];case 4:return this.mediaStream&&(this.mediaStream.getAudioTracks().forEach(function(n){n.stop()}),this.mediaStream.getVideoTracks().forEach(function(n){n.stop()}),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach(function(n){n.stop()}),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach(function(n){n.stop()}),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),oe.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed"),[2]}})})},i.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},i.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&this.outboundStreamOpts.publisherProperties.audioSource!==null&&this.outboundStreamOpts.publisherProperties.audioSource!==!1},i.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&this.outboundStreamOpts.publisherProperties.videoSource!==null&&this.outboundStreamOpts.publisherProperties.videoSource!==!1},i.prototype.isSendScreen=function(){var t=!1;if(typeof MediaStreamTrack<"u"&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack){var e=this.outboundStreamOpts.publisherProperties.videoSource.getSettings();e.displaySurface&&(t=["monitor","window","browser"].includes(e.displaySurface))}return!t&&gi.isElectron()&&(t=typeof this.outboundStreamOpts.publisherProperties.videoSource=="string"&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),t||(t=this.outboundStreamOpts.publisherProperties.videoSource==="screen"),!!this.outboundStreamOpts&&t},i.prototype.enableHarkSpeakingEvent=function(){var t=this;this.setHarkListenerIfNotExists(),!this.harkSpeakingEnabled&&this.speechEvent&&(this.harkSpeakingEnabled=!0,this.speechEvent.on("speaking",function(){t.session.emitEvent("publisherStartSpeaking",[new $e.PublisherSpeakingEvent(t.session,"publisherStartSpeaking",t.connection,t.streamId)]),t.streamManager.emitEvent("publisherStartSpeaking",[new $e.PublisherSpeakingEvent(t.streamManager,"publisherStartSpeaking",t.connection,t.streamId)]),t.harkSpeakingEnabledOnce=!1}))},i.prototype.enableOnceHarkSpeakingEvent=function(){var t=this;this.setHarkListenerIfNotExists(),!this.harkSpeakingEnabledOnce&&this.speechEvent&&(this.harkSpeakingEnabledOnce=!0,this.speechEvent.once("speaking",function(){t.harkSpeakingEnabledOnce&&(t.session.emitEvent("publisherStartSpeaking",[new $e.PublisherSpeakingEvent(t.session,"publisherStartSpeaking",t.connection,t.streamId)]),t.streamManager.emitEvent("publisherStartSpeaking",[new $e.PublisherSpeakingEvent(t.streamManager,"publisherStartSpeaking",t.connection,t.streamId)])),t.disableHarkSpeakingEvent(!0)}))},i.prototype.disableHarkSpeakingEvent=function(t){if(this.speechEvent){if(this.harkSpeakingEnabledOnce=!1,t){if(this.harkSpeakingEnabled)return}else this.harkSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},i.prototype.enableHarkStoppedSpeakingEvent=function(){var t=this;this.setHarkListenerIfNotExists(),!this.harkStoppedSpeakingEnabled&&this.speechEvent&&(this.harkStoppedSpeakingEnabled=!0,this.speechEvent.on("stopped_speaking",function(){t.session.emitEvent("publisherStopSpeaking",[new $e.PublisherSpeakingEvent(t.session,"publisherStopSpeaking",t.connection,t.streamId)]),t.streamManager.emitEvent("publisherStopSpeaking",[new $e.PublisherSpeakingEvent(t.streamManager,"publisherStopSpeaking",t.connection,t.streamId)]),t.harkStoppedSpeakingEnabledOnce=!1}))},i.prototype.enableOnceHarkStoppedSpeakingEvent=function(){var t=this;this.setHarkListenerIfNotExists(),!this.harkStoppedSpeakingEnabledOnce&&this.speechEvent&&(this.harkStoppedSpeakingEnabledOnce=!0,this.speechEvent.once("stopped_speaking",function(){t.harkStoppedSpeakingEnabledOnce&&(t.session.emitEvent("publisherStopSpeaking",[new $e.PublisherSpeakingEvent(t.session,"publisherStopSpeaking",t.connection,t.streamId)]),t.streamManager.emitEvent("publisherStopSpeaking",[new $e.PublisherSpeakingEvent(t.streamManager,"publisherStopSpeaking",t.connection,t.streamId)])),t.disableHarkStoppedSpeakingEvent(!0)}))},i.prototype.disableHarkStoppedSpeakingEvent=function(t){if(this.speechEvent){if(this.harkStoppedSpeakingEnabledOnce=!1,t){if(this.harkStoppedSpeakingEnabled)return}else this.harkStoppedSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},i.prototype.enableHarkVolumeChangeEvent=function(t){var e=this;this.setHarkListenerIfNotExists()?(!this.harkVolumeChangeEnabled||t)&&(this.harkVolumeChangeEnabled=!0,this.speechEvent.on("volume_change",function(n){var r=e.speechEvent.oldVolumeValue,o={newValue:n,oldValue:r};e.speechEvent.oldVolumeValue=n,e.streamManager.emitEvent("streamAudioVolumeChange",[new mi.StreamManagerEvent(e.streamManager,"streamAudioVolumeChange",o)])})):this.harkVolumeChangeEnabled=!0},i.prototype.enableOnceHarkVolumeChangeEvent=function(t){var e=this;this.setHarkListenerIfNotExists()?(!this.harkVolumeChangeEnabledOnce||t)&&(this.harkVolumeChangeEnabledOnce=!0,this.speechEvent.once("volume_change",function(n){var r=e.speechEvent.oldVolumeValue,o={newValue:n,oldValue:r};e.speechEvent.oldVolumeValue=n,e.disableHarkVolumeChangeEvent(!0),e.streamManager.emitEvent("streamAudioVolumeChange",[new mi.StreamManagerEvent(e.streamManager,"streamAudioVolumeChange",o)])})):this.harkVolumeChangeEnabledOnce=!0},i.prototype.disableHarkVolumeChangeEvent=function(t){if(this.speechEvent){if(this.harkVolumeChangeEnabledOnce=!1,t){if(this.harkVolumeChangeEnabled)return}else this.harkVolumeChangeEnabled=!1;this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},i.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},i.prototype.getSelectedIceCandidate=function(){var t=this;return new Promise(function(e,n){t.webRtcStats.getSelectedIceCandidateInfo().then(function(r){return e(r)}).catch(function(r){return n(r)})})},i.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},i.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},i.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return oe.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Stream '.concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") will force a reconnection")),!0;var t=this.getRTCPeerConnection().iceConnectionState;return t!=="connected"&&t!=="completed"},i.prototype.setHarkListenerIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var t=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};t.interval=typeof t.interval=="number"?t.interval:100,t.threshold=typeof t.threshold=="number"?t.threshold:-50,this.speechEvent=Bs(this.mediaStream,t)}return!0}return!1},i.prototype.setupReconnectionEventEmitter=function(t,e){return this.reconnectionEventEmitter==null?(this.reconnectionEventEmitter=new vi,!1):(console.warn("Trying to reconnect stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") but an ongoing reconnection process is active. Waiting for response...")),this.reconnectionEventEmitter.once("success",function(){return t()}),this.reconnectionEventEmitter.once("error",function(n){return e(n)}),!0)},i.prototype.initWebRtcPeerSend=function(t){var e=this;return new Promise(function(n,r){var o;if(t){if(e.setupReconnectionEventEmitter(n,r))return}else e.initHarkEvents();var s=function(){var f;return t&&((f=e.reconnectionEventEmitter)===null||f===void 0||f.emitEvent("success"),delete e.reconnectionEventEmitter),n()},c=function(f){var v;return t&&((v=e.reconnectionEventEmitter)===null||v===void 0||v.emitEvent("error",[f]),delete e.reconnectionEventEmitter),r(f)},d=function(f){oe.debug("Sending SDP offer to publish as "+e.streamId,f);var v=t?"reconnectStream":"publishVideo",m;if(t)m={stream:e.streamId,sdpString:f};else{var O=void 0;e.isSendVideo()&&(O=typeof MediaStreamTrack<"u"&&e.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?Fe.TypeOfVideo.CUSTOM:e.isSendScreen()?Fe.TypeOfVideo.SCREEN:Fe.TypeOfVideo.CAMERA),m={doLoopback:e.displayMyRemote()||!1,hasAudio:e.isSendAudio(),hasVideo:e.isSendVideo(),audioActive:e.audioActive,videoActive:e.videoActive,typeOfVideo:O,frameRate:e.frameRate?e.frameRate:-1,videoDimensions:JSON.stringify(e.videoDimensions),filter:e.outboundStreamOpts.publisherProperties.filter,sdpOffer:f}}e.session.openvidu.sendRequest(v,m,function(_,P){_?_.code===401?c(new ge.OpenViduError(ge.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):c("Error on publishVideo: "+JSON.stringify(_)):e.webRtcPeer.processRemoteAnswer(P.sdpAnswer).then(function(){e.streamId=P.id,e.creationTime=P.createdAt,e.isLocalStreamPublished=!0,e.publishedOnce=!0,e.displayMyRemote()&&(e.localMediaStreamWhenSubscribedToRemote=e.mediaStream,e.remotePeerSuccessfullyEstablished(t)),t?e.ee.emitEvent("stream-reconnected-by-publisher",[]):e.ee.emitEvent("stream-created-by-publisher",[]),e.initWebRtcStats(),oe.info("'Publisher' ("+e.streamId+") successfully "+(t?"reconnected":"published")+" to session"),s()}).catch(function(y){c(y)})})},a={mediaConstraints:{audio:e.hasAudio,video:e.hasVideo},simulcast:(o=e.outboundStreamOpts.publisherProperties.videoSimulcast)!==null&&o!==void 0?o:e.session.openvidu.videoSimulcast,onIceCandidate:e.connection.sendIceCandidate.bind(e.connection),onIceConnectionStateException:e.onIceConnectionStateExceptionHandler.bind(e),iceServers:e.getIceServersConf(),mediaStream:e.mediaStream,mediaServer:e.session.openvidu.mediaServer,typeOfVideo:e.typeOfVideo?Fe.TypeOfVideo[e.typeOfVideo]:void 0};e.session.openvidu.mediaServer!=="mediasoup"&&(a.simulcast=!1),t&&e.disposeWebRtcPeer(),e.displayMyRemote()?e.webRtcPeer=new Tn.WebRtcPeerSendrecv(a):e.webRtcPeer=new Tn.WebRtcPeerSendonly(a),e.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+e.connection.connectionId),e.webRtcPeer.createOffer().then(function(f){e.webRtcPeer.processLocalOffer(f).then(function(){d(f.sdp)}).catch(function(v){c(new Error("(publish) SDP process local offer error: "+JSON.stringify(v)))})}).catch(function(f){c(new Error("(publish) SDP create offer error: "+JSON.stringify(f)))})})},i.prototype.finalResolveForSubscription=function(t,e){var n;return oe.info("'Subscriber' ("+this.streamId+") successfully "+(t?"reconnected":"subscribed")),this.remotePeerSuccessfullyEstablished(t),this.initWebRtcStats(),t&&((n=this.reconnectionEventEmitter)===null||n===void 0||n.emitEvent("success"),delete this.reconnectionEventEmitter),e()},i.prototype.finalRejectForSubscription=function(t,e,n){var r;return oe.error("Error for 'Subscriber' ("+this.streamId+") while trying to "+(t?"reconnect":"subscribe")+": "+e.toString()),t&&((r=this.reconnectionEventEmitter)===null||r===void 0||r.emitEvent("error",[e]),delete this.reconnectionEventEmitter),n(e)},i.prototype.initWebRtcPeerReceive=function(t){var e=this;return new Promise(function(n,r){t&&e.setupReconnectionEventEmitter(n,r)||(e.session.openvidu.mediaServer==="mediasoup"?e.initWebRtcPeerReceiveFromServer(t).then(function(){return e.finalResolveForSubscription(t,n)}).catch(function(o){return e.finalRejectForSubscription(t,o,r)}):e.initWebRtcPeerReceiveFromClient(t).then(function(){return e.finalResolveForSubscription(t,n)}).catch(function(o){return e.finalRejectForSubscription(t,o,r)}))})},i.prototype.initWebRtcPeerReceiveFromClient=function(t){var e=this;return new Promise(function(n,r){e.completeWebRtcPeerReceive(t,!1).then(function(o){e.webRtcPeer.processRemoteAnswer(o.sdpAnswer).then(function(){return n()}).catch(function(s){return r(s)})}).catch(function(o){return r(o)})})},i.prototype.initWebRtcPeerReceiveFromServer=function(t){var e=this;return new Promise(function(n,r){e.session.openvidu.sendRequest("prepareReceiveVideoFrom",{sender:e.streamId,reconnect:t},function(o,s){if(o)return r(new Error("Error on prepareReceiveVideoFrom: "+JSON.stringify(o)));e.completeWebRtcPeerReceive(t,!1,s.sdpOffer).then(function(){return n()}).catch(function(c){return r(c)})})})},i.prototype.completeWebRtcPeerReceive=function(t,e,n){var r=this;return new Promise(function(o,s){oe.debug("'Session.subscribe(Stream)' called");var c=function(a){oe.debug("Sending local SDP ".concat(n?"answer":"offer"," to subscribe to ").concat(r.streamId),a);var f=t?"reconnectStream":"receiveVideoFrom",v={};v[t?"stream":"sender"]=r.streamId,n?v[t?"sdpString":"sdpAnswer"]=a:v.sdpOffer=a,t&&(v.forciblyReconnect=e),r.session.openvidu.sendRequest(f,v,function(m,O){return m?s(new Error("Error on "+f+" : "+JSON.stringify(m))):o(O)})},d={mediaConstraints:{audio:r.hasAudio,video:r.hasVideo},simulcast:!1,onIceCandidate:r.connection.sendIceCandidate.bind(r.connection),onIceConnectionStateException:r.onIceConnectionStateExceptionHandler.bind(r),iceServers:r.getIceServersConf(),mediaServer:r.session.openvidu.mediaServer,typeOfVideo:r.typeOfVideo?Fe.TypeOfVideo[r.typeOfVideo]:void 0};t&&r.disposeWebRtcPeer(),r.webRtcPeer=new Tn.WebRtcPeerRecvonly(d),r.webRtcPeer.addIceConnectionStateChangeListener(r.streamId),n?r.webRtcPeer.processRemoteOffer(n).then(function(){r.webRtcPeer.createAnswer().then(function(a){r.webRtcPeer.processLocalAnswer(a).then(function(){c(a.sdp)}).catch(function(f){return s(new Error("(subscribe) SDP process local answer error: "+JSON.stringify(f)))})}).catch(function(a){return s(new Error("(subscribe) SDP create answer error: "+JSON.stringify(a)))})}).catch(function(a){return s(new Error("(subscribe) SDP process remote offer error: "+JSON.stringify(a)))}):r.webRtcPeer.createOffer().then(function(a){r.webRtcPeer.processLocalOffer(a).then(function(){c(a.sdp)}).catch(function(f){return s(new Error("(subscribe) SDP process local offer error: "+JSON.stringify(f)))})}).catch(function(a){return s(new Error("(subscribe) SDP create offer error: "+JSON.stringify(a)))})})},i.prototype.remotePeerSuccessfullyEstablished=function(t){t&&this.mediaStream!=null&&this.disposeMediaStream(),this.mediaStream=new MediaStream;for(var e,n=0,r=this.webRtcPeer.pc.getReceivers();n<r.length;n++)e=r[n],e.track&&this.mediaStream.addTrack(e.track);if(oe.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof Ms.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var o=t?this.audioActive:!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=o}if(this.mediaStream.getVideoTracks()[0]){var o=t?this.videoActive:!!this.videoActive&&!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=o}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},i.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!0,this.streamManager)&&this.enableOnceHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.streamManager)&&this.enableHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!0,this.streamManager)&&this.enableOnceHarkStoppedSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.streamManager)&&this.enableHarkStoppedSpeakingEvent(),this.harkVolumeChangeEnabledOnce&&this.enableOnceHarkVolumeChangeEvent(!0),this.harkVolumeChangeEnabled&&this.enableHarkVolumeChangeEvent(!0))},i.prototype.onIceConnectionStateExceptionHandler=function(t,e,n){switch(t){case Et.ExceptionEventName.ICE_CONNECTION_FAILED:this.onIceConnectionFailed();break;case Et.ExceptionEventName.ICE_CONNECTION_DISCONNECTED:this.onIceConnectionDisconnected();break}this.session.emitEvent("exception",[new Et.ExceptionEvent(this.session,t,this,e,n)])},i.prototype.onIceConnectionFailed=function(){oe.log("[ICE_CONNECTION_FAILED] Handling ICE_CONNECTION_FAILED event. Reconnecting stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",")")),this.reconnectStreamAndLogResultingIceConnectionState(Et.ExceptionEventName.ICE_CONNECTION_FAILED)},i.prototype.onIceConnectionDisconnected=function(){var t=this;oe.log("[ICE_CONNECTION_DISCONNECTED] Handling ICE_CONNECTION_DISCONNECTED event. Waiting for ICE to be restored and reconnect stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") if not possible"));var e=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3;this.awaitWebRtcPeerConnectionState(e).then(function(n){switch(n){case"failed":oe.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(t.streamId," (").concat(t.isLocal()?"Publisher":"Subscriber",") is now failed after ICE_CONNECTION_DISCONNECTED"));break;case"connected":case"completed":oe.log("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(t.streamId," (").concat(t.isLocal()?"Publisher":"Subscriber",") automatically restored after ICE_CONNECTION_DISCONNECTED. Current ICE connection state: ").concat(n));break;case"closed":case"checking":case"new":case"disconnected":oe.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(t.streamId," (").concat(t.isLocal()?"Publisher":"Subscriber",") couldn't be restored after ICE_CONNECTION_DISCONNECTED event. Current ICE connection state after ").concat(e," ms: ").concat(n)),t.reconnectStreamAndLogResultingIceConnectionState(Et.ExceptionEventName.ICE_CONNECTION_DISCONNECTED);break}})},i.prototype.reconnectStreamAndLogResultingIceConnectionState=function(t){return Ae(this,void 0,void 0,function(){var e,n;return Ve(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.reconnectStreamAndReturnIceConnectionState(t)];case 1:switch(e=r.sent(),e){case"connected":case"completed":oe.log("[".concat(t,"] Stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") successfully reconnected after ").concat(t,". Current ICE connection state: ").concat(e));break;default:oe.error("[".concat(t,"] Stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") failed to reconnect after ").concat(t,". Current ICE connection state: ").concat(e));break}return[3,3];case 2:return n=r.sent(),oe.error("[".concat(t,"] Error reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") after ").concat(t,": ").concat(n)),[3,3];case 3:return[2]}})})},i.prototype.reconnectStreamAndReturnIceConnectionState=function(t){return Ae(this,void 0,void 0,function(){var e,n;return Ve(this,function(r){switch(r.label){case 0:oe.log("[".concat(t,"] Reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") after event ").concat(t)),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.reconnectStream(t)];case 2:return r.sent(),e=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3,[2,this.awaitWebRtcPeerConnectionState(e)];case 3:return n=r.sent(),oe.warn("[".concat(t,"] Error reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber","). Reason: ").concat(n)),[2,this.awaitWebRtcPeerConnectionState(1)];case 4:return[2]}})})},i.prototype.awaitWebRtcPeerConnectionState=function(t){return Ae(this,void 0,void 0,function(){var e,n,r,o;return Ve(this,function(s){switch(s.label){case 0:e=this.getRTCPeerConnection().iceConnectionState,n=150,r=Math.ceil(t/n),o=0,s.label=1;case 1:return o<r?(e=this.getRTCPeerConnection().iceConnectionState,e==="connected"||e==="completed"?[3,4]:[4,new Promise(function(c){return setTimeout(c,n)})]):[3,4];case 2:s.sent(),s.label=3;case 3:return o++,[3,1];case 4:return[2,e]}})})},i.prototype.reconnectStream=function(t){return Ae(this,void 0,void 0,function(){var e,n;return Ve(this,function(r){switch(r.label){case 0:return[4,this.isWebsocketConnected(t,3e3)];case 1:if(e=r.sent(),e)return oe.log("[".concat(t,"] Trying to reconnect stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") and the websocket is opened")),this.isLocal()?[2,this.initWebRtcPeerSend(!0)]:[2,this.initWebRtcPeerReceive(!0)];throw n="[".concat(t,"] Trying to reconnect stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") but the websocket wasn't opened"),oe.error(n),Error(n)}})})},i.prototype.isWebsocketConnected=function(t,e){var n=this;return new Promise(function(r,o){var s=n.session.openvidu.getWsReadyState();if(s===1){var c=setTimeout(function(){return console.warn("[".concat(t,"] Websocket timeout of ").concat(e,"ms")),r(!1)},e);n.session.openvidu.sendRequest("echo",{},function(d,a){return clearTimeout(c),d?(console.warn("[".concat(t,"] Websocket 'echo' returned error: ").concat(d)),r(!1)):r(!0)})}else return console.warn("[".concat(t,"] Websocket readyState is ").concat(s)),r(!1)})},i.prototype.initWebRtcStats=function(){this.webRtcStats=new As.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},i.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},i.prototype.getIceServersConf=function(){var t;return this.session.openvidu.advancedConfiguration.iceServers?t=this.session.openvidu.advancedConfiguration.iceServers==="freeice"?void 0:this.session.openvidu.advancedConfiguration.iceServers:this.session.openvidu.iceServers?t=this.session.openvidu.iceServers:t=void 0,t},i.prototype.gatherStatsForPeer=function(){var t=this;return new Promise(function(e,n){t.isLocal()?t.getRTCPeerConnection().getSenders().forEach(function(r){return r.getStats().then(function(o){o.forEach(function(s){if(t.isReportWanted(s)){var c={};c.type=s.type,c.timestamp=s.timestamp,c.id=s.id,s.type==="outbound-rtp"&&(c.ssrc=s.ssrc,c.firCount=s.firCount,c.pliCount=s.pliCount,c.nackCount=s.nackCount,c.qpSum=s.qpSum,s.kind?c.mediaType=s.kind:s.mediaType?c.mediaType=s.mediaType:c.mediaType=s.id.indexOf("VideoStream")!==-1?"video":"audio",c.mediaType==="video"&&(c.framesEncoded=s.framesEncoded),c.packetsSent=s.packetsSent,c.bytesSent=s.bytesSent),s.type==="candidate-pair"&&s.totalRoundTripTime!==void 0&&(c.availableOutgoingBitrate=s.availableOutgoingBitrate,c.rtt=s.currentRoundTripTime,c.averageRtt=s.totalRoundTripTime/s.responsesReceived),s.type==="remote-inbound-rtp"||s.type,oe.log(c)}})})}):t.getRTCPeerConnection().getReceivers().forEach(function(r){return r.getStats().then(function(o){o.forEach(function(s){if(t.isReportWanted(s)){var c={};c.type=s.type,c.timestamp=s.timestamp,c.id=s.id,s.type==="inbound-rtp"&&(c.ssrc=s.ssrc,c.firCount=s.firCount,c.pliCount=s.pliCount,c.nackCount=s.nackCount,c.qpSum=s.qpSum,s.kind?c.mediaType=s.kind:s.mediaType?c.mediaType=s.mediaType:c.mediaType=s.id.indexOf("VideoStream")!==-1?"video":"audio",c.mediaType==="video"&&(c.framesDecoded=s.framesDecoded),c.packetsReceived=s.packetsReceived,c.packetsLost=s.packetsLost,c.jitter=s.jitter,c.bytesReceived=s.bytesReceived),s.type==="candidate-pair"&&s.totalRoundTripTime!==void 0&&(c.availableIncomingBitrate=s.availableIncomingBitrate,c.rtt=s.currentRoundTripTime,c.averageRtt=s.totalRoundTripTime/s.responsesReceived),s.type==="remote-inbound-rtp"||s.type,oe.log(c)}})})})})},i.prototype.isReportWanted=function(t){return t.type==="inbound-rtp"&&!this.isLocal()||t.type==="outbound-rtp"&&this.isLocal()||t.type==="candidate-pair"&&t.nominated&&t.bytesSent>0},i}();st.Stream=$s;Object.defineProperty(Ot,"__esModule",{value:!0});Ot.Connection=void 0;var Fs=st,Us=Ee,Ei=Ye,bt=Us.OpenViduLogger.getInstance(),Ws=function(){function i(t,e){this.session=t,this.disposed=!1;var n="'Connection' created ";e.role?(this.localOptions=e,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,n+="(local)"):(this.remoteOptions=e,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),n+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),bt.info(n)}return i.prototype.sendIceCandidate=function(t){var e=this;this.disposed?bt.warn("Connection ".concat(this.connectionId," disposed when trying to send an ICE candidate. ICE candidate not sent")):(bt.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,t),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:t.candidate,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex},function(n,r){n&&(bt.error("Error sending ICE candidate: "+JSON.stringify(n)),e.session.emitEvent("exception",[new Ei.ExceptionEvent(e.session,Ei.ExceptionEventName.ICE_CANDIDATE_ERROR,e.session,"There was an unexpected error on the server-side processing an ICE candidate generated and sent by the client-side",n)]))}))},i.prototype.initRemoteStreams=function(t){var e=this;t.forEach(function(n){var r={id:n.id,createdAt:n.createdAt,connection:e,hasAudio:n.hasAudio,hasVideo:n.hasVideo,audioActive:n.audioActive,videoActive:n.videoActive,typeOfVideo:n.typeOfVideo,frameRate:n.frameRate,videoDimensions:n.videoDimensions?JSON.parse(n.videoDimensions):void 0,filter:n.filter?n.filter:void 0},o=new Fs.Stream(e.session,r);e.addStream(o)}),bt.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},i.prototype.addStream=function(t){t.connection=this,this.stream=t},i.prototype.removeStream=function(){delete this.stream},i.prototype.dispose=function(){this.disposed=!0,this.removeStream()},i}();Ot.Connection=Ws;var Pt={},Hs=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Pt,"__esModule",{value:!0});Pt.ConnectionEvent=void 0;var qs=Se,Gs=function(i){Hs(t,i);function t(e,n,r,o,s){var c=i.call(this,e,n,r)||this;return c.connection=o,c.reason=s,c}return t.prototype.callDefaultBehavior=function(){},t}(qs.Event);Pt.ConnectionEvent=Gs;var Tt={},zs=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Tt,"__esModule",{value:!0});Tt.FilterEvent=void 0;var Xs=Se,Js=function(i){zs(t,i);function t(e,n,r){var o=i.call(this,!1,e,n)||this;return o.data=r,o}return t.prototype.callDefaultBehavior=function(){},t}(Xs.Event);Tt.FilterEvent=Js;var xt={},Ks=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(xt,"__esModule",{value:!0});xt.RecordingEvent=void 0;var Ys=Se,Qs=function(i){Ks(t,i);function t(e,n,r,o,s){var c=i.call(this,!1,e,n)||this;return c.id=r,o!==r&&(c.name=o),c.reason=s,c}return t.prototype.callDefaultBehavior=function(){},t}(Ys.Event);xt.RecordingEvent=Qs;var ft={},Zs=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(ft,"__esModule",{value:!0});ft.SessionDisconnectedEvent=void 0;var ea=Se,ta=Ee,na=ta.OpenViduLogger.getInstance(),ia=function(i){Zs(t,i);function t(e,n){var r=i.call(this,!0,e,"sessionDisconnected")||this;return r.reason=n,r}return t.prototype.callDefaultBehavior=function(){na.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var e=this.target;e.remoteConnections.forEach(function(n){var r,o,s,c,d,a,f,v,m=n.connectionId;if(!((r=e.remoteConnections.get(m))===null||r===void 0)&&r.stream){(o=e.remoteConnections.get(m))===null||o===void 0||o.stream.disposeWebRtcPeer(),(s=e.remoteConnections.get(m))===null||s===void 0||s.stream.disposeMediaStream(),!((c=e.remoteConnections.get(m))===null||c===void 0)&&c.stream.streamManager&&((d=e.remoteConnections.get(m))===null||d===void 0||d.stream.streamManager.removeAllVideos());var O=(f=(a=e.remoteConnections.get(m))===null||a===void 0?void 0:a.stream)===null||f===void 0?void 0:f.streamId;O&&e.remoteStreamsCreated.delete(O),(v=e.remoteConnections.get(m))===null||v===void 0||v.dispose()}e.remoteConnections.delete(m)})},t}(ea.Event);ft.SessionDisconnectedEvent=ia;var kt={},ra=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(kt,"__esModule",{value:!0});kt.SignalEvent=void 0;var oa=Se,sa=function(i){ra(t,i);function t(e,n,r,o){var s=i.call(this,!1,e,"signal")||this;return n&&(s.type="signal:"+n),s.data=r,s.from=o,s}return t.prototype.callDefaultBehavior=function(){},t}(oa.Event);kt.SignalEvent=sa;var Nt={},aa=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Nt,"__esModule",{value:!0});Nt.SpeechToTextEvent=void 0;var ca=Se,ua=function(i){aa(t,i);function t(e,n,r,o,s,c){var d=i.call(this,!1,e,"speechToTextMessage")||this;return d.connection=n,d.text=r,d.reason=o,d.raw=s,d.lang=c,d}return t.prototype.callDefaultBehavior=function(){},t}(ca.Event);Nt.SpeechToTextEvent=ua;var St={},bi;function Jn(){if(bi)return St;bi=1;var i=W&&W.__extends||function(){var c=function(d,a){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,v){f.__proto__=v}||function(f,v){for(var m in v)Object.prototype.hasOwnProperty.call(v,m)&&(f[m]=v[m])},c(d,a)};return function(d,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");c(d,a);function f(){this.constructor=d}d.prototype=a===null?Object.create(a):(f.prototype=a.prototype,new f)}}();Object.defineProperty(St,"__esModule",{value:!0}),St.StreamEvent=void 0;var t=Se,e=Kn(),n=pn(),r=Ee,o=r.OpenViduLogger.getInstance(),s=function(c){i(d,c);function d(a,f,v,m,O){var _=c.call(this,a,f,v)||this;return _.stream=m,_.reason=O,_}return d.prototype.callDefaultBehavior=function(){if(this.type==="streamDestroyed"){if(this.target instanceof n.Session)o.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof e.Publisher){o.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var a=this.target.openvidu.publishers,f=0;f<a.length;f++)if(a[f]===this.target){a.splice(f,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),this.stream.session.remoteStreamsCreated.delete(this.stream.streamId);var v=this.stream.session.remoteConnections.get(this.stream.connection.connectionId);if(v&&v.remoteOptions)for(var m=v.remoteOptions.streams,f=m.length-1;f>=0;--f)m[f].id===this.stream.streamId&&m.splice(f,1)}},d}(t.Event);return St.StreamEvent=s,St}var Lt={},da=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Lt,"__esModule",{value:!0});Lt.ConnectionPropertyChangedEvent=void 0;var la=Se,fa=function(i){da(t,i);function t(e,n,r,o,s){var c=i.call(this,!1,e,"connectionPropertyChanged")||this;return c.connection=n,c.changedProperty=r,c.newValue=o,c.oldValue=s,c}return t.prototype.callDefaultBehavior=function(){},t}(la.Event);Lt.ConnectionPropertyChangedEvent=fa;var Mt={},ha=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(Mt,"__esModule",{value:!0});Mt.NetworkQualityLevelChangedEvent=void 0;var pa=Se,ma=function(i){ha(t,i);function t(e,n,r,o){var s=i.call(this,!1,e,"networkQualityLevelChanged")||this;return s.newValue=n,s.oldValue=r,s.connection=o,s}return t.prototype.callDefaultBehavior=function(){},t}(pa.Event);Mt.NetworkQualityLevelChangedEvent=ma;var xn={};const va=typeof process=="object"&&xn&&xn.NODE_DEBUG&&/\bsemver\b/i.test(xn.NODE_DEBUG)?(...i)=>console.error("SEMVER",...i):()=>{};var Ji=va;const ga="2.0.0",Ea=256,ba=Number.MAX_SAFE_INTEGER||9007199254740991,Sa=16;var Ki={SEMVER_SPEC_VERSION:ga,MAX_LENGTH:Ea,MAX_SAFE_INTEGER:ba,MAX_SAFE_COMPONENT_LENGTH:Sa},$n={exports:{}};(function(i,t){const{MAX_SAFE_COMPONENT_LENGTH:e}=Ki,n=Ji;t=i.exports={};const r=t.re=[],o=t.src=[],s=t.t={};let c=0;const d=(a,f,v)=>{const m=c++;n(a,m,f),s[a]=m,o[m]=f,r[m]=new RegExp(f,v?"g":void 0)};d("NUMERICIDENTIFIER","0|[1-9]\\d*"),d("NUMERICIDENTIFIERLOOSE","[0-9]+"),d("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),d("MAINVERSION",`(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})`),d("MAINVERSIONLOOSE",`(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})`),d("PRERELEASEIDENTIFIER",`(?:${o[s.NUMERICIDENTIFIER]}|${o[s.NONNUMERICIDENTIFIER]})`),d("PRERELEASEIDENTIFIERLOOSE",`(?:${o[s.NUMERICIDENTIFIERLOOSE]}|${o[s.NONNUMERICIDENTIFIER]})`),d("PRERELEASE",`(?:-(${o[s.PRERELEASEIDENTIFIER]}(?:\\.${o[s.PRERELEASEIDENTIFIER]})*))`),d("PRERELEASELOOSE",`(?:-?(${o[s.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[s.PRERELEASEIDENTIFIERLOOSE]})*))`),d("BUILDIDENTIFIER","[0-9A-Za-z-]+"),d("BUILD",`(?:\\+(${o[s.BUILDIDENTIFIER]}(?:\\.${o[s.BUILDIDENTIFIER]})*))`),d("FULLPLAIN",`v?${o[s.MAINVERSION]}${o[s.PRERELEASE]}?${o[s.BUILD]}?`),d("FULL",`^${o[s.FULLPLAIN]}$`),d("LOOSEPLAIN",`[v=\\s]*${o[s.MAINVERSIONLOOSE]}${o[s.PRERELEASELOOSE]}?${o[s.BUILD]}?`),d("LOOSE",`^${o[s.LOOSEPLAIN]}$`),d("GTLT","((?:<|>)?=?)"),d("XRANGEIDENTIFIERLOOSE",`${o[s.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),d("XRANGEIDENTIFIER",`${o[s.NUMERICIDENTIFIER]}|x|X|\\*`),d("XRANGEPLAIN",`[v=\\s]*(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:${o[s.PRERELEASE]})?${o[s.BUILD]}?)?)?`),d("XRANGEPLAINLOOSE",`[v=\\s]*(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:${o[s.PRERELEASELOOSE]})?${o[s.BUILD]}?)?)?`),d("XRANGE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAIN]}$`),d("XRANGELOOSE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAINLOOSE]}$`),d("COERCE",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?(?:$|[^\\d])`),d("COERCERTL",o[s.COERCE],!0),d("LONETILDE","(?:~>?)"),d("TILDETRIM",`(\\s*)${o[s.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",d("TILDE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAIN]}$`),d("TILDELOOSE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAINLOOSE]}$`),d("LONECARET","(?:\\^)"),d("CARETTRIM",`(\\s*)${o[s.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",d("CARET",`^${o[s.LONECARET]}${o[s.XRANGEPLAIN]}$`),d("CARETLOOSE",`^${o[s.LONECARET]}${o[s.XRANGEPLAINLOOSE]}$`),d("COMPARATORLOOSE",`^${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]})$|^$`),d("COMPARATOR",`^${o[s.GTLT]}\\s*(${o[s.FULLPLAIN]})$|^$`),d("COMPARATORTRIM",`(\\s*)${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]}|${o[s.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",d("HYPHENRANGE",`^\\s*(${o[s.XRANGEPLAIN]})\\s+-\\s+(${o[s.XRANGEPLAIN]})\\s*$`),d("HYPHENRANGELOOSE",`^\\s*(${o[s.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[s.XRANGEPLAINLOOSE]})\\s*$`),d("STAR","(<|>)?=?\\s*\\*"),d("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),d("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})($n,$n.exports);var ya=$n.exports;const wa=["includePrerelease","loose","rtl"],Oa=i=>i?typeof i!="object"?{loose:!0}:wa.filter(t=>i[t]).reduce((t,e)=>(t[e]=!0,t),{}):{};var Ca=Oa;const Si=/^[0-9]+$/,Yi=(i,t)=>{const e=Si.test(i),n=Si.test(t);return e&&n&&(i=+i,t=+t),i===t?0:e&&!n?-1:n&&!e?1:i<t?-1:1},Ra=(i,t)=>Yi(t,i);var _a={compareIdentifiers:Yi,rcompareIdentifiers:Ra};const $t=Ji,{MAX_LENGTH:yi,MAX_SAFE_INTEGER:Ft}=Ki,{re:wi,t:Oi}=ya,Ia=Ca,{compareIdentifiers:nt}=_a;let Pa=class De{constructor(t,e){if(e=Ia(e),t instanceof De){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid Version: ${t}`);if(t.length>yi)throw new TypeError(`version is longer than ${yi} characters`);$t("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const n=t.trim().match(e.loose?wi[Oi.LOOSE]:wi[Oi.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Ft||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ft||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ft||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const o=+r;if(o>=0&&o<Ft)return o}return r}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if($t("SemVer.compare",this.version,this.options,t),!(t instanceof De)){if(typeof t=="string"&&t===this.version)return 0;t=new De(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof De||(t=new De(t,this.options)),nt(this.major,t.major)||nt(this.minor,t.minor)||nt(this.patch,t.patch)}comparePre(t){if(t instanceof De||(t=new De(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const n=this.prerelease[e],r=t.prerelease[e];if($t("prerelease compare",e,n,r),n===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(n===void 0)return-1;if(n===r)continue;return nt(n,r)}while(++e)}compareBuild(t){t instanceof De||(t=new De(t,this.options));let e=0;do{const n=this.build[e],r=t.build[e];if($t("prerelease compare",e,n,r),n===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(n===void 0)return-1;if(n===r)continue;return nt(n,r)}while(++e)}inc(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}e&&(nt(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}};var Qi=Pa;const Ta=Qi,xa=(i,t)=>new Ta(i,t).major;var ka=xa;const Na=Qi,La=(i,t)=>new Na(i,t).minor;var Ma=La,Ci;function pn(){if(Ci)return gt;Ci=1;var i=W&&W.__extends||function(){var B=function(L,u){return B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,w){E.__proto__=w}||function(E,w){for(var h in w)Object.prototype.hasOwnProperty.call(w,h)&&(E[h]=w[h])},B(L,u)};return function(L,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");B(L,u);function E(){this.constructor=L}L.prototype=u===null?Object.create(u):(E.prototype=u.prototype,new E)}}(),t=W&&W.__awaiter||function(B,L,u,E){function w(h){return h instanceof u?h:new u(function(l){l(h)})}return new(u||(u=Promise))(function(h,l){function p(N){try{C(E.next(N))}catch(A){l(A)}}function R(N){try{C(E.throw(N))}catch(A){l(A)}}function C(N){N.done?h(N.value):w(N.value).then(p,R)}C((E=E.apply(B,L||[])).next())})},e=W&&W.__generator||function(B,L){var u={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},E,w,h,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(C){return function(N){return R([C,N])}}function R(C){if(E)throw new TypeError("Generator is already executing.");for(;l&&(l=0,C[0]&&(u=0)),u;)try{if(E=1,w&&(h=C[0]&2?w.return:C[0]?w.throw||((h=w.return)&&h.call(w),0):w.next)&&!(h=h.call(w,C[1])).done)return h;switch(w=0,h&&(C=[C[0]&2,h.value]),C[0]){case 0:case 1:h=C;break;case 4:return u.label++,{value:C[1],done:!1};case 5:u.label++,w=C[1],C=[0];continue;case 7:C=u.ops.pop(),u.trys.pop();continue;default:if(h=u.trys,!(h=h.length>0&&h[h.length-1])&&(C[0]===6||C[0]===2)){u=0;continue}if(C[0]===3&&(!h||C[1]>h[0]&&C[1]<h[3])){u.label=C[1];break}if(C[0]===6&&u.label<h[1]){u.label=h[1],h=C;break}if(h&&u.label<h[2]){u.label=h[2],u.ops.push(C);break}h[2]&&u.ops.pop(),u.trys.pop();continue}C=L.call(B,u)}catch(N){C=[6,N],w=0}finally{E=h=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}};Object.defineProperty(gt,"__esModule",{value:!0}),gt.Session=void 0;var n=Ot,r=at,o=ct,s=dt,c=Pt,d=Tt,a=xt,f=ft,v=kt,m=Nt,O=Jn(),_=Be,P=Lt,y=Mt,b=Ke,k=Rt,T=Ee,I=Ne,M=ka,D=Ma,z=Ye,g=T.OpenViduLogger.getInstance(),x,q=function(B){i(L,B);function L(u){var E=B.call(this)||this;return E.streamManagers=[],E.remoteStreamsCreated=new Map,E.remoteConnections=new Map,x=I.PlatformUtils.getInstance(),E.openvidu=u,E}return L.prototype.connect=function(u,E){var w=this;return new Promise(function(h,l){if(w.processToken(u),w.openvidu.checkSystemRequirements())w.options={sessionId:w.sessionId,participantId:u,metadata:E?w.stringClientMetadata(E):""},w.connectAux(u).then(function(){return h()}).catch(function(p){return l(p)});else return l(new b.OpenViduError(b.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+x.getName()+" (version "+x.getVersion()+") for "+x.getFamily()+" is not supported in OpenVidu"))})},L.prototype.disconnect=function(){this.leave(!1,"disconnect")},L.prototype.subscribe=function(u,E,w,h){var l={};w&&typeof w!="function"?l={insertMode:typeof w.insertMode<"u"?typeof w.insertMode=="string"?k.VideoInsertMode[w.insertMode]:l.insertMode:k.VideoInsertMode.APPEND,subscribeToAudio:typeof w.subscribeToAudio<"u"?w.subscribeToAudio:!0,subscribeToVideo:typeof w.subscribeToVideo<"u"?w.subscribeToVideo:!0}:l={insertMode:k.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0};var p=void 0;if(w&&typeof w=="function"?p=w:h&&(p=h),!this.sessionConnected())throw p!==void 0&&p(this.notConnectedError()),this.notConnectedError();g.info("Subscribing to "+u.connection.connectionId),u.subscribe().then(function(){g.info("Subscribed correctly to "+u.connection.connectionId),p!==void 0&&p(void 0)}).catch(function(C){p!==void 0&&p(C)});var R=new o.Subscriber(u,E,l);return R.targetElement&&u.streamManager.createVideoElement(R.targetElement,l.insertMode),R},L.prototype.subscribeAsync=function(u,E,w){var h=this;return new Promise(function(l,p){if(!h.sessionConnected())return p(h.notConnectedError());var R,C=function(N){return N?p(N):l(R)};w?R=h.subscribe(u,E,w,C):R=h.subscribe(u,E,C)})},L.prototype.unsubscribe=function(u){var E=this;return new Promise(function(w,h){if(E.sessionConnected()){var l=u.stream.connection.connectionId;g.info("Unsubscribing from "+l),E.openvidu.sendRequest("unsubscribeFromVideo",{sender:u.stream.connection.connectionId},function(p,R){return p?(g.error("Error unsubscribing from "+l),h(p)):(g.info("Unsubscribed correctly from "+l),u.stream.streamManager.removeAllVideos(),u.stream.disposeWebRtcPeer(),u.stream.disposeMediaStream(),w())})}else return h(E.notConnectedError())})},L.prototype.publish=function(u){var E=this;return new Promise(function(w,h){if(!E.sessionConnected())return h(E.notConnectedError());u.session=E,u.stream.session=E,u.stream.publishedOnce?u.initialize().then(function(){E.connection.addStream(u.stream),u.reestablishStreamPlayingEvent(),u.stream.publish().then(function(){return E.sendVideoData(u,8,!0,5),w()}).catch(function(l){return h(l)})}).catch(function(l){return h(l)}):(E.connection.addStream(u.stream),u.stream.publish().then(function(){return E.sendVideoData(u,8,!0,5),w()}).catch(function(l){return h(l)}))})},L.prototype.unpublish=function(u){var E=this;return new Promise(function(w,h){if(!E.sessionConnected())throw E.notConnectedError();var l=u.stream;if(l.connection){if(l.connection!==E.connection)return h(new Error("The associated Connection object of this Publisher is not your local Connection.  Only moderators can force unpublish on remote Streams via 'forceUnpublish' method"));g.info("Unpublishing local media ("+l.connection.connectionId+")"),E.openvidu.sendRequest("unpublishVideo",function(p,R){if(p)return h(p);g.info("Media unpublished correctly"),l.disposeWebRtcPeer(),l.connection.stream==l&&delete l.connection.stream;var C=new O.StreamEvent(!0,u,"streamDestroyed",u.stream,"unpublish");return u.emitEvent("streamDestroyed",[C]),C.callDefaultBehavior(),w()})}else return h(new Error("The associated Connection object of this Publisher is null"))})},L.prototype.forceDisconnect=function(u){var E=this;return new Promise(function(w,h){if(!E.sessionConnected())return h(E.notConnectedError());g.info("Forcing disconnect for connection "+u.connectionId),E.openvidu.sendRequest("forceDisconnect",{connectionId:u.connectionId},function(l,p){return l?(g.error("Error forcing disconnect for Connection "+u.connectionId,l),l.code===401?h(new b.OpenViduError(b.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):h(l)):(g.info("Forcing disconnect correctly for Connection "+u.connectionId),w())})})},L.prototype.forceUnpublish=function(u){var E=this;return new Promise(function(w,h){if(!E.sessionConnected())return h(E.notConnectedError());g.info("Forcing unpublish for stream "+u.streamId),E.openvidu.sendRequest("forceUnpublish",{streamId:u.streamId},function(l,p){return l?(g.error("Error forcing unpublish for Stream "+u.streamId,l),l.code===401?h(new b.OpenViduError(b.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):h(l)):(g.info("Forcing unpublish correctly for Stream "+u.streamId),w())})})},L.prototype.signal=function(u){var E=this;return new Promise(function(w,h){if(!E.sessionConnected())return h(E.notConnectedError());var l={};if(u.to&&u.to.length>0){var p=[];u.to.forEach(function(C){C.connectionId&&p.push(C.connectionId)}),l.to=p}else l.to=[];l.data=u.data?u.data:"";var R=u.type?u.type:"signal";R&&R.substring(0,7)!=="signal:"&&(R="signal:"+R),l.type=R,E.openvidu.sendRequest("sendMessage",{message:JSON.stringify(l)},function(C,N){return C?h(C):w()})})},L.prototype.subscribeToSpeechToText=function(u,E){var w=this;return new Promise(function(h,l){w.openvidu.sendRequest("subscribeToSpeechToText",{connectionId:u.connection.connectionId,lang:E},function(p,R){return p?l(p):h()})})},L.prototype.unsubscribeFromSpeechToText=function(u){var E=this;return new Promise(function(w,h){E.openvidu.sendRequest("unsubscribeFromSpeechToText",{connectionId:u.connection.connectionId},function(l,p){return l?h(l):w()})})},L.prototype.on=function(u,E){var w,h,l,p;return B.prototype.onAux.call(this,u,"Event '"+u+"' triggered by 'Session'",E),u==="publisherStartSpeaking"&&(this.remoteConnections.forEach(function(R){var C;!((C=R.stream)===null||C===void 0)&&C.hasAudio&&R.stream.enableHarkSpeakingEvent()}),!((h=(w=this.connection)===null||w===void 0?void 0:w.stream)===null||h===void 0)&&h.hasAudio&&this.connection.stream.enableHarkSpeakingEvent()),u==="publisherStopSpeaking"&&(this.remoteConnections.forEach(function(R){var C;!((C=R.stream)===null||C===void 0)&&C.hasAudio&&R.stream.enableHarkStoppedSpeakingEvent()}),!((p=(l=this.connection)===null||l===void 0?void 0:l.stream)===null||p===void 0)&&p.hasAudio&&this.connection.stream.enableHarkStoppedSpeakingEvent()),this},L.prototype.once=function(u,E){var w,h,l,p;return B.prototype.onceAux.call(this,u,"Event '"+u+"' triggered once by 'Session'",E),u==="publisherStartSpeaking"&&(this.remoteConnections.forEach(function(R){var C;!((C=R.stream)===null||C===void 0)&&C.hasAudio&&R.stream.enableOnceHarkSpeakingEvent()}),!((h=(w=this.connection)===null||w===void 0?void 0:w.stream)===null||h===void 0)&&h.hasAudio&&this.connection.stream.enableOnceHarkSpeakingEvent()),u==="publisherStopSpeaking"&&(this.remoteConnections.forEach(function(R){var C;!((C=R.stream)===null||C===void 0)&&C.hasAudio&&R.stream.enableOnceHarkStoppedSpeakingEvent()}),!((p=(l=this.connection)===null||l===void 0?void 0:l.stream)===null||p===void 0)&&p.hasAudio&&this.connection.stream.enableOnceHarkStoppedSpeakingEvent()),this},L.prototype.off=function(u,E){var w=this,h,l,p,R;return B.prototype.offAux.call(this,u,E),u==="publisherStartSpeaking"&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1)||(this.remoteConnections.forEach(function(C){var N;!((N=C.stream)===null||N===void 0)&&N.streamManager&&(w.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,C.stream.streamManager)||C.stream.disableHarkSpeakingEvent(!1))}),!((l=(h=this.connection)===null||h===void 0?void 0:h.stream)===null||l===void 0)&&l.streamManager&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkSpeakingEvent(!1)))),u==="publisherStopSpeaking"&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1)||(this.remoteConnections.forEach(function(C){var N;!((N=C.stream)===null||N===void 0)&&N.streamManager&&(w.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,C.stream.streamManager)||C.stream.disableHarkStoppedSpeakingEvent(!1))}),!((R=(p=this.connection)===null||p===void 0?void 0:p.stream)===null||R===void 0)&&R.streamManager&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkStoppedSpeakingEvent(!1)))),this},L.prototype.onParticipantJoined=function(u){var E=this;this.getConnection(u.id,"").then(function(w){g.warn("Connection "+w.connectionId+" already exists in connections list")}).catch(function(w){var h=new n.Connection(E,u);E.remoteConnections.set(u.id,h),E.ee.emitEvent("connectionCreated",[new c.ConnectionEvent(!1,E,"connectionCreated",h,"")])})},L.prototype.onParticipantLeft=function(u){var E=this;this.getRemoteConnection(u.connectionId,"onParticipantLeft").then(function(w){if(w.stream){var h=w.stream,l=new O.StreamEvent(!0,E,"streamDestroyed",h,u.reason);E.ee.emitEvent("streamDestroyed",[l]),l.callDefaultBehavior(),E.remoteStreamsCreated.delete(h.streamId)}w.dispose(),E.remoteConnections.delete(w.connectionId),E.ee.emitEvent("connectionDestroyed",[new c.ConnectionEvent(!1,E,"connectionDestroyed",w,u.reason)])}).catch(function(w){g.error(w)})},L.prototype.onParticipantPublished=function(u){var E=this,w=function(l){E.remoteConnections.set(l.connectionId,l),E.remoteStreamsCreated.get(l.stream.streamId)||E.ee.emitEvent("streamCreated",[new O.StreamEvent(!1,E,"streamCreated",l.stream,"")]),E.remoteStreamsCreated.set(l.stream.streamId,!0)},h;this.getRemoteConnection(u.id,"onParticipantPublished").then(function(l){h=l,u.metadata=l.data,h.remoteOptions=u,h.initRemoteStreams(u.streams),w(h)}).catch(function(l){h=new n.Connection(E,u),w(h)})},L.prototype.onParticipantUnpublished=function(u){var E=this;u.connectionId===this.connection.connectionId?this.stopPublisherStream(u.reason):this.getRemoteConnection(u.connectionId,"onParticipantUnpublished").then(function(w){var h=new O.StreamEvent(!0,E,"streamDestroyed",w.stream,u.reason);if(E.ee.emitEvent("streamDestroyed",[h]),h.callDefaultBehavior(),w.stream!=null){var l=w.stream.streamId;E.remoteStreamsCreated.delete(l),w.removeStream()}}).catch(function(w){g.error(w)})},L.prototype.onParticipantEvicted=function(u){u.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,u.reason)},L.prototype.onNewMessage=function(u){var E=this;g.info("New signal: "+JSON.stringify(u));var w=u.type?u.type.replace(/^(signal:)/,""):void 0;u.from?this.getConnection(u.from,"Connection '"+u.from+"' unknown when 'onNewMessage'. Existing remote connections: "+JSON.stringify(this.remoteConnections.keys())+". Existing local connection: "+this.connection.connectionId).then(function(h){E.ee.emitEvent("signal",[new v.SignalEvent(E,w,u.data,h)]),u.type&&u.type!=="signal"&&E.ee.emitEvent(u.type,[new v.SignalEvent(E,w,u.data,h)])}).catch(function(h){g.error(h)}):(this.ee.emitEvent("signal",[new v.SignalEvent(this,w,u.data,void 0)]),u.type&&u.type!=="signal"&&this.ee.emitEvent(u.type,[new v.SignalEvent(this,w,u.data,void 0)]))},L.prototype.onStreamPropertyChanged=function(u){var E=this,w=function(h){var l,p;if(h.stream&&h.stream.streamId===u.streamId){var R=h.stream,C=void 0;switch(u.property){case"audioActive":C=R.audioActive,u.newValue=u.newValue==="true",R.audioActive=u.newValue;break;case"videoActive":C=R.videoActive,u.newValue=u.newValue==="true",R.videoActive=u.newValue;var N=(p=(l=R==null?void 0:R.getMediaStream())===null||l===void 0?void 0:l.getVideoTracks())===null||p===void 0?void 0:p[0];N&&!N.enabled&&R.videoActive&&(N.enabled=!0);break;case"videoTrack":u.newValue=JSON.parse(u.newValue);break;case"audioTrack":u.newValue=JSON.parse(u.newValue);break;case"videoDimensions":C=R.videoDimensions,u.newValue=JSON.parse(JSON.parse(u.newValue)),R.videoDimensions=u.newValue;break;case"filter":C=R.filter,u.newValue=Object.keys(u.newValue).length>0?u.newValue:void 0,u.newValue!==void 0?(R.filter=new r.Filter(u.newValue.type,u.newValue.options),R.filter.stream=R,u.newValue.lastExecMethod&&(R.filter.lastExecMethod=u.newValue.lastExecMethod)):delete R.filter,u.newValue=R.filter;break}E.ee.emitEvent("streamPropertyChanged",[new _.StreamPropertyChangedEvent(E,R,u.property,u.newValue,C,u.reason)]),R.streamManager&&R.streamManager.emitEvent("streamPropertyChanged",[new _.StreamPropertyChangedEvent(R.streamManager,R,u.property,u.newValue,C,u.reason)])}else g.error("No stream with streamId '"+u.streamId+"' found for connection '"+u.connectionId+"' on 'streamPropertyChanged' event")};u.connectionId===this.connection.connectionId?w(this.connection):this.getRemoteConnection(u.connectionId,"onStreamPropertyChanged").then(function(h){w(h)}).catch(function(h){g.error(h)})},L.prototype.onConnectionPropertyChanged=function(u){var E;switch(u.property){case"role":E=this.connection.role.slice(),this.connection.role=u.newValue,this.connection.localOptions.role=u.newValue;break;case"record":E=this.connection.record,u.newValue=u.newValue==="true",this.connection.record=u.newValue,this.connection.localOptions.record=u.newValue;break}this.ee.emitEvent("connectionPropertyChanged",[new P.ConnectionPropertyChangedEvent(this,this.connection,u.property,u.newValue,E)])},L.prototype.onNetworkQualityLevelChangedChanged=function(u){var E=this;u.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new y.NetworkQualityLevelChangedEvent(this,u.newValue,u.oldValue,this.connection)]):this.getConnection(u.connectionId,"Connection not found for connectionId "+u.connectionId).then(function(w){E.ee.emitEvent("networkQualityLevelChanged",[new y.NetworkQualityLevelChangedEvent(E,u.newValue,u.oldValue,w)])}).catch(function(w){g.error(w)})},L.prototype.recvIceCandidate=function(u){var E={candidate:u.candidate,sdpMLineIndex:u.sdpMLineIndex,sdpMid:u.sdpMid},w=new RTCIceCandidate(E);this.getConnection(u.senderConnectionId,"Connection not found for connectionId "+u.senderConnectionId+" owning endpoint "+u.endpointName+". Ice candidate will be ignored: "+w).then(function(h){var l=h.stream;l.getWebRtcPeer().addIceCandidate(w).catch(function(p){g.error("Error adding candidate for "+l.streamId+" stream of endpoint "+u.endpointName+": "+p)})}).catch(function(h){g.error(h)})},L.prototype.onSessionClosed=function(u){g.info("Session closed: "+JSON.stringify(u));var E=u.sessionId;E!==void 0?this.ee.emitEvent("session-closed",[{session:E}]):g.warn("Session undefined on session closed",u)},L.prototype.onLostConnection=function(u){g.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,u)},L.prototype.onRecoveredConnection=function(){g.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},L.prototype.onMediaError=function(u){g.error("Media error: "+JSON.stringify(u));var E=u.error;E?this.ee.emitEvent("error-media",[{error:E}]):g.warn("Received undefined media error:",u)},L.prototype.onRecordingStarted=function(u){this.ee.emitEvent("recordingStarted",[new a.RecordingEvent(this,"recordingStarted",u.id,u.name)])},L.prototype.onRecordingStopped=function(u){this.ee.emitEvent("recordingStopped",[new a.RecordingEvent(this,"recordingStopped",u.id,u.name,u.reason)])},L.prototype.onBroadcastStarted=function(){this.ee.emitEvent("broadcastStarted",[])},L.prototype.onBroadcastStopped=function(){this.ee.emitEvent("broadcastStopped",[])},L.prototype.onFilterEventDispatched=function(u){var E=this,w=u.connectionId;this.getConnection(w,"No connection found for connectionId "+w).then(function(h){g.info('Filter event of type "'.concat(u.eventType,'" dispatched'));var l=h.stream;if(!l||!l.filter)return g.error('Filter event of type "'.concat(u.eventType,'" dispatched for stream ').concat(l.streamId," but there is no ").concat(l?"filter":"stream"," defined"));var p=l.filter.handlers.get(u.eventType);if(!p||typeof p!="function"){var R=Array.from(l.filter.handlers.keys());return g.error('Filter event of type "'.concat(u.eventType,'" not handled or not a function! Active filter events: ').concat(R.join(",")))}else p.call(E,new d.FilterEvent(l.filter,u.eventType,u.data))})},L.prototype.onForciblyReconnectSubscriber=function(u){var E=this;return new Promise(function(w,h){E.getRemoteConnection(u.connectionId,"onForciblyReconnectSubscriber").then(function(l){if(l.stream&&l.stream.streamId===u.streamId){var p=l.stream;if(p.setupReconnectionEventEmitter(w,h)){if(p.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent!=null)return p.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=u,h("Ongoing forced subscriber reconnection");p.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=u;var R=function(){var N=p.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent;delete p.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent,E.onForciblyReconnectSubscriber(N)};p.reconnectionEventEmitter.once("success",function(){R()}),p.reconnectionEventEmitter.once("error",function(){R()});return}p.completeWebRtcPeerReceive(!0,!0,u.sdpOffer).then(function(){return p.finalResolveForSubscription(!0,w)}).catch(function(N){return p.finalRejectForSubscription(!0,"Error while forcibly reconnecting remote stream ".concat(u.streamId,": ").concat(N.toString()),h)})}else{var C="No stream with streamId '"+u.streamId+"' found for connection '"+u.connectionId+"' on 'streamPropertyChanged' event";return g.error(C),h(C)}}).catch(function(l){return g.error(l),h(l)})})},L.prototype.reconnectBrokenStreams=function(){g.info("Re-establishing media connections...");var u=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(g.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),u=!0),this.remoteConnections.forEach(function(E){E.stream&&E.stream.streamIceConnectionStateBroken()&&(g.warn("Re-establishing Subscriber "+E.stream.streamId),E.stream.initWebRtcPeerReceive(!0),u=!0)}),u||g.info("There were no media streams in need of a reconnection")},L.prototype.onSpeechToTextMessage=function(u){return t(this,void 0,void 0,function(){var E,w;return e(this,function(h){switch(h.label){case 0:return[4,this.getConnection(u.connectionId,"No connection found for connectionId "+u.connectionId)];case 1:return E=h.sent(),w=new m.SpeechToTextEvent(this,E,u.text,u.reason.toLowerCase(),u.raw,u.lang),this.ee.emitEvent("speechToTextMessage",[w]),[2]}})})},L.prototype.onSpeechToTextDisconnected=function(u){return t(this,void 0,void 0,function(){return e(this,function(E){return this.emitEvent("exception",[new z.ExceptionEvent(this,z.ExceptionEventName.SPEECH_TO_TEXT_DISCONNECTED,this,u.message)]),[2]})})},L.prototype.emitEvent=function(u,E){this.ee.emitEvent(u,E)},L.prototype.leave=function(u,E){var w=this;if(u=!!u,g.info("Leaving Session (forced="+u+")"),this.stopVideoDataIntervals(),this.connection){if(!this.connection.disposed&&!u?this.openvidu.sendRequest("leaveRoom",function(l,p){l&&g.error("leaveRoom error: ".concat(JSON.stringify(l))),w.openvidu.closeWs()}):this.openvidu.closeWs(),this.stopPublisherStream(E),!this.connection.disposed){var h=new f.SessionDisconnectedEvent(this,E);this.ee.emitEvent("sessionDisconnected",[h]),h.callDefaultBehavior()}}else g.warn("You were not connected to the session "+this.sessionId);g.flush()},L.prototype.initializeParams=function(u){var E={token:u||"",session:this.sessionId,platform:x.getDescription()?x.getDescription():"unknown",sdkVersion:this.openvidu.libraryVersion,metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder(),stt:this.openvidu.getStt()};return E},L.prototype.sendVideoData=function(u,E,w,h){var l=this,p,R;if(E===void 0&&(E=1),w===void 0&&(w=!1),h===void 0&&(h=1),x.isChromeBrowser()||x.isChromeMobileBrowser()||x.isOperaBrowser()||x.isOperaMobileBrowser()||x.isEdgeBrowser()||x.isEdgeMobileBrowser()||x.isElectron()||x.isSafariBrowser()&&!x.isIonicIos()||x.isAndroidBrowser()||x.isSamsungBrowser()||x.isIonicAndroid()||x.isIOSWithSafari()){var C=function(){return t(l,void 0,void 0,function(){var A,G,F;return e(this,function(te){switch(te.label){case 0:return A=u.stream.getRTCPeerConnection(),A.connectionState!=="connected"?[3,2]:[4,A.getStats()];case 1:G=te.sent(),F=[],G.forEach(function(S){"frameWidth"in S&&"frameHeight"in S&&F.length===0&&F.push(S)}),F.length>0&&this.openvidu.sendRequest("videoData",{height:F[0].frameHeight,width:F[0].frameWidth,videoActive:u.stream.videoActive!=null?u.stream.videoActive:!1,audioActive:u.stream.audioActive!=null?u.stream.audioActive:!1},function(S,ne){S&&g.error("Error sending 'videoData' event",S)}),te.label=2;case 2:return[2]}})})};if(w){var N=1;this.videoDataInterval=setInterval(function(){N<h?(N++,C()):clearInterval(l.videoDataInterval)},E*1e3)}else this.videoDataTimeout=setTimeout(C,E*1e3)}else x.isFirefoxBrowser()||x.isFirefoxMobileBrowser()||x.isIonicIos()||x.isReactNative()?this.openvidu.sendRequest("videoData",{height:((p=u.stream.videoDimensions)===null||p===void 0?void 0:p.height)||0,width:((R=u.stream.videoDimensions)===null||R===void 0?void 0:R.width)||0,videoActive:u.stream.videoActive!=null?u.stream.videoActive:!1,audioActive:u.stream.audioActive!=null?u.stream.audioActive:!1},function(A,G){A&&g.error("Error sending 'videoData' event",A)}):g.error("Browser "+x.getName()+" (version "+x.getVersion()+") for "+x.getFamily()+" is not supported in OpenVidu for Network Quality")},L.prototype.sessionConnected=function(){return this.connection!=null},L.prototype.notConnectedError=function(){return new b.OpenViduError(b.OpenViduErrorName.OPENVIDU_NOT_CONNECTED,"There is no connection to the session. Method 'Session.connect' must be successfully completed first")},L.prototype.anySpeechEventListenerEnabled=function(u,E,w){var h=this.ee.getListeners(u);E&&(h=h.filter(function(C){return C.once}));var l=h.length;if(l>0)return!0;var p=0;if(w){var R=w.ee.getListeners(u);E&&(R=R.filter(function(C){return C.once})),p=R.length}return p>0},L.prototype.getTokenParams=function(u){var E=u.match(/^(wss?)\:\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(E){var w={protocol:E[1],host:E[2],hostname:E[3],port:E[4],pathname:E[5],search:E[6],hash:E[7]},h=u.split("?"),l=decodeURI(h[1]).split("&").map(function(p){return p.split("=")}).reduce(function(p,R){var C=R[0],N=R[1];return p[C]=N,p},{});return{sessionId:l.sessionId,secret:l.secret,recorder:l.recorder,stt:l.stt,webrtcStatsInterval:l.webrtcStatsInterval,sendBrowserLogs:l.sendBrowserLogs,edition:l.edition,wsUri:w.protocol+"://"+w.host+"/openvidu",httpUri:"https://"+w.host}}else throw new Error('Token not valid: "'.concat(u,'"'))},L.prototype.connectAux=function(u){var E=this;return new Promise(function(w,h){E.openvidu.startWs(function(l){if(l)return h(l);var p=E.initializeParams(u);E.openvidu.sendRequest("joinRoom",p,function(R,C){if(R)return h(R);E.processJoinRoomResponse(C,u),E.connection=new n.Connection(E,C);var N={connections:new Array,streams:new Array},A=C.value;return A.forEach(function(G){var F=new n.Connection(E,G);E.remoteConnections.set(F.connectionId,F),N.connections.push(F),F.stream&&(E.remoteStreamsCreated.set(F.stream.streamId,!0),N.streams.push(F.stream))}),E.ee.emitEvent("connectionCreated",[new c.ConnectionEvent(!1,E,"connectionCreated",E.connection,"")]),N.connections.forEach(function(G){E.ee.emitEvent("connectionCreated",[new c.ConnectionEvent(!1,E,"connectionCreated",G,"")])}),N.streams.forEach(function(G){E.ee.emitEvent("streamCreated",[new O.StreamEvent(!1,E,"streamCreated",G,"")])}),C.recordingId&&C.recordingName&&E.ee.emitEvent("recordingStarted",[new a.RecordingEvent(E,"recordingStarted",C.recordingId,C.recordingName)]),w()})})})},L.prototype.stopPublisherStream=function(u){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[u]))},L.prototype.stopVideoDataIntervals=function(){clearInterval(this.videoDataInterval),clearTimeout(this.videoDataTimeout)},L.prototype.stringClientMetadata=function(u){return typeof u!="string"?JSON.stringify(u):u},L.prototype.getConnection=function(u,E){var w=this;return new Promise(function(h,l){var p=w.remoteConnections.get(u);return p?h(p):w.connection.connectionId===u?h(w.connection):l(new b.OpenViduError(b.OpenViduErrorName.GENERIC_ERROR,E))})},L.prototype.getRemoteConnection=function(u,E){var w=this;return new Promise(function(h,l){var p=w.remoteConnections.get(u);if(p)return h(p);var R="Remote connection "+u+" unknown when '"+E+"'. Existing remote connections: "+JSON.stringify(w.remoteConnections.keys());return l(new b.OpenViduError(b.OpenViduErrorName.GENERIC_ERROR,R))})},L.prototype.processToken=function(u){var E=this.getTokenParams(u);this.sessionId=E.sessionId,E.secret&&(this.openvidu.secret=E.secret),E.recorder&&(this.openvidu.recorder=!0),E.stt&&(this.openvidu.stt=!0),E.webrtcStatsInterval&&(this.openvidu.webrtcStatsInterval=E.webrtcStatsInterval),E.sendBrowserLogs&&(this.openvidu.sendBrowserLogs=E.sendBrowserLogs),this.openvidu.isAtLeastPro=E.edition==="pro"||E.edition==="enterprise",this.openvidu.isEnterprise=E.edition==="enterprise",this.openvidu.wsUri=E.wsUri,this.openvidu.httpUri=E.httpUri},L.prototype.processJoinRoomResponse=function(u,E){if(this.sessionId=u.session,u.customIceServers!=null&&u.customIceServers.length>0){this.openvidu.iceServers=[];for(var w=0,h=u.customIceServers;w<h.length;w++){var l=h[w],p={urls:[l.url]};g.log("STUN/TURN server IP: "+l.url),l.username!=null&&l.credential!=null&&(p.username=l.username,p.credential=l.credential,g.log("TURN credentials ["+l.username+":"+l.credential+"]")),this.openvidu.iceServers.push(p)}}this.openvidu.role=u.role,this.openvidu.finalUserId=u.finalUserId,this.openvidu.mediaServer=u.mediaServer,this.openvidu.videoSimulcast=u.videoSimulcast,this.capabilities={subscribe:!0,publish:this.openvidu.role!=="SUBSCRIBER",forceUnpublish:this.openvidu.role==="MODERATOR",forceDisconnect:this.openvidu.role==="MODERATOR"},g.info("openvidu-server version: "+u.version),u.life!=null&&(this.openvidu.life=u.life);var R=D(u.version)-D(this.openvidu.libraryVersion);M(u.version)!==M(this.openvidu.libraryVersion)||!(R==0||R==1)?g.error("openvidu-browser (".concat(this.openvidu.libraryVersion,") and openvidu-server (").concat(u.version,") versions are incompatible. ")+"Errors are likely to occur. openvidu-browser SDK is only compatible with the same version or the immediately following minor version of an OpenVidu deployment"):R==1&&g.warn("openvidu-browser version ".concat(this.openvidu.libraryVersion," does not match openvidu-server version ").concat(u.version,". ")+"These versions are still compatible with each other, but openvidu-browser version must be updated as soon as possible to ".concat(M(u.version),".").concat(D(u.version),".x. ")+"This client using openvidu-browser ".concat(this.openvidu.libraryVersion," will become incompatible with the next release of openvidu-server")),T.OpenViduLogger.configureJSNLog(this.openvidu,E),this.token=E},L}(s.EventDispatcher);return gt.Session=q,gt}var Ri;function Kn(){if(Ri)return vt;Ri=1;var i=W&&W.__extends||function(){var P=function(y,b){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,T){k.__proto__=T}||function(k,T){for(var I in T)Object.prototype.hasOwnProperty.call(T,I)&&(k[I]=T[I])},P(y,b)};return function(y,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");P(y,b);function k(){this.constructor=y}y.prototype=b===null?Object.create(b):(k.prototype=b.prototype,new k)}}(),t=W&&W.__awaiter||function(P,y,b,k){function T(I){return I instanceof b?I:new b(function(M){M(I)})}return new(b||(b=Promise))(function(I,M){function D(x){try{g(k.next(x))}catch(q){M(q)}}function z(x){try{g(k.throw(x))}catch(q){M(q)}}function g(x){x.done?I(x.value):T(x.value).then(D,z)}g((k=k.apply(P,y||[])).next())})},e=W&&W.__generator||function(P,y){var b={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},k,T,I,M;return M={next:D(0),throw:D(1),return:D(2)},typeof Symbol=="function"&&(M[Symbol.iterator]=function(){return this}),M;function D(g){return function(x){return z([g,x])}}function z(g){if(k)throw new TypeError("Generator is already executing.");for(;M&&(M=0,g[0]&&(b=0)),b;)try{if(k=1,T&&(I=g[0]&2?T.return:g[0]?T.throw||((I=T.return)&&I.call(T),0):T.next)&&!(I=I.call(T,g[1])).done)return I;switch(T=0,I&&(g=[g[0]&2,I.value]),g[0]){case 0:case 1:I=g;break;case 4:return b.label++,{value:g[1],done:!1};case 5:b.label++,T=g[1],g=[0];continue;case 7:g=b.ops.pop(),b.trys.pop();continue;default:if(I=b.trys,!(I=I.length>0&&I[I.length-1])&&(g[0]===6||g[0]===2)){b=0;continue}if(g[0]===3&&(!I||g[1]>I[0]&&g[1]<I[3])){b.label=g[1];break}if(g[0]===6&&b.label<I[1]){b.label=I[1],I=g;break}if(I&&b.label<I[2]){b.label=I[2],b.ops.push(g);break}I[2]&&b.ops.pop(),b.trys.pop();continue}g=y.call(P,b)}catch(x){g=[6,x],T=0}finally{k=I=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(vt,"__esModule",{value:!0}),vt.Publisher=void 0;var n=pn(),r=st,o=ut,s=Jn(),c=Be,d=Ke,a=Ee,f=Ne,v=hn,m=a.OpenViduLogger.getInstance(),O,_=function(P){i(y,P);function y(b,k,T){var I=P.call(this,new r.Stream(T.session?T.session:new n.Session(T),{publisherProperties:k,mediaConstraints:{}}),b)||this;return I.accessAllowed=!1,I.isSubscribedToRemote=!1,I.accessDenied=!1,O=f.PlatformUtils.getInstance(),I.properties=k,I.openvidu=T,I.stream.ee.on("local-stream-destroyed",function(M){I.stream.isLocalStreamPublished=!1;var D=new s.StreamEvent(!0,I,"streamDestroyed",I.stream,M);I.emitEvent("streamDestroyed",[D]),D.callDefaultBehavior()}),I}return y.prototype.publishAudio=function(b){var k=this;if(this.stream.audioActive!==b){var T=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();T.getAudioTracks().forEach(function(I){I.enabled=b}),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:b,reason:"publishAudio"},function(I,M){I?m.error("Error sending 'streamPropertyChanged' event",I):(k.session.emitEvent("streamPropertyChanged",[new c.StreamPropertyChangedEvent(k.session,k.stream,"audioActive",b,!b,"publishAudio")]),k.emitEvent("streamPropertyChanged",[new c.StreamPropertyChangedEvent(k,k.stream,"audioActive",b,!b,"publishAudio")]),k.session.sendVideoData(k.stream.streamManager))}),this.stream.audioActive=b,m.info("'Publisher' has "+(b?"published":"unpublished")+" its audio stream")}},y.prototype.publishVideo=function(b,k){var T=this;return new Promise(function(I,M){return t(T,void 0,void 0,function(){var D,z,g,x,q,B,L=this;return e(this,function(u){switch(u.label){case 0:return this.stream.videoActive===b?[3,9]:(D=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream(),z=!1,D.getVideoTracks().forEach(function(E){E.enabled=b,!b&&k===!0?E.stop():b&&E.readyState==="ended"&&(z=!0)}),!b&&k===!0&&this.stream.filter&&this.stream.filter.type.startsWith("VB:")?(this.stream.lastVBFilter=this.stream.filter,[4,this.stream.removeFilterAux(!0)]):[3,2]);case 1:u.sent(),u.label=2;case 2:return z?(g=D.getVideoTracks()[0],D.removeTrack(g),x=function(E){return t(L,void 0,void 0,function(){var w=this;return e(this,function(h){switch(h.label){case 0:return D.addTrack(E),this.stream.isLocalStreamPublished?[4,this.replaceTrackInRtcRtpSender(E)]:[3,2];case 1:h.sent(),h.label=2;case 2:return this.stream.lastVBFilter&&setTimeout(function(){return t(w,void 0,void 0,function(){var l,p;return e(this,function(R){switch(R.label){case 0:return l=this.stream.lastVBFilter.options,p=this.stream.lastVBFilter.lastExecMethod,p&&p.method==="update"&&(l=Object.assign({},l,p.params)),[4,this.stream.applyFilter(this.stream.lastVBFilter.type,l)];case 1:return R.sent(),delete this.stream.lastVBFilter,[2]}})})},1),[2]}})})},k&&k instanceof MediaStreamTrack?[4,x(k)]:[3,4]):[3,8];case 3:return u.sent(),[3,8];case 4:return u.trys.push([4,7,,8]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:this.stream.lastVideoTrackConstraints})];case 5:return q=u.sent(),[4,x(q.getVideoTracks()[0])];case 6:return u.sent(),[3,8];case 7:return B=u.sent(),[2,M(B)];case 8:return this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:b,reason:"publishVideo"},function(E,w){E?m.error("Error sending 'streamPropertyChanged' event",E):(L.session.emitEvent("streamPropertyChanged",[new c.StreamPropertyChangedEvent(L.session,L.stream,"videoActive",b,!b,"publishVideo")]),L.emitEvent("streamPropertyChanged",[new c.StreamPropertyChangedEvent(L,L.stream,"videoActive",b,!b,"publishVideo")]),L.session.sendVideoData(L.stream.streamManager))}),this.stream.videoActive=b,m.info("'Publisher' has "+(b?"published":"unpublished")+" its video stream"),[2,I()];case 9:return[2]}})})})},y.prototype.subscribeToRemote=function(b){b=b!==void 0?b:!0,this.isSubscribedToRemote=b,this.stream.subscribeToMyRemote(b)},y.prototype.on=function(b,k){var T=this;return P.prototype.on.call(this,b,k),b==="streamCreated"&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new s.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",function(){T.emitEvent("streamCreated",[new s.StreamEvent(!1,T,"streamCreated",T.stream,"")])})),b==="accessAllowed"&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),b==="accessDenied"&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},y.prototype.once=function(b,k){var T=this;return P.prototype.once.call(this,b,k),b==="streamCreated"&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new s.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",function(){T.emitEvent("streamCreated",[new s.StreamEvent(!1,T,"streamCreated",T.stream,"")])})),b==="accessAllowed"&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),b==="accessDenied"&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},y.prototype.off=function(b,k){return P.prototype.off.call(this,b,k),this},y.prototype.replaceTrack=function(b){return t(this,void 0,void 0,function(){return e(this,function(k){return[2,this.replaceTrackAux(b,!0)]})})},y.prototype.initialize=function(){var b=this;return new Promise(function(k,T){return t(b,void 0,void 0,function(){var I,M,D,z,g,x,q,B,L,u,E,w,w,h,l,p=this,R,C;return e(this,function(N){switch(N.label){case 0:I={},M={},D=2e3,g=function(A){return p.accessDenied=!0,p.accessAllowed=!1,m.error("Publisher initialization failed. ".concat(A.name,": ").concat(A.message)),T(A)},x=function(A){var G,F;if(p.accessAllowed=!0,p.accessDenied=!1,typeof MediaStreamTrack<"u"&&p.properties.audioSource instanceof MediaStreamTrack&&(A.removeTrack(A.getAudioTracks()[0]),A.addTrack(p.properties.audioSource)),typeof MediaStreamTrack<"u"&&p.properties.videoSource instanceof MediaStreamTrack&&(A.removeTrack(A.getVideoTracks()[0]),A.addTrack(p.properties.videoSource)),A.getAudioTracks()[0]){var te=p.stream.audioActive!==void 0&&p.stream.audioActive!==null?p.stream.audioActive:!!p.stream.outboundStreamOpts.publisherProperties.publishAudio;A.getAudioTracks()[0].enabled=te}if(A.getVideoTracks()[0]){var te=p.stream.videoActive!==void 0&&p.stream.videoActive!==null?p.stream.videoActive:!!p.stream.outboundStreamOpts.publisherProperties.publishVideo;A.getVideoTracks()[0].enabled=te}for(var S=0,ne=A.getAudioTracks();S<ne.length;S++){var X=ne[S];!((G=X.contentHint)===null||G===void 0)&&G.length||(X.contentHint="",m.info("Audio track Content Hint set: '".concat(X.contentHint,"'")))}for(var de=0,le=A.getVideoTracks();de<le.length;de++){var X=le[de];if(!(!((F=X.contentHint)===null||F===void 0)&&F.length)){switch(p.stream.typeOfVideo){case v.TypeOfVideo.SCREEN:X.contentHint="detail";break;case v.TypeOfVideo.CUSTOM:m.warn("CUSTOM type video track was provided without Content Hint!"),X.contentHint="motion";break;case v.TypeOfVideo.CAMERA:case v.TypeOfVideo.IPCAM:default:X.contentHint="motion";break}m.info("Video track Content Hint set: '".concat(X.contentHint,"'"))}}return p.initializeVideoReference(A),p.stream.displayMyRemote()||p.stream.updateMediaStreamInVideos(),delete p.firstVideoElement,p.stream.isSendVideo()?p.getVideoDimensions().then(function(j){p.stream.videoDimensions={width:j.width,height:j.height},p.stream.isSendScreen()&&(p.stream.isSendAudio()&&A.getAudioTracks().length===0&&(p.stream.audioActive=!1,p.stream.hasAudio=!1,p.stream.outboundStreamOpts.publisherProperties.publishAudio=!1,p.stream.outboundStreamOpts.publisherProperties.audioSource=!1),p.screenShareResizeInterval=setInterval(function(){var pe=A.getVideoTracks()[0].getSettings(),Q=pe.width,V=pe.height,K=Q!=null&&Q!==p.stream.videoDimensions.width,se=V!=null&&V!==p.stream.videoDimensions.height;p.stream.isLocalStreamPublished&&(K||se)&&p.openvidu.sendVideoDimensionsChangedEvent(p,"screenResized",p.stream.videoDimensions.width,p.stream.videoDimensions.height,Q||0,V||0)},650)),p.stream.isLocalStreamReadyToPublish=!0,p.stream.ee.emitEvent("stream-ready-to-publish",[])}):(p.stream.isLocalStreamReadyToPublish=!0,p.stream.ee.emitEvent("stream-ready-to-publish",[])),k()},q=function(A,G){return t(p,void 0,void 0,function(){var F,te;return e(this,function(S){switch(S.label){case 0:if(this.clearPermissionDialogTimer(z,D),!(this.stream.isSendScreen()&&this.properties.audioSource!=="screen"&&this.stream.isSendAudio()))return[3,5];M.audio=G,M.video=!1,z=Date.now(),this.setPermissionDialogTimer(D),S.label=1;case 1:return S.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(M)];case 2:return F=S.sent(),this.clearPermissionDialogTimer(z,D),A.addTrack(F.getAudioTracks()[0]),x(A),[3,4];case 3:return te=S.sent(),this.clearPermissionDialogTimer(z,D),A.getAudioTracks().forEach(function(ne){ne.stop()}),A.getVideoTracks().forEach(function(ne){ne.stop()}),g(this.openvidu.generateAudioDeviceError(te,I)),[2];case 4:return[3,6];case 5:x(A),S.label=6;case 6:return[2]}})})},B=function(A){return t(p,void 0,void 0,function(){var G,F,te,ne,S,ne,X;return e(this,function(de){switch(de.label){case 0:switch(m.error("getMediaError: ".concat(A.toString())),this.clearPermissionDialogTimer(z,D),A.name==="Error"&&(A.name=A.constructor.name),te=A.name.toLowerCase(),te){case"notfounderror":return[3,1];case"notallowederror":return[3,5];case"overconstrainederror":return[3,6];case"aborterror":return[3,10];case"notreadableerror":return[3,10]}return[3,11];case 1:return de.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:I.video})];case 2:return ne=de.sent(),ne.getVideoTracks().forEach(function(le){le.stop()}),G=d.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,F=A.toString(),g(new d.OpenViduError(G,F)),[3,4];case 3:return S=de.sent(),G=d.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,F=S.toString(),g(new d.OpenViduError(G,F)),[3,4];case 4:return[3,12];case 5:return G=this.stream.isSendScreen()?d.OpenViduErrorName.SCREEN_CAPTURE_DENIED:d.OpenViduErrorName.DEVICE_ACCESS_DENIED,F=A.toString(),g(new d.OpenViduError(G,F)),[3,12];case 6:return de.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:I.video})];case 7:return ne=de.sent(),ne.getVideoTracks().forEach(function(le){le.stop()}),A.constraint.toLowerCase()==="deviceid"?(G=d.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,F="Audio input device with deviceId '"+I.audio.deviceId.exact+"' not found"):(G=d.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,F="Audio input device doesn't support the value passed for constraint '"+A.constraint+"'"),g(new d.OpenViduError(G,F)),[3,9];case 8:return X=de.sent(),X.constraint.toLowerCase()==="deviceid"?(G=d.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,F="Video input device with deviceId '"+I.video.deviceId.exact+"' not found"):(G=d.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,F="Video input device doesn't support the value passed for constraint '"+X.constraint+"'"),g(new d.OpenViduError(G,F)),[3,9];case 9:return[3,12];case 10:return G=d.OpenViduErrorName.DEVICE_ALREADY_IN_USE,F=A.toString(),g(new d.OpenViduError(G,F)),[3,12];case 11:return G=d.OpenViduErrorName.GENERIC_ERROR,F=A.toString(),g(new d.OpenViduError(G,F)),[3,12];case 12:return[2]}})})},N.label=1;case 1:return N.trys.push([1,14,,15]),[4,this.openvidu.generateMediaConstraints(this.properties)];case 2:return L=N.sent(),L.videoTrack&&L.audioTrack||L.audioTrack&&((R=L.constraints)===null||R===void 0?void 0:R.video)===!1||L.videoTrack&&((C=L.constraints)===null||C===void 0?void 0:C.audio)===!1?(x(this.openvidu.addAlreadyProvidedTracks(L,new MediaStream,this.stream)),[3,13]):[3,3];case 3:I=L.constraints,u={mediaConstraints:I,publisherProperties:this.properties},this.stream.setOutboundStreamOptions(u),E=I.audio===void 0?!0:I.audio,M.audio=this.stream.isSendScreen()?!1:E,M.video=I.video,z=Date.now(),this.setPermissionDialogTimer(D),N.label=4;case 4:return N.trys.push([4,11,,13]),this.stream.isSendScreen()&&navigator.mediaDevices.getDisplayMedia&&!O.isElectron()?[4,navigator.mediaDevices.getDisplayMedia({video:!0,audio:this.properties.audioSource==="screen"})]:[3,7];case 5:return w=N.sent(),this.openvidu.addAlreadyProvidedTracks(L,w),[4,q(w,E)];case 6:return N.sent(),[3,10];case 7:return this.stream.lastVideoTrackConstraints=M.video,[4,navigator.mediaDevices.getUserMedia(M)];case 8:return w=N.sent(),this.openvidu.addAlreadyProvidedTracks(L,w,this.stream),[4,q(w,E)];case 9:N.sent(),N.label=10;case 10:return[3,13];case 11:return h=N.sent(),[4,B(h)];case 12:return N.sent(),[3,13];case 13:return[3,15];case 14:return l=N.sent(),g(l),[3,15];case 15:return[2]}})})})},y.prototype.replaceTrackAux=function(b,k){return t(this,void 0,void 0,function(){var T,I;return e(this,function(M){switch(M.label){case 0:T=b.enabled,b.kind==="video"?b.enabled=this.stream.videoActive:b.kind==="audio"&&(b.enabled=this.stream.audioActive),M.label=1;case 1:return M.trys.push([1,5,,6]),this.stream.isLocalStreamPublished?(this.replaceTrackInMediaStream(b,k),[4,this.replaceTrackInRtcRtpSender(b)]):[3,3];case 2:return[2,M.sent()];case 3:return[2,this.replaceTrackInMediaStream(b,k)];case 4:return[3,6];case 5:throw I=M.sent(),b.enabled=T,I;case 6:return[2]}})})},y.prototype.getVideoDimensions=function(){var b=this;return new Promise(function(k,T){var I=(O.isIonicIos()||O.isIOSWithSafari())&&b.videoReference.readyState<1,M,D=function(){var z,g;if(typeof b.stream.getMediaStream().getVideoTracks()[0].getSettings=="function"){var x=b.stream.getMediaStream().getVideoTracks()[0].getSettings();z=x.width||b.videoReference.videoWidth,g=x.height||b.videoReference.videoHeight}else m.warn("MediaStreamTrack does not have getSettings method on "+O.getDescription()),z=b.videoReference.videoWidth,g=b.videoReference.videoHeight;return M!=null&&b.videoReference.removeEventListener("loadedmetadata",M),I&&document.body.removeChild(b.videoReference),k({width:z,height:g})};b.videoReference.readyState>=1?D():(M=function(){if(b.videoReference.videoWidth)D();else var z=setInterval(function(){b.videoReference.videoWidth&&(clearInterval(z),D())},40)},b.videoReference.addEventListener("loadedmetadata",M),I&&document.body.appendChild(b.videoReference))})},y.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},y.prototype.initializeVideoReference=function(b){this.videoReference=document.createElement("video"),this.videoReference.style.display="none",this.videoReference.muted=!0,this.videoReference.autoplay=!0,this.videoReference.controls=!1,(O.isSafariBrowser()||O.isIPhoneOrIPad()&&(O.isChromeMobileBrowser()||O.isEdgeMobileBrowser()||O.isOperaMobileBrowser()||O.isFirefoxMobileBrowser()))&&(this.videoReference.playsInline=!0),this.stream.setMediaStream(b),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=this.stream.getMediaStream()},y.prototype.replaceTrackInMediaStream=function(b,k){var T=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream(),I;b.kind==="video"?(I=T.getVideoTracks()[0],k&&(this.stream.lastVideoTrackConstraints=b.getConstraints())):I=T.getAudioTracks()[0],I.enabled=!1,I.stop(),T.removeTrack(I),T.addTrack(b);var M={oldLabel:(I==null?void 0:I.label)||"",newLabel:(b==null?void 0:b.label)||""};b.kind==="video"&&k?(this.openvidu.sendNewVideoDimensionsIfRequired(this,"trackReplaced",50,30),this.openvidu.sendTrackChangedEvent(this,M.oldLabel,M.newLabel,"videoTrack"),this.stream.isLocalStreamPublished&&this.session.sendVideoData(this.stream.streamManager,5,!0,5)):b.kind==="audio"&&k&&this.openvidu.sendTrackChangedEvent(this,M.oldLabel,M.newLabel,"audioTrack"),b.kind==="audio"&&(this.stream.disableHarkSpeakingEvent(!1),this.stream.disableHarkStoppedSpeakingEvent(!1),this.stream.disableHarkVolumeChangeEvent(!1),this.stream.initHarkEvents())},y.prototype.setPermissionDialogTimer=function(b){var k=this;this.permissionDialogTimeout=setTimeout(function(){k.emitEvent("accessDialogOpened",[])},b)},y.prototype.clearPermissionDialogTimer=function(b,k){clearTimeout(this.permissionDialogTimeout),Date.now()-b>k&&this.emitEvent("accessDialogClosed",[])},y.prototype.replaceTrackInRtcRtpSender=function(b){return t(this,void 0,void 0,function(){var k,T;return e(this,function(I){switch(I.label){case 0:if(k=this.stream.getRTCPeerConnection().getSenders(),b.kind==="video"){if(T=k.find(function(M){return!!M.track&&M.track.kind==="video"}),!T)throw new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")}else if(b.kind==="audio"){if(T=k.find(function(M){return!!M.track&&M.track.kind==="audio"}),!T)throw new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")}else throw new Error("Unknown track kind "+b.kind);return[4,T.replaceTrack(b)];case 1:return I.sent(),[2]}})})},y}(o.StreamManager);return vt.Publisher=_,vt}var Zi={};globalThis.getScreenId=function(i,t,e){if(navigator.userAgent.indexOf("Edge")!==-1&&(navigator.msSaveOrOpenBlob||navigator.msSaveBlob)){t({video:!0});return}if(navigator.mozGetUserMedia){t(null,"firefox",{video:{mozMediaSource:i,mediaSource:i}});return}globalThis.addEventListener("message",n);function n(r){r.data&&(r.data.chromeMediaSourceId&&(r.data.chromeMediaSourceId==="PermissionDeniedError"?t("permission-denied"):t(null,r.data.chromeMediaSourceId,_i(null,r.data.chromeMediaSourceId,r.data.canRequestAudioTrack)),globalThis.removeEventListener("message",n)),r.data.chromeExtensionStatus&&(t(r.data.chromeExtensionStatus,null,_i(r.data.chromeExtensionStatus)),globalThis.removeEventListener("message",n)))}setTimeout(e?function(){Gt(e)}:Gt,100)};function _i(i,t,e){var n={audio:!1,video:{mandatory:{chromeMediaSource:i?"screen":"desktop",maxWidth:globalThis.screen.width>1920?globalThis.screen.width:1920,maxHeight:globalThis.screen.height>1080?globalThis.screen.height:1080},optional:[]}};return e&&(n.audio={mandatory:{chromeMediaSource:i?"screen":"desktop"},optional:[]}),t&&(n.video.mandatory.chromeMediaSourceId=t,n.audio&&n.audio.mandatory&&(n.audio.mandatory.chromeMediaSourceId=t)),n}function Gt(i){if(!Te){Yn(function(){Gt(i)});return}if(!Te.isLoaded){setTimeout(function(){Gt(i)},100);return}i?i.forEach?Te.contentWindow.postMessage({captureCustomSourceId:i},"*"):Te.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):Te.contentWindow.postMessage({captureSourceId:!0},"*")}var Te;globalThis.getScreenConstraints=function(i){Yn(function(){getScreenId(function(t,e,n){n||(n={video:!0}),i(t,n.video)})})};function Yn(i){if(Te){i();return}Te=document.createElement("iframe"),Te.onload=function(){Te.isLoaded=!0,i()},Te.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",Te.style.display="none",(document.body||document.documentElement).appendChild(Te)}globalThis.getChromeExtensionStatus=function(i){if(navigator.mozGetUserMedia){i("installed-enabled");return}globalThis.addEventListener("message",t);function t(e){e.data&&e.data.chromeExtensionStatus&&(i(e.data.chromeExtensionStatus),globalThis.removeEventListener("message",t))}setTimeout(Fn,100)};function Fn(){if(!Te){Yn(Fn);return}if(!Te.isLoaded){setTimeout(Fn,100);return}Te.contentWindow.postMessage({getChromeExtensionStatus:!0},"*")}Zi.getScreenId=globalThis.getScreenId;var ht={},We="screen",He,rt;if(typeof window<"u"&&typeof navigator<"u"&&typeof navigator.userAgent<"u"){var er=typeof window.InstallTrigger<"u";window.opera||navigator.userAgent.indexOf(" OPR/")>=0,window.addEventListener("message",function(i){i.origin==window.location.origin&&Aa(i.data)})}function Aa(i){if(i=="PermissionDeniedError"){if(rt)return rt("PermissionDeniedError");throw new Error("PermissionDeniedError")}i=="rtcmulticonnection-extension-loaded"&&(We="desktop"),i.sourceId&&rt&&rt(He=i.sourceId,i.canRequestAudioTrack===!0)}function Va(i){if(i){if(We=="desktop")return i(!0);window.postMessage("are-you-there","*"),setTimeout(function(){We=="screen"?i(!1):i(!0)},2e3)}}function tr(i){if(!i)throw'"callback" parameter is mandatory.';if(He)return i(He);rt=i,window.postMessage("get-sourceId","*")}function Da(i){if(!i)throw'"callback" parameter is mandatory.';if(He)return i(He);rt=i,window.postMessage("audio-plus-tab","*")}function ja(i,t){if(er)return t("not-chrome");arguments.length!=2&&(t=i,i="lfcgfepafnobdloecchnfaclibenjold");var e=document.createElement("img");e.src="chrome-extension://"+i+"/icon.png",e.onload=function(){We="screen",window.postMessage("are-you-there","*"),setTimeout(function(){We=="screen"?t("installed-disabled"):t("installed-enabled")},2e3)},e.onerror=function(){t("not-installed")}}function Ba(i){nr(i,!0)}function nr(i,t){He="";var e={mozMediaSource:"window",mediaSource:"window"};if(er)return i(null,e);var n={mandatory:{chromeMediaSource:We,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};if(We=="desktop"&&!He){t?Da(function(r,o){n.mandatory.chromeMediaSourceId=r,o&&(n.canRequestAudioTrack=!0),i(r=="PermissionDeniedError"?r:null,n)}):tr(function(r){n.mandatory.chromeMediaSourceId=r,i(r=="PermissionDeniedError"?r:null,n)});return}We=="desktop"&&(n.mandatory.chromeMediaSourceId=He),i(null,n)}ht.getScreenConstraints=nr;ht.getScreenConstraintsWithAudio=Ba;ht.isChromeExtensionAvailable=Va;ht.getChromeExtensionStatus=ja;ht.getSourceId=tr;var Qn={exports:{}},ot=typeof Reflect=="object"?Reflect:null,Ii=ot&&typeof ot.apply=="function"?ot.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},Ut;ot&&typeof ot.ownKeys=="function"?Ut=ot.ownKeys:Object.getOwnPropertySymbols?Ut=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ut=function(t){return Object.getOwnPropertyNames(t)};function $a(i){console&&console.warn&&console.warn(i)}var ir=Number.isNaN||function(t){return t!==t};function ae(){ae.init.call(this)}Qn.exports=ae;Qn.exports.once=Ha;ae.EventEmitter=ae;ae.prototype._events=void 0;ae.prototype._eventsCount=0;ae.prototype._maxListeners=void 0;var Pi=10;function mn(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(ae,"defaultMaxListeners",{enumerable:!0,get:function(){return Pi},set:function(i){if(typeof i!="number"||i<0||ir(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Pi=i}});ae.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ae.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||ir(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function rr(i){return i._maxListeners===void 0?ae.defaultMaxListeners:i._maxListeners}ae.prototype.getMaxListeners=function(){return rr(this)};ae.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r=t==="error",o=this._events;if(o!==void 0)r=r&&o.error===void 0;else if(!r)return!1;if(r){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var d=o[t];if(d===void 0)return!1;if(typeof d=="function")Ii(d,this,e);else for(var a=d.length,f=ur(d,a),n=0;n<a;++n)Ii(f[n],this,e);return!0};function or(i,t,e,n){var r,o,s;if(mn(e),o=i._events,o===void 0?(o=i._events=Object.create(null),i._eventsCount=0):(o.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),o=i._events),s=o[t]),s===void 0)s=o[t]=e,++i._eventsCount;else if(typeof s=="function"?s=o[t]=n?[e,s]:[s,e]:n?s.unshift(e):s.push(e),r=rr(i),r>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=i,c.type=t,c.count=s.length,$a(c)}return i}ae.prototype.addListener=function(t,e){return or(this,t,e,!1)};ae.prototype.on=ae.prototype.addListener;ae.prototype.prependListener=function(t,e){return or(this,t,e,!0)};function Fa(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function sr(i,t,e){var n={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},r=Fa.bind(n);return r.listener=e,n.wrapFn=r,r}ae.prototype.once=function(t,e){return mn(e),this.on(t,sr(this,t,e)),this};ae.prototype.prependOnceListener=function(t,e){return mn(e),this.prependListener(t,sr(this,t,e)),this};ae.prototype.removeListener=function(t,e){var n,r,o,s,c;if(mn(e),r=this._events,r===void 0)return this;if(n=r[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===e||n[s].listener===e){c=n[s].listener,o=s;break}if(o<0)return this;o===0?n.shift():Ua(n,o),n.length===1&&(r[t]=n[0]),r.removeListener!==void 0&&this.emit("removeListener",t,c||e)}return this};ae.prototype.off=ae.prototype.removeListener;ae.prototype.removeAllListeners=function(t){var e,n,r;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var o=Object.keys(n),s;for(r=0;r<o.length;++r)s=o[r],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this};function ar(i,t,e){var n=i._events;if(n===void 0)return[];var r=n[t];return r===void 0?[]:typeof r=="function"?e?[r.listener||r]:[r]:e?Wa(r):ur(r,r.length)}ae.prototype.listeners=function(t){return ar(this,t,!0)};ae.prototype.rawListeners=function(t){return ar(this,t,!1)};ae.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):cr.call(i,t)};ae.prototype.listenerCount=cr;function cr(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}ae.prototype.eventNames=function(){return this._eventsCount>0?Ut(this._events):[]};function ur(i,t){for(var e=new Array(t),n=0;n<t;++n)e[n]=i[n];return e}function Ua(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function Wa(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function Ha(i,t){return new Promise(function(e,n){function r(s){i.removeListener(t,o),n(s)}function o(){typeof i.removeListener=="function"&&i.removeListener("error",r),e([].slice.call(arguments))}dr(i,t,o,{once:!0}),t!=="error"&&qa(i,r,{once:!0})})}function qa(i,t,e){typeof i.on=="function"&&dr(i,"error",t,e)}function dr(i,t,e,n){if(typeof i.on=="function")n.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function r(o){n.once&&i.removeEventListener(t,r),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var Ga=Qn.exports,Un={exports:{}};typeof Object.create=="function"?Un.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Un.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}};var za=Un.exports,Zn={},ei={};function Xa(i,t){var e={jsonrpc:"2.0"};if(i.method)e.method=i.method,i.params&&(e.params=i.params),t!=null&&(e.id=t);else if(t!=null){if(i.error){if(i.result!==void 0)throw new TypeError("Both result and error are defined");e.error=i.error}else if(i.result!==void 0)e.result=i.result;else throw new TypeError("No result or error is defined");e.id=t}return JSON.stringify(e)}function Ja(i){var t=i;(typeof i=="string"||i instanceof String)&&(t=JSON.parse(i));var e=t.jsonrpc;if(e!=="2.0")throw new TypeError("Invalid JsonRPC version '"+e+"': "+i);if(t.method==null){if(t.id==null)throw new TypeError("Invalid message: "+i);var n=t.result!==void 0,r=t.error!==void 0;if(n&&r)throw new TypeError("Both result and error are defined: "+i);if(!n&&!r)throw new TypeError("No result or error is defined: "+i);t.ack=t.id,delete t.id}return t}ei.pack=Xa;ei.unpack=Ja;var ti={};function Ka(i){throw new TypeError("Not yet implemented")}function Ya(i){throw new TypeError("Not yet implemented")}ti.pack=Ka;ti.unpack=Ya;var Qa=ei,Za=ti;Zn.JsonRPC=Qa;Zn.XmlRPC=Za;function lr(){var i={};this.forEach=function(t){for(var e in i){var n=i[e];for(var r in n)t(n[r])}},this.get=function(t,e){var n=i[e];if(n!=null)return n[t]},this.remove=function(t,e){var n=i[e];if(n!=null){delete n[t];for(var r in n)return!1;delete i[e]}},this.set=function(t,e,n){if(t==null)return this.remove(e,n);var r=i[n];r==null&&(i[n]=r={}),r[e]=t}}lr.prototype.pop=function(i,t){var e=this.get(i,t);if(e!=null)return this.remove(i,t),e};var ec=lr,kn={},Nn,Ti;function fr(){if(Ti)return Nn;Ti=1;var i=Ee.OpenViduLogger,t=i.getInstance(),e=2e3,n=3e3,r=3;function o(s){var c=!1,d,a=s.uri,f=!1,v=new WebSocket(a);v.onopen=function(){t.debug("WebSocket connected to "+a),s.onconnected&&s.onconnected()},v.onerror=function(y){t.error("Could not connect to "+a+" (invoking onerror if defined)",y),s.onerror&&s.onerror(y)};var m=function(){v.readyState===r?c?t.debug("Connection closed by user"):s.ismasternodecrashed()?t.error("Master Node has crashed. Stopping reconnection process"):(t.debug("Connection closed unexpectedly. Reconnecting..."),O(e,1)):t.debug("Close callback from previous websocket. Ignoring it")};v.onclose=m;function O(y,b){if(t.debug("reconnect (attempt #"+b+", max="+y+")"),b===1){if(f){t.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");return}else f=!0;s.onreconnecting&&s.onreconnecting()}P(y,b)}function _(y){var b=new URLSearchParams(new URL(y).search);return b.has("reconnect")||(y=Array.from(b).length>0?y+"&reconnect=true":y+"?reconnect=true"),y}function P(y,b){t.debug("Reconnection attempt #"+b),v.close(4104,"Connection closed for reconnection"),a=_(a),v=new WebSocket(a),v.onopen=function(){t.debug("Reconnected to "+a+" after "+b+" attempts..."),f=!1,d(),s.onreconnected&&s.onreconnected(),v.onclose=m},v.onerror=function(k){t.warn("Reconnection error: ",k),b===y?s.ondisconnect&&s.ondisconnect():setTimeout(function(){O(y,b+1)},n)}}this.close=function(y,b){c=!0,v.close(y,b)},this.reconnectWs=function(){t.debug("reconnectWs"),O(e,1)},this.send=function(y){v.send(y)},this.addEventListener=function(y,b){d=function(){v.addEventListener(y,b)},d()},this.getReadyState=function(){return v.readyState}}return Nn=o,Nn}var Ln,xi;function tc(){if(xi)return Ln;xi=1;var i=hr(),t=fr(),e=Ee.OpenViduLogger;Date.now=Date.now||function(){return+new Date};var n=5e3,r="RECONNECTING",o="CONNECTED",s="DISCONNECTED",c=e.getInstance();function d(a){var f=this,v=a.ws,m=-1,O=0,_=!0,P=!1,y,b=s,k=v.onreconnecting,T=v.onreconnected,I=v.onconnected,M=v.onerror;a.rpc.pull=function(u,E){E.reply(null,"push")},v.onreconnecting=function(){if(c.debug("--------- ONRECONNECTING -----------"),b===r){c.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it");return}L(),b=r,k&&k()},v.onreconnected=function(){if(c.debug("--------- ONRECONNECTED -----------"),b===o){c.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it");return}b=o,x(),T&&T()},v.onconnected=function(){if(c.debug("--------- ONCONNECTED -----------"),b===o){c.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it");return}b=o,_=!0,B(),I&&I()},v.onerror=function(u){c.debug("--------- ONERROR -----------"),b=s,L(),M&&M(u)};var D=new t(v);c.debug("Connecting websocket to URI: "+v.uri);var z={request_timeout:a.rpc.requestTimeout,ping_request_timeout:a.rpc.heartbeatRequestTimeout},g=new i(i.packers.JsonRPC,z,D,function(u){c.debug("Received request: "+JSON.stringify(u));try{var E=a.rpc[u.method];E===void 0?c.error("Method "+u.method+" not registered in client"):E(u.params,u)}catch(w){c.error("Exception processing request: "+JSON.stringify(u)),c.error(w)}});this.send=function(u,E,w){var h=Date.now();g.encode(u,E,function(l,p){if(l){try{c.error("ERROR:"+l.message+" in Request: method:"+u+" params:"+JSON.stringify(E)+" request:"+l.request),l.data&&c.error("ERROR DATA:"+JSON.stringify(l.data))}catch{}l.requestTime=h}w&&(p!=null&&p.value!=="pong"&&c.debug("Response: "+JSON.stringify(p)),w(l,p))})};function x(){c.debug("notReconnectIfNumLessThan = "+O+" (old="+m+")"),m=O}function q(){if(_){var u=null;(O==0||O==m)&&(u={interval:a.heartbeat||n}),O++,f.send("ping",u,function(E){return function(w,h){w&&(c.debug("Error in ping request #"+E+" ("+w.message+")"),E>m&&(_=!1,x(),c.debug("Server did not respond to ping message #"+E+". Reconnecting... "),D.reconnectWs()))}}(O))}else c.debug("Trying to send ping, but ping is not enabled")}function B(){P||(c.debug("Starting ping (if configured)"),P=!0,a.heartbeat!=null&&(y=setInterval(q,a.heartbeat),q()))}function L(){clearInterval(y),P=!1,_=!1,O=-1,g.cancel()}this.close=function(u,E){c.debug("Closing  with code: "+u+" because: "+E),y!=null&&(c.debug("Clearing ping interval"),clearInterval(y)),P=!1,_=!1,D.close(u,E)},this.reconnect=function(){D.reconnectWs()},this.resetPing=function(){_=!0,O=0,B()},this.getReadyState=function(){return D.getReadyState()}}return Ln=d,Ln}var ki;function nc(){if(ki)return kn;ki=1;var i=tc();return kn.JsonRpcClient=i,kn}var Mn={},Ni;function ic(){if(Ni)return Mn;Ni=1;var i=fr();return Mn.WebSocketWithReconnection=i,Mn}var An,Li;function hr(){if(Li)return An;Li=1;var i=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch{i=!0}Function.prototype.bind||(Function.prototype.bind=function(m){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var O=Array.prototype.slice.call(arguments,1),_=this,P=function(){},y=function(){return _.apply(this instanceof P&&m?this:m,O.concat(Array.prototype.slice.call(arguments)))};return P.prototype=this.prototype,y.prototype=new P,y});var t=Ga.EventEmitter,e=za,n=Zn,r=ec,o=5e3;function s(m){if(!m)return{};for(var O in m){var _=m[O];typeof _=="string"&&(m[O]={response:_})}return m}function c(m){if(m){if(m instanceof Function)return{send:m};if(m.send instanceof Function)return m;if(m.postMessage instanceof Function)return m.send=m.postMessage,m;if(m.write instanceof Function)return m.send=m.write,m;if(m.onmessage===void 0&&!(m.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function d(m,O){i?(this.method=m,this.params=O):(Object.defineProperty(this,"method",{value:m,enumerable:!0}),Object.defineProperty(this,"params",{value:O,enumerable:!0}))}function a(m,O,_,P){var y=this;if(!m)throw new SyntaxError("Packer is not defined");if(!m.pack||!m.unpack)throw new SyntaxError("Packer is invalid");var b=s(m.responseMethods);if(O instanceof Function){if(_!=null)throw new SyntaxError("There can't be parameters after onRequest");P=O,_=void 0,O=void 0}if(O&&O.send instanceof Function){if(_&&!(_ instanceof Function))throw new SyntaxError("Only a function can be after transport");P=_,_=O,O=void 0}if(_ instanceof Function){if(P!=null)throw new SyntaxError("There can't be parameters after onRequest");P=_,_=void 0}if(_&&_.send instanceof Function&&P&&!(P instanceof Function))throw new SyntaxError("Only a function can be after transport");O=O||{},t.call(this),P&&this.on("request",P),i?this.peerID=O.peerID:Object.defineProperty(this,"peerID",{value:O.peerID});var k=O.max_retries||0;function T(l){y.decode(l.data||l)}this.getTransport=function(){return _},this.setTransport=function(l){_&&(_.removeEventListener?_.removeEventListener("message",T):_.removeListener&&_.removeListener("data",T)),l&&(l.addEventListener?l.addEventListener("message",T):l.addListener&&l.addListener("data",T)),_=c(l)},i||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(_);var I=O.request_timeout||o,M=O.ping_request_timeout||I,D=O.response_timeout||o,z=O.duplicates_timeout||o,g=0,x=new r,q=new r,B=new r,L={};function u(l,p,R){var C={message:l,timeout:setTimeout(function(){q.remove(p,R)},D)};q.set(C,p,R)}function E(l,p){var R=setTimeout(function(){B.remove(l,p)},z);B.set(R,l,p)}function w(l,p,R,C,N){d.call(this,l,p),this.getTransport=function(){return N},this.setTransport=function(F){N=c(F)},i||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var A=q.get(R,C);N||y.getTransport()||(i?this.duplicated=!!A:Object.defineProperty(this,"duplicated",{value:!!A}));var G=b[l];this.pack=m.pack.bind(m,this,R),this.reply=function(F,te,S){if(F instanceof Function||F&&F.send instanceof Function){if(te!=null)throw new SyntaxError("There can't be parameters after callback");S=F,te=null,F=void 0}else if(te instanceof Function||te&&te.send instanceof Function){if(S!=null)throw new SyntaxError("There can't be parameters after callback");S=te,te=null}S=c(S),A&&clearTimeout(A.timeout),C!=null&&(F&&(F.dest=C),te&&(te.dest=C));var ne;if(F||te!=null){if(y.peerID!=null&&(F?F.from=y.peerID:te.from=y.peerID),G)if(G.error==null&&F)ne={error:F};else{var X=F?G.error:G.response;ne={method:X,params:F||te}}else ne={error:F,result:te};ne=m.pack(ne,R)}else A?ne=A.message:ne=m.pack({result:null},R);return u(ne,R,C),S=S||this.getTransport()||y.getTransport(),S?S.send(ne):ne}}e(w,d);function h(l){var p=L[l];if(p){delete L[l];var R=x.pop(p.id,p.dest);R&&(clearTimeout(R.timeout),E(p.id,p.dest))}}this.cancel=function(l){if(l)return h(l);for(var l in L)h(l)},this.close=function(){var l=this.getTransport();l&&l.close&&l.close(4003,"Cancel request"),this.cancel(),B.forEach(clearTimeout),q.forEach(function(p){clearTimeout(p.timeout)})},this.encode=function(l,p,R,C,N){if(p instanceof Function){if(R!=null)throw new SyntaxError("There can't be parameters after callback");N=p,C=void 0,R=void 0,p=void 0}else if(R instanceof Function){if(C!=null)throw new SyntaxError("There can't be parameters after callback");N=R,C=void 0,R=void 0}else if(C instanceof Function){if(N!=null)throw new SyntaxError("There can't be parameters after callback");N=C,C=void 0}y.peerID!=null&&(p=p||{},p.from=y.peerID),R!=null&&(p=p||{},p.dest=R);var A={method:l,params:p};if(N){let ne=function(j,pe){y.cancel(A),N(j,pe)},X=function(j){var pe=l==="ping"?M:I;return te.timeout=setTimeout(le,pe*Math.pow(2,F++)),L[A]={id:G,dest:R},x.set(te,G,R),j=j||S||y.getTransport(),j?j.send(A):A},de=function(j){j=c(j),console.warn(F+" retry for request message:",A);var pe=B.pop(G,R);return clearTimeout(pe),X(j)},le=function(){if(F<k)return de(C);var j=new Error("Request has timed out");j.request=A,j.retry=de,ne(j)};var G=g++,F=0;A=m.pack(A,G);var te={message:A,callback:ne,responseMethods:b[l]||{}},S=c(C);return X(C)}return A=m.pack(A),C=C||this.getTransport(),C?C.send(A):A},this.decode=function(l,p){if(!l)throw new TypeError("Message is not defined");try{l=m.unpack(l)}catch(V){return console.debug(V,l)}var R=l.id,C=l.ack,N=l.method,A=l.params||{},G=A.from,F=A.dest;if(y.peerID!=null&&G==y.peerID)return;if(R==null&&C==null){var te=new d(N,A);return y.emit("request",te)?void 0:te}function S(){if(p=c(p)||y.getTransport(),p){var V=q.get(R,G);if(V)return p.send(V.message)}var K=R??C,se=new w(N,A,K,G,p);if(!y.emit("request",se))return se}function ne(V,K,se){V.callback(K,se)}function X(V){console.warn("Response already processed",l),clearTimeout(V),E(C,G)}if(N){if(F==null||F==y.peerID){var Q=x.get(C,G);if(Q){var de=Q.responseMethods;return N==de.error?ne(Q,A):N==de.response?ne(Q,null,A):S()}var le=B.get(C,G);if(le)return X(le)}return S()}var j=l.error,pe=l.result;if(!(j&&j.dest&&j.dest!=y.peerID)&&!(pe&&pe.dest&&pe.dest!=y.peerID)){var Q=x.get(C,G);if(!Q){var le=B.get(C,G);return le?X(le):console.warn("No callback was defined for this message",l)}ne(Q,j,pe)}}}e(a,t),a.RpcNotification=d,An=a;var f=nc(),v=ic();return a.clients=f,a.clients.transports=v,a.packers=n,An}const rc="OpenVidu",oc={freeice:"2.2.2",hark:"1.2.3",jsnlog:"2.30.0",mime:"3.0.0",platform:"1.3.6",semver:"7.3.8",uuid:"9.0.0","wolfy87-eventemitter":"5.2.9",events:"3.3.0",inherits:"2.0.4"},sc="OpenVidu Browser",ac={"@types/node":"18.11.9","@types/platform":"1.3.4",browserify:"17.0.0",grunt:"1.5.3","grunt-cli":"1.4.3","grunt-contrib-copy":"1.0.0","grunt-contrib-sass":"2.0.0","grunt-contrib-uglify":"5.2.2","grunt-contrib-watch":"1.1.0","grunt-postcss":"0.9.0","grunt-string-replace":"1.3.3","grunt-ts":"6.0.0-beta.22",terser:"5.15.1",tsify:"5.0.4",tslint:"6.1.3",typedoc:"0.23.21",typescript:"4.9.3"},cc="Apache-2.0",uc="lib/index.js",dc="openvidu-browser",lc={type:"git",url:"git://github.com/OpenVidu/openvidu"},fc={browserify:"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v","browserify-prod":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/terser/bin/terser --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js",build:"cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --target es5 --lib dom,es5,es2015.promise,scripthost && rm -rf ./ts4.4 && mkdir -p ./ts4.4/lib && cp -r ./lib ./ts4.4 && find ./ts4.4/lib -type f ! -iname '*.d.ts' -delete && ./config/replace_for_ts44.sh",docs:"./generate-docs.sh"},hc="lib/index.d.ts",pc={"<4.4":{"*":["ts4.4/*"]}},mc="2.29.1",vc={author:rc,dependencies:oc,description:sc,devDependencies:ac,license:cc,main:uc,name:dc,repository:lc,scripts:fc,types:hc,typesVersions:pc,version:mc};var Mi=W&&W.__awaiter||function(i,t,e,n){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function c(f){try{a(n.next(f))}catch(v){s(v)}}function d(f){try{a(n.throw(f))}catch(v){s(v)}}function a(f){f.done?o(f.value):r(f.value).then(c,d)}a((n=n.apply(i,t||[])).next())})},Ai=W&&W.__generator||function(i,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(a){return function(f){return d([a,f])}}function d(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(e=0)),e;)try{if(n=1,r&&(o=a[0]&2?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,r=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){e.label=a[1];break}if(a[0]===6&&e.label<o[1]){e.label=o[1],o=a;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(a);break}o[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(i,e)}catch(f){a=[6,f],r=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.OpenVidu=void 0;var gc=wt,Ec=Kn(),Vi=pn(),bc=ft,it=Be,re=Ke,Vn=Rt,Sc=Ee,yc=Ne,wc=Zi,Di=ht,Oc=qn,Cc=Gn,Rc=hr(),_c=vc,ue=Sc.OpenViduLogger.getInstance(),ie,Ic=function(){function i(){var t=this;this.masterNodeHasCrashed=!1,this.publishers=[],this.secret="",this.recorder=!1,this.stt=!1,this.life=-1,this.advancedConfiguration={},this.webrtcStatsInterval=-1,this.sendBrowserLogs=Oc.OpenViduLoggerConfiguration.disabled,this.isAtLeastPro=!1,this.isEnterprise=!1,this.ee=new Cc,ie=yc.PlatformUtils.getInstance(),this.libraryVersion=_c.version,ue.info("OpenVidu initialized"),ue.info("Platform detected: "+ie.getDescription()),ue.info("openvidu-browser version: "+this.libraryVersion),(ie.isMobileDevice()||ie.isReactNative())&&this.onOrientationChanged(function(){t.publishers.forEach(function(e){e.stream.isLocalStreamPublished&&e.stream&&e.stream.hasVideo&&t.sendNewVideoDimensionsIfRequired(e,"deviceRotated",75,10)})})}return i.prototype.initSession=function(){return this.session=new Vi.Session(this),this.session},i.prototype.initPublisher=function(t,e,n){var r;e&&typeof e!="function"?(r=e,r={audioSource:typeof r.audioSource<"u"?r.audioSource:void 0,frameRate:typeof MediaStreamTrack<"u"&&r.videoSource instanceof MediaStreamTrack?void 0:typeof r.frameRate<"u"?r.frameRate:void 0,insertMode:typeof r.insertMode<"u"?typeof r.insertMode=="string"?Vn.VideoInsertMode[r.insertMode]:r.insertMode:Vn.VideoInsertMode.APPEND,mirror:typeof r.mirror<"u"?r.mirror:!0,publishAudio:typeof r.publishAudio<"u"?r.publishAudio:!0,publishVideo:typeof r.publishVideo<"u"?r.publishVideo:!0,resolution:typeof MediaStreamTrack<"u"&&r.videoSource instanceof MediaStreamTrack?void 0:typeof r.resolution<"u"?r.resolution:"640x480",videoSource:typeof r.videoSource<"u"?r.videoSource:void 0,videoSimulcast:r.videoSimulcast,filter:r.filter}):r={insertMode:Vn.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var o=new Ec.Publisher(t,r,this),s;return e&&typeof e=="function"?s=e:n&&(s=n),o.initialize().then(function(){s!==void 0&&s(void 0),o.emitEvent("accessAllowed",[])}).catch(function(c){s!==void 0&&s(c),o.emitEvent("accessDenied",[c])}),this.publishers.push(o),o},i.prototype.initPublisherAsync=function(t,e){var n=this;return new Promise(function(r,o){var s,c=function(d){return d?o(d):r(s)};e?s=n.initPublisher(t,e,c):s=n.initPublisher(t,c)})},i.prototype.initLocalRecorder=function(t){return new gc.LocalRecorder(t)},i.prototype.checkSystemRequirements=function(){return ie.isIPhoneOrIPad()?ie.isIOSWithSafari()||ie.isChromeMobileBrowser()||ie.isFirefoxMobileBrowser()||ie.isOperaMobileBrowser()||ie.isEdgeMobileBrowser()||ie.isIonicIos():ie.isChromeBrowser()||ie.isChromeMobileBrowser()||ie.isFirefoxBrowser()||ie.isFirefoxMobileBrowser()||ie.isOperaBrowser()||ie.isOperaMobileBrowser()||ie.isEdgeBrowser()||ie.isEdgeMobileBrowser()||ie.isSamsungBrowser()||ie.isSafariBrowser()||ie.isAndroidBrowser()||ie.isElectron()||ie.isNodeJs()||ie.isMotorolaEdgeDevice()},i.prototype.checkScreenSharingCapabilities=function(){return ie.canScreenShare()},i.prototype.getDevices=function(){return new Promise(function(t,e){navigator.mediaDevices.enumerateDevices().then(function(n){var r,o=[];if(ie.isIonicAndroid()&&typeof cordova<"u"&&(!((r=cordova==null?void 0:cordova.plugins)===null||r===void 0)&&r.EnumerateDevicesPlugin))cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then(function(s){var c=[],d=[],a=[];return c=s.filter(function(f){return f.kind==="audioinput"}),d=n.filter(function(f){return f.kind==="videoinput"}),a=n.filter(function(f){return f.kind==="audioinput"}),d.forEach(function(f,v){if(f.label)o.push({kind:f.kind,deviceId:f.deviceId,label:f.label});else{var m="";v===0?m="Front Camera":v===1?m="Back Camera":m="Unknown Camera",o.push({kind:f.kind,deviceId:f.deviceId,label:m})}}),a.forEach(function(f,v){if(f.label)o.push({kind:f.kind,deviceId:f.deviceId,label:f.label});else{var m="";switch(v){case 0:m="Default";break;case 1:var O=c.filter(function(y){return y.label.includes("Built")})[0];m=O?O.label:"Built-in Microphone";break;case 2:var _=c.filter(function(y){return y.label.includes("Wired")})[0];_?m=_.label:m="Headset earpiece";break;case 3:var P=c.filter(function(y){return y.label.includes("Bluetooth")})[0];m=P?P.label:"Wireless";break;default:m="Unknown Microphone";break}o.push({kind:f.kind,deviceId:f.deviceId,label:m})}}),t(o)});else return n.forEach(function(s){(s.kind==="audioinput"||s.kind==="videoinput")&&o.push({kind:s.kind,deviceId:s.deviceId,label:s.label})}),t(o)}).catch(function(n){return ue.error("Error getting devices",n),e(n)})})},i.prototype.getUserMedia=function(t){var e,n;return Mi(this,void 0,void 0,function(){var r,o,s,a,c,v,m,d,a,f,v,m,O,_=this;return Ai(this,function(P){switch(P.label){case 0:r=function(y,b){return Mi(_,void 0,void 0,function(){var k,T,I,M;return Ai(this,function(D){switch(D.label){case 0:k=b.audio===void 0?!0:b.audio,T={audio:k,video:!1},D.label=1;case 1:return D.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(T)];case 2:return I=D.sent(),y.addTrack(I.getAudioTracks()[0]),[2,y];case 3:throw M=D.sent(),y.getAudioTracks().forEach(function(z){z.stop()}),y.getVideoTracks().forEach(function(z){z.stop()}),this.generateAudioDeviceError(M,T);case 4:return[2]}})})},P.label=1;case 1:return P.trys.push([1,20,,21]),[4,this.generateMediaConstraints(t)];case 2:return o=P.sent(),o.videoTrack&&o.audioTrack||o.audioTrack&&((e=o.constraints)===null||e===void 0?void 0:e.video)===!1||o.videoTrack&&((n=o.constraints)===null||n===void 0?void 0:n.audio)===!1?[2,this.addAlreadyProvidedTracks(o,new MediaStream)]:[3,3];case 3:if(o.videoTrack&&delete o.constraints.video,o.audioTrack&&delete o.constraints.audio,s=!1,typeof t.videoSource!="string")return[3,12];if(!(t.videoSource==="screen"||t.videoSource==="window"||ie.isElectron()&&t.videoSource.startsWith("screen:")))return[3,12];if(s=!o.audioTrack&&t.audioSource!==null&&t.audioSource!==!1,!(navigator.mediaDevices.getDisplayMedia&&!ie.isElectron()))return[3,11];P.label=4;case 4:return P.trys.push([4,9,,10]),[4,navigator.mediaDevices.getDisplayMedia({video:!0,audio:t.audioSource==="screen"})];case 5:return a=P.sent(),this.addAlreadyProvidedTracks(o,a),s?[4,r(a,o.constraints)]:[3,7];case 6:return[2,P.sent()];case 7:return[2,a];case 8:return[3,10];case 9:throw c=P.sent(),v=re.OpenViduErrorName.SCREEN_CAPTURE_DENIED,m=c.toString(),new re.OpenViduError(v,m);case 10:return[3,11];case 11:return[3,12];case 12:d=s?{video:o.constraints.video}:o.constraints,P.label=13;case 13:return P.trys.push([13,18,,19]),[4,navigator.mediaDevices.getUserMedia(d)];case 14:return a=P.sent(),this.addAlreadyProvidedTracks(o,a),s?[4,r(a,o.constraints)]:[3,16];case 15:return[2,P.sent()];case 16:return[2,a];case 17:return[3,19];case 18:throw f=P.sent(),v=void 0,m=f.toString(),t.videoSource!=="screen"?v=re.OpenViduErrorName.DEVICE_ACCESS_DENIED:v=re.OpenViduErrorName.SCREEN_CAPTURE_DENIED,new re.OpenViduError(v,m);case 19:return[3,21];case 20:throw O=P.sent(),O;case 21:return[2]}})})},i.prototype.enableProdMode=function(){ue.enableProdMode()},i.prototype.setAdvancedConfiguration=function(t){this.advancedConfiguration=t},i.prototype.onOrientationChanged=function(t){globalThis.addEventListener("orientationchange",t)},i.prototype.sendNewVideoDimensionsIfRequired=function(t,e,n,r){var o=this,s,c,d,a,f=0,v=((c=(s=t==null?void 0:t.stream)===null||s===void 0?void 0:s.videoDimensions)===null||c===void 0?void 0:c.width)||0,m=((a=(d=t==null?void 0:t.stream)===null||d===void 0?void 0:d.videoDimensions)===null||a===void 0?void 0:a.height)||0,O=setInterval(function(){f++,f>r&&clearTimeout(O),t.getVideoDimensions().then(function(_){(_.width!==v||_.height!==m)&&(clearTimeout(O),o.sendVideoDimensionsChangedEvent(t,e,v,m,_.width,_.height))})},n)},i.prototype.sendVideoDimensionsChangedEvent=function(t,e,n,r,o,s){var c=this;t.stream.videoDimensions={width:o||0,height:s||0},this.sendRequest("streamPropertyChanged",{streamId:t.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(t.stream.videoDimensions),reason:e},function(d,a){d?ue.error("Error sending 'streamPropertyChanged' event",d):(c.session.emitEvent("streamPropertyChanged",[new it.StreamPropertyChangedEvent(c.session,t.stream,"videoDimensions",t.stream.videoDimensions,{width:n,height:r},e)]),t.emitEvent("streamPropertyChanged",[new it.StreamPropertyChangedEvent(t,t.stream,"videoDimensions",t.stream.videoDimensions,{width:n,height:r},e)]),c.session.sendVideoData(t))})},i.prototype.sendTrackChangedEvent=function(t,e,n,r){var o=this,s={label:e},c={label:n},d="trackReplaced";t.stream.isLocalStreamPublished?this.sendRequest("streamPropertyChanged",{streamId:t.stream.streamId,property:r,newValue:c,reason:d},function(a,f){a?ue.error("Error sending 'streamPropertyChanged' event",a):(o.session.emitEvent("streamPropertyChanged",[new it.StreamPropertyChangedEvent(o.session,t.stream,r,c,s,d)]),t.emitEvent("streamPropertyChanged",[new it.StreamPropertyChangedEvent(t,t.stream,r,c,s,d)]))}):(this.session.emitEvent("streamPropertyChanged",[new it.StreamPropertyChangedEvent(this.session,t.stream,r,c,s,d)]),t.emitEvent("streamPropertyChanged",[new it.StreamPropertyChangedEvent(t,t.stream,r,c,s,d)]))},i.prototype.generateMediaConstraints=function(t){var e=this;return new Promise(function(n,r){var o={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},s=t.audioSource,c=t.videoSource;if((s===null||s===!1)&&(o.constraints.audio=!1),(c===null||c===!1)&&(o.constraints.video=!1),o.constraints.audio===!1&&o.constraints.video===!1)return r(new re.OpenViduError(re.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time"));if(typeof MediaStreamTrack<"u"&&s instanceof MediaStreamTrack&&(o.audioTrack=s),typeof MediaStreamTrack<"u"&&c instanceof MediaStreamTrack&&(o.videoTrack=c),s===void 0&&(o.constraints.audio=!0),c===void 0&&(o.constraints.video={width:{ideal:640},height:{ideal:480}}),c!==null&&c!==!1){if(t.resolution){var d=t.resolution.toLowerCase().split("x"),a=Number(d[0]),f=Number(d[1]);o.constraints.video={width:{ideal:a},height:{ideal:f}}}t.frameRate&&(o.constraints.video.frameRate={ideal:t.frameRate})}return e.configureDeviceIdOrScreensharing(o,t,n,r),n(o)})},i.prototype.startWs=function(t){var e={heartbeat:5e3,ws:{uri:this.wsUri+"?sessionId="+this.session.sessionId,onconnected:t,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this),ismasternodecrashed:this.isMasterNodeCrashed.bind(this)},rpc:{requestTimeout:1e4,heartbeatRequestTimeout:5e3,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),broadcastStarted:this.session.onBroadcastStarted.bind(this.session),broadcastStopped:this.session.onBroadcastStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session),masterNodeCrashedNotification:this.onMasterNodeCrashedNotification.bind(this),forciblyReconnectSubscriber:this.session.onForciblyReconnectSubscriber.bind(this.session),speechToTextMessage:this.session.onSpeechToTextMessage.bind(this.session),speechToTextDisconnected:this.session.onSpeechToTextDisconnected.bind(this.session)}};this.jsonRpcClient=new Rc.clients.JsonRpcClient(e)},i.prototype.onMasterNodeCrashedNotification=function(t){console.error("Master Node has crashed"),this.masterNodeHasCrashed=!0,this.session.onLostConnection("nodeCrashed"),this.jsonRpcClient.close(4103,"Master Node has crashed")},i.prototype.getWsReadyState=function(){return this.jsonRpcClient.getReadyState()},i.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},i.prototype.sendRequest=function(t,e,n){var r;e&&e instanceof Function&&(n=e,e={}),ue.debug('Sending request: {method:"'+t+'", params: '+JSON.stringify(e)+"}"),(r=this.jsonRpcClient)===null||r===void 0||r.send(t,e,n)},i.prototype.getWsUri=function(){return this.wsUri},i.prototype.getSecret=function(){return this.secret},i.prototype.getRecorder=function(){return this.recorder},i.prototype.getStt=function(){return this.stt},i.prototype.generateAudioDeviceError=function(t,e){t.name==="Error"&&(t.name=t.constructor.name);var n,r;switch(t.name.toLowerCase()){case"notfounderror":return n=re.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r=t.toString(),new re.OpenViduError(n,r);case"notallowederror":return n=re.OpenViduErrorName.DEVICE_ACCESS_DENIED,r=t.toString(),new re.OpenViduError(n,r);case"overconstrainederror":return t.constraint.toLowerCase()==="deviceid"?(n=re.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r="Audio input device with deviceId '"+e.audio.deviceId.exact+"' not found"):(n=re.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,r="Audio input device doesn't support the value passed for constraint '"+t.constraint+"'"),new re.OpenViduError(n,r);case"notreadableerror":return n=re.OpenViduErrorName.DEVICE_ALREADY_IN_USE,r=t.toString(),new re.OpenViduError(n,r);default:return new re.OpenViduError(re.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,t.toString())}},i.prototype.addAlreadyProvidedTracks=function(t,e,n){return t.videoTrack&&(e.addTrack(t.videoTrack),n&&(t.constraints.video?n.lastVideoTrackConstraints=t.constraints.video:n.lastVideoTrackConstraints=t.videoTrack.getConstraints())),t.audioTrack&&e.addTrack(t.audioTrack),e},i.prototype.configureDeviceIdOrScreensharing=function(t,e,n,r){var o=this,s=e.audioSource,c=e.videoSource;if(typeof s=="string"&&s!=="screen"&&(t.constraints.audio={deviceId:{exact:s}}),typeof c=="string")if(!this.isScreenShare(c))this.setVideoSource(t,c),s==="screen"&&(ue.warn('Parameter "audioSource" is set to "screen", which means rquesting audio from screen sharing source. But "videoSource" is not set to "screen". No audio source will be requested'),t.constraints.audio=!1);else if(this.checkScreenSharingCapabilities())if(ie.isElectron()){var a="screen:",f=c,v=f.substr(f.indexOf(a)+a.length);return t.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:v}},n(t)}else if(this.advancedConfiguration.screenShareChromeExtension&&!(ie.isFirefoxBrowser()||ie.isFirefoxMobileBrowser())&&!navigator.mediaDevices.getDisplayMedia){Di.getScreenConstraints(function(O,_){if(O||_.mandatory&&_.mandatory.chromeMediaSource==="screen")if(O==="permission-denied"||O==="PermissionDeniedError"){var P=new re.OpenViduError(re.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");return ue.error(P),r(P)}else{var y=o.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();Di.getChromeExtensionStatus(y,function(b){if(b==="installed-disabled"){var k=new re.OpenViduError(re.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");return ue.error(k),r(k)}if(b==="not-installed"){var T=new re.OpenViduError(re.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,o.advancedConfiguration.screenShareChromeExtension);return ue.error(T),r(T)}});return}else return t.constraints.video=_,n(t)});return}else{if(navigator.mediaDevices.getDisplayMedia)return n(t);var m=ie.isFirefoxBrowser()||ie.isFirefoxMobileBrowser()?e.videoSource:void 0;wc.getScreenId(m,function(O,_,P){if(O)if(O==="not-installed"){var y=o.advancedConfiguration.screenShareChromeExtension?o.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",b=new re.OpenViduError(re.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,y);return ue.error(b),r(b)}else if(O==="installed-disabled"){var b=new re.OpenViduError(re.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");return ue.error(b),r(b)}else if(O==="permission-denied"){var b=new re.OpenViduError(re.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");return ue.error(b),r(b)}else{var b=new re.OpenViduError(re.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");return ue.error(b),ue.error(O),r(b)}else return t.constraints.video=P.video,n(t)});return}else{var d=new re.OpenViduError(re.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+ie.getName()+" "+ie.getVersion());return ue.error(d),r(d)}},i.prototype.setVideoSource=function(t,e){t.constraints.video||(t.constraints.video={}),t.constraints.video.deviceId={exact:e}},i.prototype.disconnectCallback=function(){ue.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},i.prototype.reconnectingCallback=function(){ue.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},i.prototype.reconnectWebsocketThroughRpcConnectMethod=function(t){var e=this;this.sendRequest("connect",{sessionId:t,reconnect:!0},function(n,r){if(n)if(e.isMasterNodeCrashed())ue.warn("Master Node has crashed!");else{ue.error(n);var o=function(c,d){ue.warn(d),e.session.onLostConnection(c),e.jsonRpcClient.close(4101,"Reconnection fault: "+d)},s=function(){e.life===-1?o("networkDisconnect","WS successfully reconnected but the user was already evicted due to timeout"):e.sendRequest("sessionStatus",{sessionId:e.session.sessionId},function(c,d){c!=null?console.error("Error checking session status",c):e.life===d.life?o("networkDisconnect","WS successfully reconnected but the user was already evicted due to timeout"):o("nodeCrashed","WS successfully reconnected to OpenVidu Server but your Master Node crashed")})};n.code===40007&&n.message==="reconnection error"&&console.error("Invalid RPC sessionId. Client network disconnection or Master Node crash"),s()}else e.jsonRpcClient.resetPing(),e.session.onRecoveredConnection()})},i.prototype.reconnectedCallback=function(){if(ue.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.reconnectWebsocketThroughRpcConnectMethod(this.session.connection.rpcSessionId);else{ue.warn("There was no previous connection when running reconnection callback");var t=new bc.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[t]),t.callDefaultBehavior()}else alert("Connection error. Please reload page.")},i.prototype.isMasterNodeCrashed=function(){return this.masterNodeHasCrashed},i.prototype.isRoomAvailable=function(){return this.session!==void 0&&this.session instanceof Vi.Session?!0:(ue.warn("Session instance not found"),!1)},i.prototype.isScreenShare=function(t){return t==="screen"||t==="window"||ie.isElectron()&&t.startsWith("screen:")},i}();Jt.OpenVidu=Ic;var pr={};Object.defineProperty(pr,"__esModule",{value:!0});(function(i){var t=W&&W.__createBinding||(Object.create?function(l,p,R,C){C===void 0&&(C=R);var N=Object.getOwnPropertyDescriptor(p,R);(!N||("get"in N?!p.__esModule:N.writable||N.configurable))&&(N={enumerable:!0,get:function(){return p[R]}}),Object.defineProperty(l,C,N)}:function(l,p,R,C){C===void 0&&(C=R),l[C]=p[R]}),e=W&&W.__exportStar||function(l,p){for(var R in l)R!=="default"&&!Object.prototype.hasOwnProperty.call(p,R)&&t(p,l,R)};Object.defineProperty(i,"__esModule",{value:!0}),i.EventDispatcher=i.ExceptionEventName=i.ExceptionEvent=i.SpeechToTextEvent=i.NetworkQualityLevelChangedEvent=i.FilterEvent=i.ConnectionPropertyChangedEvent=i.StreamPropertyChangedEvent=i.VideoElementEvent=i.StreamManagerEvent=i.StreamEvent=i.SignalEvent=i.SessionDisconnectedEvent=i.RecordingEvent=i.PublisherSpeakingEvent=i.ConnectionEvent=i.Event=i.VideoInsertMode=i.TypeOfVideo=i.OpenViduErrorName=i.OpenViduError=i.LocalRecorderState=i.Filter=i.LocalRecorder=i.Connection=i.Stream=i.StreamManager=i.Subscriber=i.Publisher=i.Session=i.OpenVidu=void 0;var n=Wn,r=Jt;Object.defineProperty(i,"OpenVidu",{enumerable:!0,get:function(){return r.OpenVidu}});var o=pn();Object.defineProperty(i,"Session",{enumerable:!0,get:function(){return o.Session}});var s=Kn();Object.defineProperty(i,"Publisher",{enumerable:!0,get:function(){return s.Publisher}});var c=ct;Object.defineProperty(i,"Subscriber",{enumerable:!0,get:function(){return c.Subscriber}});var d=ut;Object.defineProperty(i,"StreamManager",{enumerable:!0,get:function(){return d.StreamManager}});var a=st;Object.defineProperty(i,"Stream",{enumerable:!0,get:function(){return a.Stream}});var f=Ot;Object.defineProperty(i,"Connection",{enumerable:!0,get:function(){return f.Connection}});var v=wt;Object.defineProperty(i,"LocalRecorder",{enumerable:!0,get:function(){return v.LocalRecorder}});var m=at;Object.defineProperty(i,"Filter",{enumerable:!0,get:function(){return m.Filter}});var O=Hn;Object.defineProperty(i,"LocalRecorderState",{enumerable:!0,get:function(){return O.LocalRecorderState}});var _=Ke;Object.defineProperty(i,"OpenViduError",{enumerable:!0,get:function(){return _.OpenViduError}}),Object.defineProperty(i,"OpenViduErrorName",{enumerable:!0,get:function(){return _.OpenViduErrorName}});var P=hn;Object.defineProperty(i,"TypeOfVideo",{enumerable:!0,get:function(){return P.TypeOfVideo}});var y=Rt;Object.defineProperty(i,"VideoInsertMode",{enumerable:!0,get:function(){return y.VideoInsertMode}});var b=Se;Object.defineProperty(i,"Event",{enumerable:!0,get:function(){return b.Event}});var k=Pt;Object.defineProperty(i,"ConnectionEvent",{enumerable:!0,get:function(){return k.ConnectionEvent}});var T=It;Object.defineProperty(i,"PublisherSpeakingEvent",{enumerable:!0,get:function(){return T.PublisherSpeakingEvent}});var I=xt;Object.defineProperty(i,"RecordingEvent",{enumerable:!0,get:function(){return I.RecordingEvent}});var M=ft;Object.defineProperty(i,"SessionDisconnectedEvent",{enumerable:!0,get:function(){return M.SessionDisconnectedEvent}});var D=kt;Object.defineProperty(i,"SignalEvent",{enumerable:!0,get:function(){return D.SignalEvent}});var z=Jn();Object.defineProperty(i,"StreamEvent",{enumerable:!0,get:function(){return z.StreamEvent}});var g=lt;Object.defineProperty(i,"StreamManagerEvent",{enumerable:!0,get:function(){return g.StreamManagerEvent}});var x=Ct;Object.defineProperty(i,"VideoElementEvent",{enumerable:!0,get:function(){return x.VideoElementEvent}});var q=Be;Object.defineProperty(i,"StreamPropertyChangedEvent",{enumerable:!0,get:function(){return q.StreamPropertyChangedEvent}});var B=Lt;Object.defineProperty(i,"ConnectionPropertyChangedEvent",{enumerable:!0,get:function(){return B.ConnectionPropertyChangedEvent}});var L=Tt;Object.defineProperty(i,"FilterEvent",{enumerable:!0,get:function(){return L.FilterEvent}});var u=Mt;Object.defineProperty(i,"NetworkQualityLevelChangedEvent",{enumerable:!0,get:function(){return u.NetworkQualityLevelChangedEvent}});var E=Nt;Object.defineProperty(i,"SpeechToTextEvent",{enumerable:!0,get:function(){return E.SpeechToTextEvent}});var w=Ye;Object.defineProperty(i,"ExceptionEvent",{enumerable:!0,get:function(){return w.ExceptionEvent}}),Object.defineProperty(i,"ExceptionEventName",{enumerable:!0,get:function(){return w.ExceptionEventName}});var h=dt;Object.defineProperty(i,"EventDispatcher",{enumerable:!0,get:function(){return h.EventDispatcher}}),e(pr,i),n.JL.setOptions({enabled:!1})})($i);class Pc{constructor(){Le(this,"connectionId");Le(this,"audioActive");Le(this,"videoActive");Le(this,"screenShareActive");Le(this,"nickname");Le(this,"streamManager");Le(this,"type");this.connectionId="",this.audioActive=!0,this.videoActive=!0,this.screenShareActive=!1,this.nickname="",this.streamManager=null,this.type="local"}isAudioActive(){return this.audioActive}isVideoActive(){return this.videoActive}isScreenShareActive(){return this.screenShareActive}getConnectionId(){return this.connectionId}getNickname(){return this.nickname}getStreamManager(){return this.streamManager}isLocal(){return this.type==="local"}isRemote(){return!this.isLocal()}setAudioActive(t){this.audioActive=t}setVideoActive(t){this.videoActive=t}setScreenShareActive(t){this.screenShareActive=t}setStreamManager(t){this.streamManager=t}setConnectionId(t){this.connectionId=t}setNickname(t){this.nickname=t}setType(t){t==="local"|t==="remote"&&(this.type=t)}}class Tc{constructor(){Le(this,"layoutContainer");Le(this,"opts")}fixAspectRatio(t,e){const n=t.querySelector(".OT_root");if(n){const r=n.style.width;n.style.width=e+"px",n.style.width=r||""}}positionElement(t,e,n,r,o,s){const c={left:e+"px",top:n+"px",width:r+"px",height:o+"px"};this.fixAspectRatio(t,r),s&&$?($(t).stop(),$(t).animate(c,s.duration||200,s.easing||"swing",()=>{this.fixAspectRatio(t,r),s.complete&&s.complete.call(this)})):$(t).css(c),this.fixAspectRatio(t,r)}getVideoRatio(t){if(!t)return 3/4;const e=t.querySelector("video");return e&&e.videoHeight&&e.videoWidth?e.videoHeight/e.videoWidth:t.videoHeight&&t.videoWidth?t.videoHeight/t.videoWidth:3/4}getCSSNumber(t,e){const n=$(t).css(e);return n?parseInt(n,10):0}cheapUUID(){return(Math.random()*1e8).toFixed(0)}getHeight(t){const e=$(t).css("height");return e?parseInt(e,10):0}getWidth(t){const e=$(t).css("width");return e?parseInt(e,10):0}getBestDimensions(t,e,n,r,o,s){let c,d,a,f,v,m,O;for(let _=1;_<=n;_++){const P=_,y=Math.ceil(n/P);m=Math.floor(o/y),v=Math.floor(r/P),O=m/v,O>e?(O=e,m=v*O):O<t&&(O=t,v=m/O);const b=v*m*n;(c===void 0||b>c)&&(c=b,s=m,f=v,d=P,a=y)}return{maxArea:c,targetCols:d,targetRows:a,targetHeight:s,targetWidth:f,ratio:s/f}}arrange(t,e,n,r,o,s,c,d,a){let f;const v=t.length;let m;if(!s)m=this.getBestDimensions(c,d,v,e,n,f);else{const T=this.getVideoRatio(t.length>0?t[0]:null);m=this.getBestDimensions(T,T,v,e,n,f)}let O=0,_=0;const P=[];let y;for(let T=0;T<t.length;T++){T%m.targetCols===0&&(y={children:[],width:0,height:0},P.push(y));const I=t[T];y.children.push(I);let M=m.targetWidth;f=m.targetHeight,s&&(M=f/this.getVideoRatio(I)),y.width+=M,y.height=f}let b=0,k=0;for(let T=0;T<P.length;T++)y=P[T],y.width>e?(y.height=Math.floor(y.height*(e/y.width)),y.width=e):y.width<e&&(k+=1),b+=y.height;if(b<n&&k>0){let T=n-b;b=0;for(let I=0;I<P.length;I++){if(y=P[I],y.width<e){let M=T/k;M/y.height>(e-y.width)/y.width&&(M=Math.floor((e-y.width)/y.width*y.height)),y.width+=Math.floor(M/y.height*y.width),y.height+=M,T-=M,k-=1}b+=y.height}}_=(n-b)/2;for(let T=0;T<P.length;T++){y=P[T],O=(e-y.width)/2;for(let M=0;M<y.children.length;M++){const D=y.children[M];let z=m.targetWidth;f=y.height,s&&(z=Math.floor(f/this.getVideoRatio(D))),D.style.position="absolute";const g=z-this.getCSSNumber(D,"paddingLeft")-this.getCSSNumber(D,"paddingRight")-this.getCSSNumber(D,"marginLeft")-this.getCSSNumber(D,"marginRight")-this.getCSSNumber(D,"borderLeft")-this.getCSSNumber(D,"borderRight"),x=f-this.getCSSNumber(D,"paddingTop")-this.getCSSNumber(D,"paddingBottom")-this.getCSSNumber(D,"marginTop")-this.getCSSNumber(D,"marginBottom")-this.getCSSNumber(D,"borderTop")-this.getCSSNumber(D,"borderBottom");this.positionElement(D,O+r,_+o,g,x,a),O+=z}_+=f}}filterDisplayNone(t){return t.style.display!=="none"}updateLayout(){if(this.layoutContainer.style.display==="none")return;let t=this.layoutContainer.id;t||(t="OT_"+this.cheapUUID(),this.layoutContainer.id=t);const e=this.getHeight(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderTop")-this.getCSSNumber(this.layoutContainer,"borderBottom"),n=this.getWidth(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderLeft")-this.getCSSNumber(this.layoutContainer,"borderRight"),r=e/n;let o=0,s=0,c=0,d=0;const a=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+t+">."+this.opts.bigClass),this.filterDisplayNone),f=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+t+">*:not(."+this.opts.bigClass+")"),this.filterDisplayNone);if(a.length>0&&f.length>0){let v,m;r>this.getVideoRatio(a[0])?(v=n,m=Math.floor(e*this.opts.bigPercentage),s=m,c=e-s):(m=e,v=Math.floor(n*this.opts.bigPercentage),o=v,d=n-o),this.opts.bigFirst?(this.arrange(a,v,m,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate),this.arrange(f,n-o,e-s,o,s,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)):(this.arrange(f,n-o,e-s,0,0,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate),this.arrange(a,v,m,d,c,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate))}else a.length>0&&f.length===0?this.arrange(a,n,e,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate):this.arrange(f,n-o,e-s,o,s,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)}initLayoutContainer(t,e){this.opts={maxRatio:e.maxRatio!=null?e.maxRatio:3/2,minRatio:e.minRatio!=null?e.minRatio:9/16,fixedRatio:e.fixedRatio!=null?e.fixedRatio:!1,animate:e.animate!=null?e.animate:!1,bigClass:e.bigClass!=null?e.bigClass:"OT_big",bigPercentage:e.bigPercentage!=null?e.bigPercentage:.8,bigFixedRatio:e.bigFixedRatio!=null?e.bigFixedRatio:!1,bigMaxRatio:e.bigMaxRatio!=null?e.bigMaxRatio:3/2,bigMinRatio:e.bigMinRatio!=null?e.bigMinRatio:9/16,bigFirst:e.bigFirst!=null?e.bigFirst:!0},this.layoutContainer=typeof t=="string"?$(t):t}setLayoutOptions(t){this.opts=t}}class xc extends ee.Component{constructor(t){super(t),this.videoRef=yr.createRef()}componentDidUpdate(t){t&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}componentDidMount(){this.props&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}render(){return H.jsx("video",{autoPlay:!0,ref:this.videoRef})}}class ji extends ee.Component{constructor(t){super(t),console.log(t)}render(){return H.jsx("div",{children:this.props.streamManager!==void 0?H.jsx("div",{className:"streamcomponent",children:H.jsx(xc,{streamManager:this.props.streamManager})}):H.jsx("span",{children:"호스트가 없습니다."})})}}var ni={},kc=Xt;Object.defineProperty(ni,"__esModule",{value:!0});var mr=ni.default=void 0,Nc=kc(zt()),Lc=H;mr=ni.default=(0,Nc.default)((0,Lc.jsx)("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92z"}),"MicNoneOutlined");var ii={},Mc=Xt;Object.defineProperty(ii,"__esModule",{value:!0});var vr=ii.default=void 0,Ac=Mc(zt()),Vc=H;vr=ii.default=(0,Ac.default)((0,Vc.jsx)("path",{d:"M10.8 4.9c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 3.91L15 10.6V5c0-1.66-1.34-3-3-3-1.54 0-2.79 1.16-2.96 2.65l1.76 1.76zM19 11h-1.7c0 .58-.1 1.13-.27 1.64l1.27 1.27c.44-.88.7-1.87.7-2.91M4.41 2.86 3 4.27l6 6V11c0 1.66 1.34 3 3 3 .23 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.55-.9l4.2 4.2 1.41-1.41z"}),"MicOffOutlined");var ri={},Dc=Xt;Object.defineProperty(ri,"__esModule",{value:!0});var gr=ri.default=void 0,jc=Dc(zt()),Bc=H;gr=ri.default=(0,jc.default)((0,Bc.jsx)("path",{d:"M15 8v8H5V8zm1-2H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4V7c0-.55-.45-1-1-1"}),"VideocamOutlined");var oi={},$c=Xt;Object.defineProperty(oi,"__esModule",{value:!0});var Er=oi.default=void 0,Fc=$c(zt()),Uc=H;Er=oi.default=(0,Fc.default)((0,Uc.jsx)("path",{d:"m9.56 8-2-2-4.15-4.14L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.55-.18L19.73 21l1.41-1.41-8.86-8.86zM5 16V8h1.73l8 8zm10-8v2.61l6 6V6.5l-4 4V7c0-.55-.45-1-1-1h-5.61l2 2z"}),"VideocamOffOutlined");const Wc="/assets/Group-cDp7Suxl.svg",Hc=({user:i,isHost:t,micStatusChanged:e,camStatusChanged:n,hostNickname:r,hostProfileImg:o,setLeaveModal:s,totalUsers:c})=>{const[d,a]=ee.useState(!0),[f,v]=ee.useState(!0);return ee.useEffect(()=>{a(i.stream.audioActive)},[i.stream.audioActive]),ee.useEffect(()=>{v(i.stream.videoActive)},[i.stream.videoActive]),H.jsxs("div",{className:"toolbar-container",children:[H.jsxs("div",{className:"toolbar-host-info",children:[H.jsx("img",{src:o||Bi,alt:"toolbar-Host profile"}),H.jsx("span",{children:r})]}),H.jsxs("div",{className:"toolbar-count-subscribers",children:[H.jsx("img",{src:Wc,alt:""}),c]}),H.jsxs("div",{className:"toolbar-option-btn",children:[H.jsx(Cr,{onClick:()=>s(!0),className:"toolbar-option-icon"}),t&&H.jsxs(H.Fragment,{children:[d?H.jsx(mr,{onClick:e,className:"toolbar-option-icon"}):H.jsx(vr,{onClick:e,className:"toolbar-option-icon"}),f?H.jsx(gr,{onClick:n,className:"toolbar-option-icon"}):H.jsx(Er,{onClick:n,className:"toolbar-option-icon"})]})]})]})},qc=i=>{const t=ee.useRef(),e=ee.useRef(null),n=ee.useRef(null),[r,o]=ee.useState(!0),s=()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{const d=e.current.scrollTop,a=e.current.clientHeight,f=e.current.scrollHeight;o(d+a>=f-100)},100)},c=ee.useCallback(()=>{s()},[]);return ee.useEffect(()=>{r&&t.current.scrollIntoView({behavior:"smooth"})},[i.messageList]),ee.useEffect(()=>(e.current.addEventListener("scroll",c),()=>{n.current&&clearTimeout(n.current),e.current&&e.current.removeEventListener("scroll",c)}),[c]),H.jsxs("div",{className:"chatContainer",ref:e,children:[H.jsx("div",{children:i.messageList.map((d,a)=>H.jsx("div",{children:H.jsxs("div",{className:"chat-box",children:[H.jsx("img",{src:d.split("|")[1]!=="null"?d.split("|")[1]:Bi,alt:"",className:"user-img"}),H.jsxs("div",{className:"msg-detail",children:[H.jsx("div",{className:"msg-info",children:H.jsx("p",{children:d.split("|")[0]})}),H.jsxs("div",{className:"msg-content",children:[H.jsx("span",{className:"triangle"}),H.jsx("p",{className:"text",children:d.split("|")[2]})]})]})]})},a))}),H.jsx("div",{ref:t})]})},Gc=i=>{const[t,e]=ee.useState(""),n=s=>{s.preventDefault(),t.trim()!==""&&i.onMessage(`${i.myUserName}|${i.myUserImg}|`+t.trim(),i.currentSession),e("")},r=s=>{e(s.target.value)},o=s=>{s.key==="Enter"&&(s.preventDefault(),n(s))};return H.jsx(H.Fragment,{children:H.jsxs("div",{id:"messageInput",children:[H.jsx("input",{placeholder:"댓글 달기",id:"chatInput",value:t,onChange:r,onKeyPress:o,onpaste:"return false;"}),t.trim()!==""&&H.jsx("div",{className:"send-reply",onClick:n,children:H.jsx(_r,{})})]})})};function zc({state:i,leaveSession:t}){const e=ee.useRef();ee.useEffect(()=>{e.current.showModal()});const n=s=>{const d=s.target.getBoundingClientRect();(d.left>s.clientX||d.right<s.clientX||d.top>s.clientY||d.bottom<s.clientY)&&(e.current.close(),i(!i))},r=s=>{e.current.close(),i(!i)},o=s=>{i(!i),t()};return H.jsx(H.Fragment,{children:H.jsxs("dialog",{ref:e,onClick:n,className:"leave-modal",children:[H.jsx("header",{className:"leave-modal-header",children:H.jsx("h3",{children:"라이브를 종료하시겠어요?"})}),H.jsxs("div",{className:"leave-modal-body",children:[H.jsx("div",{onClick:r,children:"취소"}),H.jsx("div",{onClick:o,children:"나가기"})]})]})})}function Xc(i){return Pr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z"},child:[]},{tag:"path",attr:{d:"M18 12v.5"},child:[]},{tag:"path",attr:{d:"M16 17.93a9.77 9.77 0 0 1 0-11.86"},child:[]},{tag:"path",attr:{d:"M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33"},child:[]},{tag:"path",attr:{d:"M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4"},child:[]},{tag:"path",attr:{d:"m16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98"},child:[]}]})(i)}let Jc=0;const Kc=({session:i,myUserName:t,myUserImg:e,favIcons:n,setFavIcons:r})=>{const o=["🦈","🐬","🐳","🐋","🐟","🐠","🐡","🦐","🦑","🐙","🦀","🦞","🐚","🎣","💖"],s=()=>{const c=o[Math.floor(Math.random()*o.length)];r(d=>[...d,{id:Jc++,y:100,icon:c}]),i.signal({data:`${t}|${e}|${c}`,type:"heart"}).catch(d=>console.error("Error sending heart signal:",d))};return ee.useEffect(()=>{const c=setInterval(()=>{r(d=>d.filter(a=>a.y>50))},2e3);return()=>clearInterval(c)},[]),H.jsxs("div",{children:[H.jsx(Xc,{onClick:s}),H.jsx("div",{children:n.map(c=>H.jsx("div",{className:"heart-icon",children:c.icon},c.id))})]})};var Dn=new Pc;const yt="https://i10c203.p.ssafy.io",jn="wearegitaehasam",ou=i=>{const t=wr(),e=Or(),n=e.state.roomId,r=e.state.isHost,o=e.state.imageUrl?e.state.imageUrl:null,s=e.state.name?e.state.name:null,c=e.state.nickname,d=e.state.userImg,a=e.state.subscriberSession?e.state.subscriberSession:null,[f,v]=ee.useState(null),[m,O]=ee.useState("Gitaehasam"),[_,P]=ee.useState(""),[y,b]=ee.useState(""),[k,T]=ee.useState(void 0),[I,M]=ee.useState(void 0),[D,z]=ee.useState([]),[g,x]=ee.useState(void 0),[q,B]=ee.useState([]),[L,u]=ee.useState(0),[E,w]=ee.useState(!0),[h,l]=ee.useState(!0),[p,R]=ee.useState(!0),[C,N]=ee.useState(!1),[A,G]=ee.useState(""),[F,te]=ee.useState(""),[S,ne]=ee.useState(!1),[X,de]=ee.useState([]),[le,j]=ee.useState(!0);let pe;ee.useEffect(()=>{k&&I&&j(!1)},[k,I]);const Q=ee.useCallback(()=>r?V(m).then(ce=>K(ce)):K(a),[m,r]),V=ce=>r?new Promise((me,he)=>{let fe=JSON.stringify({customSessionId:ce});mt.post(yt+"/openvidu/api/sessions",fe,{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:"+jn),"Content-Type":"application/json"}}).then(Y=>{mt.post(yt+"/api/lives",{imageUrl:o,name:s,sessionId:Y.data.sessionId},{headers:{Authorization:localStorage.getItem("jwt"),"Content-Type":"application/json"}}).then(J=>{v(J.data.id),me(Y.data.id)}).catch(J=>{console.log("Error on /lives request:",J)})}).catch(Y=>{var we;var J=Object.assign({},Y);((we=J==null?void 0:J.response)==null?void 0:we.status)===409?me(ce):console.log(J)})}):Promise.resolve(a),K=ce=>{let me=r?"PUBLISHER":"SUBSCRIBER";return new Promise((he,fe)=>{const Y={role:me,sessionId:ce};mt.post(yt+"/openvidu/api/sessions/"+ce+"/connection",Y,{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:"+jn),"Content-Type":"application/json"}}).then(J=>{he(J.data.token)}).catch(J=>{console.error(J),J.response&&J.response.status===404?(alert("종료된 라이브 입니다."),t("/media/roomList")):fe(J)})})};let se;ee.useEffect(()=>{O(`Gitaehasam${n}`),G(c),te(d)},[n]),ee.useEffect(()=>{se=new Tc;const ce={maxRatio:1,minRatio:1,fixedRatio:!0,bigClass:"OV_big",bigPercentage:1,bigFixedRatio:!1,bigMaxRatio:1,bigMinRatio:1,bigFirst:!0,animate:!0};se.initLayoutContainer(document.getElementById("layout"),ce),se.setLayoutOptions(ce),window.addEventListener("beforeunload",onbeforeunload),m!=="Gitaehasam"&&U()},[m]);const U=async()=>{pe=new $i.OpenVidu,(await pe.getDevices()).filter(Y=>Y.kind==="videoinput");let me=pe.initSession();T(me);let he;try{he=await Q()}catch(Y){console.log(Y);return}const fe=pe.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:p,publishVideo:h,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1});me.connect(he,{clientData:_}).then(()=>{me.publish(fe).then(()=>{Dn.setNickname(_),Dn.setConnectionId(me.connection.connectionId),Dn.setStreamManager(fe)}),x(fe),M(fe)}),me.on("streamCreated",Y=>{const J=me.subscribe(Y.stream,"publisher");B(J)}),me.on("exception",Y=>{console.warn(Y)}),me.on("connectionCreated",({stream:Y})=>{u(J=>J+1)}),me.on("sessionDisconnected",({stream:Y})=>{alert("라이브가 종료되었습니다."),t("/media/roomList",{replace:!0})}),me.on("connectionDestroyed",({stream:Y})=>{u(J=>J-1)}),me.on("signal:heart",Y=>{const[,,J]=Y.data.split("|");de(we=>[...we,{id:Date.now(),y:100,icon:J}])}),me.on("signal:chat",Y=>{z(J=>[...J,Y.data])})},vn=()=>{g.publishVideo(!g.stream.videoActive),l(!h),x(g)},gn=()=>{g.publishAudio(!g.stream.audioActive),R(!p),x(g)},pt=async()=>{const ce=k;ce&&(r?await En():(ce.disconnect(),t("/media/roomList",{replace:!0})))},En=async()=>{try{await mt.delete(yt+`/api/lives/${f}`,{headers:{Authorization:localStorage.getItem("jwt"),"Content-Type":"application/json"}}),await mt.delete(yt+`/openvidu/api/sessions/${m}`,{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:"+jn),"Content-Type":"application/json"}})}catch(ce){console.error(ce)}finally{t("/media/roomList",{replace:!0})}};ee.useEffect(()=>{P(c),b(d)},[]),ee.useEffect(()=>{const ce=me=>{pt()};return window.addEventListener("beforeunload",ce),()=>{window.removeEventListener("beforeunload",ce)}},[pt]),ee.useEffect(()=>{if(k){const ce=()=>{ne(!0)};return k.on("sessionDisconnected",ce),()=>{k.off("sessionDisconnected",ce)}}},[k]);const At=(ce,me)=>{me.signal({data:ce,to:[],type:"chat"}).then(()=>{}).catch(he=>{console.error(he)})};return H.jsx(H.Fragment,{children:le?H.jsx(Ir,{}):H.jsxs("div",{className:"bounds",children:[k!==void 0&&I!==void 0?H.jsxs("div",{children:[H.jsx(Hc,{user:g,isHost:r,micStatusChanged:gn,camStatusChanged:vn,setLeaveModal:N,hostNickname:A,hostProfileImg:F,totalUsers:L}),r&&H.jsx(ji,{streamManager:g}),!r&&H.jsx(ji,{streamManager:q}),E&&H.jsxs("div",{className:"chatting",children:[H.jsx(qc,{messageList:D}),H.jsxs("div",{className:"chat-input-area",children:[H.jsx(Gc,{myUserName:_,myUserImg:y,onMessage:At,currentSession:k}),H.jsx("div",{className:"heart-button-wrapper",children:H.jsx(Kc,{session:k,myUserName:_,myUserImg:y,favIcons:X,setFavIcons:de})})]})]})]}):H.jsxs("div",{className:"noneData",children:[H.jsx(Rr,{}),H.jsx("div",{children:"존재하지 않는 방송입니다."}),H.jsx("button",{onClick:()=>t("/media/roomList"),children:"나가기"})]}),C?H.jsx(zc,{state:N,leaveSession:pt}):null]})})};export{ou as default};
