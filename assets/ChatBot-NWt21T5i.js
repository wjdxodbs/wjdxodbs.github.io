import{r,j as e,u as j}from"./index-7fGddfZ0.js";import{H as p}from"./Header-RskrksIJ.js";import{d as b}from"./Send-bZRgWES8.js";import{p as N}from"./default_profile-HTeSV8ma.js";import{L as C}from"./Loading-TnpSDXuM.js";import{a as L}from"./commons--RmDgXK-.js";import"./backSymbol-0aRp874W.js";import"./axios-L6U4YIEh.js";const y="/assets/fish_king-dNUI1omU.png";function R({onChat:l,loadingState:n,setLoadingState:i}){const[t,c]=r.useState(""),d=JSON.parse(localStorage.getItem("user")),h=s=>{c(s.target.value)},m=s=>{s.key==="Enter"&&s.target.value.trim()!==""&&(s.preventDefault(),g(s))},g=s=>{s.preventDefault(),l(t),c(""),i(!n)};return r.useEffect(()=>{c(n?"답변을 준비중이에요":"")},[n]),e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsxs("div",{className:"reply-add",children:[e.jsx("div",{className:"reply-line bg-blue"}),e.jsx("img",{src:d.imageUrl||N,alt:""}),e.jsxs("div",{className:"reply-add-area",children:[e.jsx("input",{className:"chatbot-input",value:t,type:"text",placeholder:"메세지 보내기...",onChange:h,onKeyPress:m,readOnly:n}),t.trim()!==""&&e.jsx("div",{className:"send-reply bg-blue",onClick:g,children:e.jsx(b,{})})]})]})})})}function k(){return e.jsxs("div",{className:"chatBotLoading",children:[e.jsx("div",{className:"chatBotLoading-bounce1"}),e.jsx("div",{className:"chatBotLoading-bounce2"}),e.jsx("div",{className:"chatBotLoading-bounce3"})]})}function S(l){const n=j(),i=r.useRef(),t=r.useRef(null),c=r.useRef(null),[d,h]=r.useState(!1),[m,g]=r.useState(!0),s=l.chattingList,o=[{tutorial:"튜토리얼"},{"fish/map":"지도"},{fishbook:"도감"},{"media/roomList":"라이브방송"},{"media/board":"게시판"}],x=()=>{c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{const a=t.current.scrollTop,v=t.current.clientHeight,f=t.current.scrollHeight;g(a+v>=f-100)},100)},u=r.useCallback(()=>{x()},[]);return r.useEffect(()=>{h(!0),m&&i.current.scrollIntoView({behavior:"smooth"}),h(!1)},[s,m]),r.useEffect(()=>(t.current.addEventListener("scroll",u),()=>{c.current&&clearTimeout(c.current),t.current&&t.current.removeEventListener("scroll",u)}),[u]),e.jsx(e.Fragment,{children:e.jsxs("div",{ref:t,className:"message-box",children:[s.map((a,v)=>e.jsxs("div",{className:a.user==="bot"?"message-bot blue-bd":"message-user",children:[a.user==="bot"&&a.imgURL&&e.jsx("div",{className:"message-bot-content",children:e.jsx("img",{className:"message-bot-img",src:a.imgURL,alt:""})}),a.chat==="loading"?e.jsx(k,{}):e.jsx("div",{className:"message-content",children:a.chat}),a.user==="bot"&&a.move&&e.jsxs("div",{onClick:()=>n(`/${a.move}`),className:"message-bot-move",children:[e.jsx("span",{children:o.find(f=>f[a.move])[a.move]})," 이동하기"]})]},v)),e.jsx("div",{ref:i}),d&&e.jsx(C,{})]})})}const U=L();async function E(l){try{const{data:n}=await U.post("/chatbot",{inputText:l});return n}catch(n){console.log(n)}}function D(){const l=j(),[n,i]=r.useState([]),t=JSON.parse(localStorage.getItem("user")),[c,d]=r.useState(!1),h=["낚시 기초 지식","낚시 라이브를 보고싶어","물고기 종류 알아보기","낚시터 추천","원투 낚시","캐스팅이 뭐야?"],m=async s=>{i(o=>[...o,{user:"user",chat:s,imgURL:null,move:null}]),i(o=>[...o,{user:"bot",chat:"loading",imgURL:null,move:null}]),d(!0),await E(s).then(o=>{d(!1),i(x=>{let u=[...x];return u[u.length-1]={user:"bot",chat:o.text,imgURL:o.imageUrl,move:o.move},u})})},g=s=>{m(s.target.textContent)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chatbot-sticky",children:[e.jsx(p,{onClick:()=>l("/")}),e.jsxs("div",{className:"chatbot-header",children:[e.jsx("img",{src:y,className:"chatbot-fishking"}),e.jsx("span",{children:"낚시왕"})]})]}),e.jsxs("div",{className:"chatbot-body",children:[e.jsx("div",{className:"chatbot-chat-container",children:e.jsx("div",{className:"chatbot-start-ment",children:e.jsxs("div",{className:"chatbot-startChat blue-bd",children:[e.jsxs("p",{children:[e.jsx("span",{children:t.nickname})," 님, 안녕하세요."]}),e.jsx("p",{children:"낚시왕입니다."}),e.jsx("p",{children:"어떤 사항이 궁금하신가요?"})]})})}),e.jsx("div",{className:"chatbot-chat-container",children:e.jsxs("div",{className:"chatbot-recommend-div",children:[e.jsx("div",{className:"recomend-title",children:e.jsx("span",{children:"자주 묻는 질문"})}),e.jsx("div",{className:"recommend-ment",children:"낚시왕 추천, 똑똑하게 낚시하자!"}),h.map((s,o)=>e.jsx("div",{className:"chatbot-recommend",onClick:g,children:s},o))]})}),e.jsx(S,{chattingList:n})]}),e.jsx(R,{onChat:m,loadingState:c,setLoadingState:d})]})}export{D as default};
